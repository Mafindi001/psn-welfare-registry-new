<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - PSN Taraba Welfare Registry</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- âœ… FIXED: Proper Supabase JS loading -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* ====== ENHANCED MOBILE RESPONSIVE STYLES ====== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #ff6b35;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --text-light: rgba(255, 255, 255, 0.8);
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 0;
        }

        /* ====== DASHBOARD CONTAINER ====== */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* ====== SIDEBAR ====== */
        .dashboard-sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(135deg, var(--primary-color) 0%, #1a3a6e 100%);
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transition: left 0.3s ease;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
        }

        .sidebar-logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .admin-logo {
            background: var(--secondary-color);
            color: white;
        }

        .sidebar-user {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-greeting {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .user-psn {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .admin-user .user-name {
            color: var(--secondary-color);
        }

        /* ====== NAVIGATION ====== */
        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--secondary-color);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: var(--secondary-color);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logout-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .logout-btn:hover {
            background: var(--danger-color);
            border-color: var(--danger-color);
        }

        /* ====== MAIN CONTENT ====== */
        .dashboard-main {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 2rem;
            width: calc(100% - var(--sidebar-width));
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* ====== BUTTONS ====== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
            text-decoration: none;
            min-height: 44px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background: #1a3a6e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 90, 160, 0.3);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background: #e55a2b;
        }

        .btn-outline {
            background: white;
            color: var(--primary-color);
            border-color: #dee2e6;
        }

        .btn-outline:hover {
            border-color: var(--primary-color);
            background: #f8faff;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            min-height: 36px;
        }

        .btn:disabled,
        .btn.loading {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* ====== STATS GRID ====== */
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .admin-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .admin-stat-card.primary .stat-icon {
            background: rgba(44, 90, 160, 0.1);
            color: var(--primary-color);
        }

        .admin-stat-card.success .stat-icon {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .admin-stat-card.warning .stat-icon {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        .admin-stat-card.info .stat-icon {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info-color);
        }

        .stat-content h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .stat-content p {
            color: #666;
            margin-bottom: 0.5rem;
        }

        .stat-trend {
            font-size: 0.85rem;
            color: #999;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* ====== SECTIONS ====== */
        .dashboard-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-header h2 {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin: 0;
        }

        /* ====== QUICK ACTIONS ====== */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .quick-action-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 2rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .quick-action-btn:hover {
            border-color: var(--primary-color);
            background: #f8faff;
            transform: translateY(-3px);
        }

        .action-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-color), #3a7bd5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .quick-action-btn span {
            font-weight: 600;
            color: #333;
        }

        /* ====== MONITORING ====== */
        .monitoring-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .monitoring-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e0e0e0;
        }

        .monitoring-card h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .monitoring-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--success-color);
            margin-bottom: 1rem;
        }

        .monitoring-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #dee2e6;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-value {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* ====== TABLES ====== */
        .table-responsive {
            overflow-x: auto;
            margin: 1.5rem 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .data-table thead {
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .data-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #495057;
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* ====== STATUS BADGES ====== */
        .status-badge,
        .type-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .type-badge.member {
            background: #e3f2fd;
            color: #1565c0;
        }

        .type-badge.admin {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        /* ====== FORMS ====== */
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-text {
            font-size: 0.875rem;
            color: #666;
            margin-top: 0.25rem;
        }

        .required {
            color: var(--danger-color);
        }

        /* ====== MODALS ====== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1100;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(3px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
        }

        .modal-lg {
            max-width: 800px;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .modal-close:hover {
            background: #f5f5f5;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* ====== NOTIFICATIONS ====== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            z-index: 2000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .notification-success {
            background: var(--success-color);
            border-left: 4px solid #1e7e34;
        }

        .notification-error {
            background: var(--danger-color);
            border-left: 4px solid #bd2130;
        }

        .notification-warning {
            background: var(--warning-color);
            border-left: 4px solid #d39e00;
            color: #212529;
        }

        .notification-info {
            background: var(--info-color);
            border-left: 4px solid #117a8b;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .notification-hide {
            animation: slideOut 0.3s ease forwards;
        }

        /* ====== LOADING SPINNER ====== */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ====== MOBILE RESPONSIVE ====== */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
            backdrop-filter: blur(3px);
        }

        .mobile-overlay.active {
            display: block;
        }

        .mobile-close {
            display: none !important;
        }

        @media (max-width: 768px) {
            .dashboard-sidebar {
                left: -100%;
            }

            .dashboard-sidebar.mobile-open {
                left: 0;
            }

            .dashboard-main {
                margin-left: 0;
                width: 100%;
                padding: 1rem;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .mobile-close {
                display: flex !important;
                position: absolute;
                right: 15px;
                top: 15px;
                background: rgba(255, 255, 255, 0.2);
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                align-items: center;
                justify-content: center;
                z-index: 101;
            }

            .admin-stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .quick-actions-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .monitoring-grid {
                grid-template-columns: 1fr;
            }

            .header-actions {
                width: 100%;
            }

            .header-actions .btn {
                flex: 1;
            }
        }

        @media (max-width: 480px) {
            .admin-stats-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ====== ACTIVITY FEED ====== */
        .activity-feed {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            background: #f8f9fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            margin: 0 0 0.25rem;
            color: #495057;
        }

        .activity-time {
            margin: 0;
            font-size: 0.875rem;
            color: #6c757d;
        }

        /* ====== PAGINATION ====== */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .pagination-btn {
            width: 40px;
            height: 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .pagination-btn:hover:not(:disabled) {
            border-color: var(--primary-color);
            background: #f8faff;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            font-size: 0.95rem;
            color: #666;
        }

        /* ====== FILTER BAR ====== */
        .filter-bar {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            font-size: 1rem;
            min-width: 150px;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 250px;
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 0.75rem 0.75rem 2.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        /* ====== TABLE ACTIONS ====== */
        .table-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.5rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .selected-count {
            font-size: 0.95rem;
            color: #666;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* ====== PASSWORD TOGGLE ====== */
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 5px;
            font-size: 1rem;
            z-index: 10;
        }

        .password-toggle:hover {
            color: var(--primary-color);
        }

        /* ====== CONSENT GROUP ====== */
        .consent-group {
            display: flex;
            gap: 0.75rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .consent-group input[type="checkbox"] {
            margin-top: 0.25rem;
        }

        .consent-text {
            flex: 1;
        }

        .consent-text label {
            margin: 0;
            cursor: pointer;
        }

        /* ====== SETTINGS ====== */
        .settings-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .settings-tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }

        .settings-tab:hover {
            color: var(--primary-color);
            background: rgba(44, 90, 160, 0.1);
        }

        .settings-tab.active {
            color: var(--primary-color);
            background: white;
            border-bottom: 3px solid var(--primary-color);
        }

        .settings-tab-content {
            display: none;
        }

        .settings-tab-content.active {
            display: block;
        }

        .settings-group {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .settings-group h3 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .setting-item {
            margin-bottom: 1.5rem;
        }

        .setting-item label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .setting-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        /* ====== DATABASE INFO ====== */
        .db-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #dee2e6;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        /* ====== LOG ACTIONS ====== */
        .log-action {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .log-action.login {
            background: #d4edda;
            color: #155724;
        }

        .log-action.logout {
            background: #cce5ff;
            color: #004085;
        }

        .log-action.member_add {
            background: #e3f2fd;
            color: #1565c0;
        }

        .log-action.member_update {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .log-action.member_delete {
            background: #f8d7da;
            color: #721c24;
        }

        /* ====== ALERTS ====== */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #117a8b;
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #d39e00;
            color: #856404;
        }

        .alert-success {
            background: #d4edda;
            border-left: 4px solid #1e7e34;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border-left: 4px solid #bd2130;
            color: #721c24;
        }

        /* ====== UTILITIES ====== */
        .text-center {
            text-align: center;
        }

        .mt-2 {
            margin-top: 1rem;
        }

        .mb-2 {
            margin-bottom: 1rem;
        }

        .hidden {
            display: none !important;
        }

        /* ====== ACCESSIBILITY ====== */
        .btn:focus-visible,
        .nav-item:focus-visible,
        .modal-close:focus-visible {
            outline: 3px solid var(--secondary-color);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <div class="dashboard-container">
        <!-- ====== SIDEBAR NAVIGATION ====== -->
        <aside class="dashboard-sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="mobile-close" id="mobileCloseBtn">
                    <i class="fas fa-times"></i>
                </button>
                <div class="sidebar-logo admin-logo">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div>
                    <h3 style="margin: 0; font-size: 1.1rem;">PSN Admin</h3>
                    <p style="margin: 0; font-size: 0.8rem; color: var(--text-light);">Welfare Registry</p>
                </div>
            </div>

            <div class="sidebar-user admin-user">
                <p class="user-greeting">Welfare Secretary</p>
                <h2 class="user-name" id="adminName">Loading...</h2>
                <p class="user-psn" id="adminPsn">Loading...</p>
            </div>

            <nav class="sidebar-nav">
                <a href="#admin-dashboard" class="nav-item active" data-section="admin-dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#manage-members" class="nav-item" data-section="manage-members">
                    <i class="fas fa-users"></i>
                    <span>Manage Members</span>
                    <span class="nav-badge" id="membersCount">0</span>
                </a>
                <a href="#reminder-logs" class="nav-item" data-section="reminder-logs">
                    <i class="fas fa-bell"></i>
                    <span>Reminder Logs</span>
                    <span class="nav-badge" id="remindersCount">0</span>
                </a>
                <a href="#upcoming-events" class="nav-item" data-section="upcoming-events">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Upcoming Events</span>
                    <span class="nav-badge" id="eventsCount">0</span>
                </a>
                <a href="#reports" class="nav-item" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="#system-logs" class="nav-item" data-section="system-logs">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Audit Logs</span>
                </a>
                <a href="#settings" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>System Settings</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <a href="../pages/dashboard.html" class="btn btn-outline"
                    style="margin-bottom: 0.5rem; display: block; text-align: center;">
                    <i class="fas fa-user"></i> Switch to Member View
                </a>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- ====== MAIN CONTENT AREA ====== -->
        <main class="dashboard-main">
            <!-- Header with Mobile Menu Toggle -->
            <header class="dashboard-header">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="header-title">
                    <h1 id="pageTitle">Admin Dashboard</h1>
                    <p id="pageSubtitle" style="color: var(--text-light); margin: 0.5rem 0 0; font-size: 0.95rem;">
                        Welfare Secretary Control Panel
                    </p>
                </div>

                <div class="header-actions">
                    <button class="btn btn-primary" id="refreshDataBtn">
                        <i class="fas fa-sync-alt"></i> <span id="refreshText">Refresh Data</span>
                    </button>
                    <button class="btn btn-secondary" id="quickExportBtn">
                        <i class="fas fa-download"></i> Quick Export
                    </button>
                </div>
            </header>

            <!-- ====== DASHBOARD OVERVIEW SECTION ====== -->
            <section class="dashboard-section active-section" id="admin-dashboard-section">
                <div class="section-header">
                    <h2>System Overview</h2>
                    <div class="last-updated">
                        <i class="fas fa-clock"></i>
                        Last updated: <span id="lastUpdated">Just now</span>
                    </div>
                </div>

                <!-- Admin Stats Grid -->
                <div class="admin-stats-grid">
                    <div class="admin-stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalMembers">0</h3>
                            <p>Total Members</p>
                            <div class="stat-trend">
                                <i class="fas fa-database"></i>
                                <span>Live Database</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-birthday-cake"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="upcomingCelebrations">0</h3>
                            <p>Upcoming Celebrations</p>
                            <div class="stat-trend">
                                <i class="fas fa-calendar"></i>
                                <span>Next 30 days</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="remindersSent">0</h3>
                            <p>Reminders Sent</p>
                            <div class="stat-trend">
                                <i class="fas fa-check-circle"></i>
                                <span>Database Stored</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeMembers">0</h3>
                            <p>Active Members</p>
                            <div class="stat-trend">
                                <i class="fas fa-chart-line"></i>
                                <span>Real-time Data</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Monitoring -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h2>Database Status</h2>
                        <div class="monitoring-controls">
                            <button class="btn btn-outline btn-sm" id="refreshMonitoring">
                                <i class="fas fa-sync-alt"></i> <span id="monitoringText">Refresh</span>
                            </button>
                        </div>
                    </div>

                    <div class="monitoring-grid">
                        <div class="monitoring-card">
                            <h4>Database Connection</h4>
                            <div class="monitoring-value" id="dbConnection">Checking...</div>
                            <div class="monitoring-list" id="dbStatusList">
                                <div class="metric">
                                    <span>Status</span>
                                    <span class="metric-value" id="connectionStatus">Connecting...</span>
                                </div>
                                <div class="metric">
                                    <span>Last Sync</span>
                                    <span class="metric-value" id="lastSync">Never</span>
                                </div>
                            </div>
                        </div>

                        <div class="monitoring-card">
                            <h4>System Health</h4>
                            <div class="health-indicator">
                                <div class="monitoring-value" id="systemHealth">Checking...</div>
                                <div class="monitoring-list">
                                    <div class="metric">
                                        <span>API Status</span>
                                        <span class="metric-value" id="apiStatus">Checking</span>
                                    </div>
                                    <div class="metric">
                                        <span>Storage</span>
                                        <span class="metric-value" id="storageStatus">Unknown</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Quick Actions</h2>
                </div>

                <div class="quick-actions-grid">
                    <button class="quick-action-btn" id="addMemberBtn">
                        <div class="action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <span>Add New Member</span>
                    </button>

                    <button class="quick-action-btn" id="sendAnnouncementBtn">
                        <div class="action-icon">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <span>Send Announcement</span>
                    </button>

                    <button class="quick-action-btn" id="backupDatabaseBtn">
                        <div class="action-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <span>Backup Database</span>
                    </button>

                    <button class="quick-action-btn" id="viewLogsBtn">
                        <div class="action-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <span>View System Logs</span>
                    </button>
                </div>

                <!-- Recent Activity -->
                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Recent Activity</h2>
                    <button class="btn btn-outline btn-sm" id="viewAllActivity">
                        View All
                    </button>
                </div>

                <div class="activity-feed" id="activityFeed">
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">
                                <strong>System Ready:</strong> Admin dashboard initialized
                            </p>
                            <p class="activity-time">Just now</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ====== MANAGE MEMBERS SECTION ====== -->
            <section class="dashboard-section" id="manage-members-section" style="display: none;">
                <div class="section-header">
                    <h2>Manage Members</h2>
                    <div class="header-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="memberSearch" placeholder="Search members by name, PSN, or email...">
                        </div>
                        <button class="btn btn-primary" id="addNewMemberBtn">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filter-bar">
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>

                    <select id="memberTypeFilter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="member">Regular Member</option>
                        <option value="admin">Admin</option>
                    </select>

                    <button class="btn btn-outline btn-sm" id="clearFiltersBtn">
                        <i class="fas fa-times"></i> Clear Filters
                    </button>
                </div>

                <!-- Members Table -->
                <div class="table-responsive">
                    <table class="data-table" id="membersTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllMembers"></th>
                                <th>PSN Number</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Type</th>
                                <th>Registered</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <tr id="loadingRow">
                                <td colspan="9" style="text-align: center; padding: 40px;">
                                    <div class="spinner"></div> Loading members from database...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Table Actions -->
                <div class="table-actions">
                    <div class="selected-count">
                        <span id="selectedCount">0</span> members selected
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-outline btn-sm" id="exportSelectedBtn" disabled>
                            <i class="fas fa-download"></i> Export Selected
                        </button>
                        <button class="btn btn-outline btn-sm" id="deactivateSelectedBtn" disabled>
                            <i class="fas fa-user-slash"></i> Deactivate
                        </button>
                        <button class="btn btn-outline btn-sm btn-danger" id="deleteSelectedBtn" disabled>
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="membersPagination">
                    <button class="pagination-btn" disabled id="prevPageBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="pagination-info">Page <span id="currentPage">1</span> of <span
                            id="totalPages">1</span></span>
                    <button class="pagination-btn" disabled id="nextPageBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </section>

            <!-- ====== REMINDER LOGS SECTION ====== -->
            <section class="dashboard-section" id="reminder-logs-section" style="display: none;">
                <div class="section-header">
                    <h2>Reminder Logs</h2>
                </div>

                <div class="table-responsive">
                    <table class="data-table" id="remindersTable">
                        <thead>
                            <tr>
                                <th>Sent Date</th>
                                <th>Recipient</th>
                                <th>Event</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="remindersTableBody">
                            <tr id="loadingReminders">
                                <td colspan="5" style="text-align: center; padding: 40px;">
                                    <div class="spinner"></div> Loading reminder logs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ====== UPCOMING EVENTS SECTION ====== -->
            <section class="dashboard-section" id="upcoming-events-section" style="display: none;">
                <div class="section-header">
                    <h2>Upcoming Celebrations</h2>
                    <button class="btn btn-primary" id="sendBulkRemindersBtn">
                        <i class="fas fa-bell"></i> Send Bulk Reminders
                    </button>
                </div>

                <div id="upcomingEventsList">
                    <div style="text-align: center; padding: 40px;">
                        <div class="spinner"></div> Loading upcoming events...
                    </div>
                </div>
            </section>

            <!-- ====== REPORTS SECTION ====== -->
            <section class="dashboard-section" id="reports-section" style="display: none;">
                <div class="section-header">
                    <h2>Reports & Analytics</h2>
                    <button class="btn btn-primary" id="generateReportBtn">
                        <i class="fas fa-file-export"></i> Generate Report
                    </button>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <p>Select report type and date range to generate analytics reports.</p>
                </div>
            </section>

            <!-- ====== SYSTEM LOGS SECTION ====== -->
            <section class="dashboard-section" id="system-logs-section" style="display: none;">
                <div class="section-header">
                    <h2>System Audit Logs</h2>
                    <div class="log-filters">
                        <select id="logTypeFilter" class="filter-select">
                            <option value="">All Actions</option>
                            <option value="login">Logins</option>
                            <option value="registration">Registrations</option>
                            <option value="update">Updates</option>
                            <option value="delete">Deletions</option>
                        </select>
                        <input type="text" id="logSearch" class="form-control" placeholder="Search logs..."
                            style="display: inline-block; width: auto;">
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="data-table" id="logsTable">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Details</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <tr id="loadingLogs">
                                <td colspan="5" style="text-align: center; padding: 40px;">
                                    <div class="spinner"></div> Loading audit logs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ====== SYSTEM SETTINGS SECTION ====== -->
            <section class="dashboard-section" id="settings-section" style="display: none;">
                <div class="section-header">
                    <h2>System Settings</h2>
                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> <span id="saveSettingsText">Save Settings</span>
                    </button>
                </div>

                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">General</button>
                    <button class="settings-tab" data-tab="database">Database</button>
                </div>

                <!-- General Settings -->
                <div class="settings-tab-content active" id="general-settings">
                    <div class="settings-group">
                        <h3>Platform Settings</h3>

                        <div class="setting-item">
                            <label for="platformName">Platform Name</label>
                            <input type="text" id="platformName" class="form-control"
                                value="PSN Taraba Welfare Registry">
                        </div>

                        <div class="setting-item">
                            <label for="welfareSecretary">Welfare Secretary Name</label>
                            <input type="text" id="welfareSecretary" class="form-control"
                                value="Dr. Pharmacist Welfare">
                        </div>

                        <div class="setting-item">
                            <label for="contactEmail">Contact Email</label>
                            <input type="email" id="contactEmail" class="form-control" value="welfare@psntaraba.org.ng">
                        </div>
                    </div>
                </div>

                <!-- Database Settings -->
                <div class="settings-tab-content" id="database-settings">
                    <div class="settings-group">
                        <h3>Database Management</h3>

                        <div class="setting-item">
                            <label>Database Status</label>
                            <div class="monitoring-value" id="dbStatusText">Checking...</div>
                        </div>

                        <div class="setting-item">
                            <label>Total Members</label>
                            <p id="dbTotalMembers">0</p>
                        </div>

                        <div class="setting-actions">
                            <button class="btn btn-primary" id="backupNowBtn">
                                <i class="fas fa-database"></i> <span id="backupText">Create Backup</span>
                            </button>
                            <button class="btn btn-outline" id="exportAllDataBtn">
                                <i class="fas fa-file-export"></i> Export All Data
                            </button>
                        </div>

                        <div class="db-info">
                            <div class="info-row">
                                <span>Provider:</span>
                                <span>Supabase (PostgreSQL)</span>
                            </div>
                            <div class="info-row">
                                <span>Connection:</span>
                                <span id="dbConnectionInfo">Secure HTTPS</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ====== ADD MEMBER MODAL ====== -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Add New Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMemberForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newPsnNumber">PSN Number <span class="required">*</span></label>
                            <input type="text" id="newPsnNumber" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newMemberEmail">Email <span class="required">*</span></label>
                            <input type="email" id="newMemberEmail" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newMemberName">Full Name <span class="required">*</span></label>
                        <input type="text" id="newMemberName" class="form-control" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="newMemberPhone">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="newMemberPhone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newMemberDob">Date of Birth</label>
                            <input type="date" id="newMemberDob" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newMemberPassword">Temporary Password <span class="required">*</span></label>
                        <input type="password" id="newMemberPassword" class="form-control" required minlength="6">
                        <div class="form-text">Minimum 6 characters. Member will change on first login</div>
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="makeAdmin">
                            <div class="consent-text">
                                <label for="makeAdmin">Grant administrative privileges</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelAddMember">Cancel</button>
                <button class="btn btn-primary" id="saveNewMember">
                    <span id="saveMemberText">Add Member</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ====== VIEW MEMBER MODAL ====== -->
    <div class="modal" id="viewMemberModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Member Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="memberDetailsContent">
                    <!-- Member details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeMemberModal">Close</button>
            </div>
        </div>
    </div>
    <!-- ====== JAVASCRIPT - FIXED VERSION ====== -->
    <script>
        console.log('ðŸš€ Admin Dashboard Script Loading...');

        // ==================== âœ… FIXED: HARDCODED SUPABASE CONFIGURATION ====================
        const SUPABASE_CONFIG = {
            url: 'https://hmiicabhnljdhubgrqfw.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhtaWljYWJobmxqZGh1YmdycWZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1NTk5NzcsImV4cCI6MjA4MzEzNTk3N30.BZigiDcUsTS7yQN-bVZV_Acb0j6kYR9NL6uvb_3kIlU',
            tables: {
                members: 'members',
                events: 'events',
                reminders: 'reminder_logs',
                logs: 'system_logs',
                settings: 'system_settings'
            }
        };

        // Initialize Supabase client
        let supabase = null;
        let isDatabaseConnected = false;

        function initSupabase() {
            console.log('ðŸ”§ Initializing Supabase client...');

            if (!window.supabase) {
                console.error('âŒ Supabase library not loaded!');
                showNotification('Supabase library not available. Check internet connection.', 'error');
                return false;
            }

            try {
                supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                console.log('âœ… Supabase client initialized successfully');
                console.log('ðŸ“Š Supabase URL:', SUPABASE_CONFIG.url);
                return true;
            } catch (error) {
                console.error('âŒ Failed to initialize Supabase:', error);
                showNotification('Failed to connect to database: ' + error.message, 'error');
                return false;
            }
        }

        // ==================== DATABASE FUNCTIONS ====================

        async function testDatabaseConnection() {
            console.log('ðŸ” Testing database connection...');

            if (!supabase) {
                console.warn('âš ï¸ Supabase not initialized');
                return false;
            }

            try {
                const { data, error, count } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .select('*', { count: 'exact', head: true });

                if (error) {
                    console.error('âŒ Database connection test failed:', error);
                    throw error;
                }

                isDatabaseConnected = true;
                console.log('âœ… Database connection successful!');
                console.log('ðŸ“Š Members table accessible');
                return true;
            } catch (error) {
                console.error('âŒ Database connection error:', error);
                isDatabaseConnected = false;
                showNotification('Database connection failed: ' + error.message, 'error');
                return false;
            }
        }

        async function loadMembersFromDB() {
            console.log('ðŸ“¥ Loading members from database...');

            if (!supabase) {
                console.warn('âš ï¸ Supabase not available, using localStorage fallback');
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                console.log('ðŸ“¦ Loaded from localStorage:', members.length, 'members');
                return members;
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('âŒ Error loading members:', error);
                    throw error;
                }

                console.log('âœ… Loaded from database:', data ? data.length : 0, 'members');
                return data || [];
            } catch (error) {
                console.error('âŒ Database query failed:', error);
                showNotification('Failed to load members: ' + error.message, 'error');

                // Fallback to localStorage
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                console.log('ðŸ“¦ Fallback to localStorage:', members.length, 'members');
                return members;
            }
        }

        async function addMemberToDB(memberData) {
            console.log('âž• Adding new member to database...', memberData);

            if (!supabase) {
                console.warn('âš ï¸ Using localStorage fallback for new member');
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                memberData.id = Date.now().toString();
                memberData.created_at = new Date().toISOString();
                members.push(memberData);
                localStorage.setItem('psn_members', JSON.stringify(members));

                await logSystemAction('member_add', `Added new member: ${memberData.full_name}`);
                return { success: true, data: memberData };
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .insert([memberData])
                    .select()
                    .single();

                if (error) {
                    console.error('âŒ Error adding member:', error);
                    throw error;
                }

                console.log('âœ… Member added successfully:', data);
                await logSystemAction('member_add', `Added member: ${memberData.full_name}`);
                return { success: true, data };
            } catch (error) {
                console.error('âŒ Failed to add member:', error);
                showNotification('Failed to add member: ' + error.message, 'error');
                return { success: false, error: error.message };
            }
        }

        async function updateMemberInDB(id, updates) {
            console.log('ðŸ“ Updating member:', id, updates);

            if (!supabase) {
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                const index = members.findIndex(m => m.id === id);
                if (index !== -1) {
                    members[index] = { ...members[index], ...updates };
                    localStorage.setItem('psn_members', JSON.stringify(members));
                }
                return { success: true };
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .update(updates)
                    .eq('id', id)
                    .select()
                    .single();

                if (error) throw error;

                console.log('âœ… Member updated successfully');
                await logSystemAction('member_update', `Updated member: ${id}`);
                return { success: true, data };
            } catch (error) {
                console.error('âŒ Error updating member:', error);
                return { success: false, error: error.message };
            }
        }

        async function deleteMemberFromDB(id) {
            console.log('ðŸ—‘ï¸ Deleting member:', id);

            if (!supabase) {
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                const filtered = members.filter(m => m.id !== id);
                localStorage.setItem('psn_members', JSON.stringify(filtered));
                return { success: true };
            }

            try {
                const { error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                console.log('âœ… Member deleted successfully');
                await logSystemAction('member_delete', `Deleted member: ${id}`);
                return { success: true };
            } catch (error) {
                console.error('âŒ Error deleting member:', error);
                return { success: false, error: error.message };
            }
        }

        async function loadSystemLogsFromDB() {
            console.log('ðŸ“‹ Loading system logs...');

            if (!supabase) {
                const logs = JSON.parse(localStorage.getItem('psn_logs') || '[]');
                return logs;
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.logs)
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(100);

                if (error) throw error;

                console.log('âœ… Loaded', data ? data.length : 0, 'log entries');
                return data || [];
            } catch (error) {
                console.error('âŒ Error loading logs:', error);
                const logs = JSON.parse(localStorage.getItem('psn_logs') || '[]');
                return logs;
            }
        }

        async function logSystemAction(action, details) {
            const user = getCurrentUser();
            if (!user) {
                console.warn('âš ï¸ No user found for logging action');
                return;
            }

            const logEntry = {
                user_id: user.id,
                action: action,
                details: details,
                ip_address: await getClientIP(),
                created_at: new Date().toISOString()
            };

            console.log('ðŸ“ Logging action:', action, '-', details);

            if (!supabase) {
                const logs = JSON.parse(localStorage.getItem('psn_logs') || '[]');
                logs.unshift(logEntry);
                localStorage.setItem('psn_logs', JSON.stringify(logs));
                return;
            }

            try {
                await supabase
                    .from(SUPABASE_CONFIG.tables.logs)
                    .insert([logEntry]);
                console.log('âœ… Action logged successfully');
            } catch (error) {
                console.error('âŒ Error logging action:', error);
            }
        }

        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch {
                return '127.0.0.1';
            }
        }

        // ==================== AUTHENTICATION & UI FUNCTIONS ====================

        function requireAuth() {
            console.log('ðŸ” Checking authentication...');

            const token = localStorage.getItem('psn_welfare_token');
            const user = localStorage.getItem('psn_welfare_user');

            if (!token || !user) {
                console.warn('âš ï¸ No authentication found, redirecting to login');
                window.location.href = '../pages/admin-login.html';
                return false;
            }

            try {
                const userData = JSON.parse(user);
                if (!userData.is_admin && !userData.isAdmin) {
                    console.warn('âš ï¸ User is not admin, redirecting to member dashboard');
                    window.location.href = '../pages/dashboard.html';
                    return false;
                }
                console.log('âœ… Admin authenticated:', userData.full_name || userData.email);
                return true;
            } catch (error) {
                console.error('âŒ Error parsing user data:', error);
                window.location.href = '../pages/admin-login.html';
                return false;
            }
        }

        function getCurrentUser() {
            const user = localStorage.getItem('psn_welfare_user');
            if (user) {
                try {
                    return JSON.parse(user);
                } catch {
                    return null;
                }
            }
            return null;
        }

        function showNotification(message, type = 'info') {
            console.log(`ðŸ”” Notification [${type}]:`, message);

            // Remove any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(n => n.remove());

            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;

            const iconMap = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };

            notification.innerHTML = `
                    <i class="fas fa-${iconMap[type] || 'info-circle'}"></i>
                    <span>${message}</span>
                `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('notification-hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // ==================== DASHBOARD DATA LOADING ====================

        async function loadDashboardData() {
            console.log('ðŸ“Š Loading dashboard data...');

            const refreshBtn = document.getElementById('refreshDataBtn');
            const refreshText = document.getElementById('refreshText');

            if (refreshBtn) refreshBtn.classList.add('loading');
            if (refreshText) refreshText.innerHTML = '<span class="spinner"></span> Refreshing...';

            try {
                const dbConnected = await testDatabaseConnection();

                // Update connection status
                const dbConnection = document.getElementById('dbConnection');
                const connectionStatus = document.getElementById('connectionStatus');
                const systemHealth = document.getElementById('systemHealth');
                const apiStatus = document.getElementById('apiStatus');

                if (dbConnected && supabase) {
                    console.log('âœ… Database connected, loading live data...');

                    if (dbConnection) {
                        dbConnection.textContent = 'Connected';
                        dbConnection.style.color = '#28a745';
                    }
                    if (connectionStatus) connectionStatus.textContent = 'Online';
                    if (systemHealth) systemHealth.textContent = 'Healthy';
                    if (apiStatus) apiStatus.textContent = 'Online';

                    const members = await loadMembersFromDB();
                    const activeMembers = members.filter(m => m.is_active !== false).length;

                    // Update stats
                    const totalMembersEl = document.getElementById('totalMembers');
                    const activeMembersEl = document.getElementById('activeMembers');
                    const membersCountEl = document.getElementById('membersCount');

                    if (totalMembersEl) totalMembersEl.textContent = members.length;
                    if (activeMembersEl) activeMembersEl.textContent = activeMembers;
                    if (membersCountEl) membersCountEl.textContent = members.length;

                    // Update other stats
                    const upcomingCelebrationsEl = document.getElementById('upcomingCelebrations');
                    const remindersSentEl = document.getElementById('remindersSent');
                    const remindersCountEl = document.getElementById('remindersCount');

                    if (upcomingCelebrationsEl) upcomingCelebrationsEl.textContent = '0';
                    if (remindersSentEl) remindersSentEl.textContent = '0';
                    if (remindersCountEl) remindersCountEl.textContent = '0';

                    // Load and display recent activity
                    const logs = await loadSystemLogsFromDB();
                    updateActivityFeed(logs.slice(0, 5));

                    showNotification('Dashboard data loaded successfully', 'success');
                } else {
                    console.warn('âš ï¸ Using localStorage fallback');

                    if (dbConnection) {
                        dbConnection.textContent = 'Local Storage';
                        dbConnection.style.color = '#ffc107';
                    }
                    if (connectionStatus) connectionStatus.textContent = 'Offline';
                    if (systemHealth) systemHealth.textContent = 'Limited';
                    if (apiStatus) apiStatus.textContent = 'Offline';

                    const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                    const activeMembers = members.filter(m => m.is_active !== false).length;

                    const totalMembersEl = document.getElementById('totalMembers');
                    const activeMembersEl = document.getElementById('activeMembers');
                    const membersCountEl = document.getElementById('membersCount');

                    if (totalMembersEl) totalMembersEl.textContent = members.length;
                    if (activeMembersEl) activeMembersEl.textContent = activeMembers;
                    if (membersCountEl) membersCountEl.textContent = members.length;

                    showNotification('Using local storage (database not available)', 'warning');
                }

                // Update last updated time
                const lastUpdatedEl = document.getElementById('lastUpdated');
                if (lastUpdatedEl) {
                    lastUpdatedEl.textContent = new Date().toLocaleTimeString([], {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }

                console.log('âœ… Dashboard data loaded successfully');

            } catch (error) {
                console.error('âŒ Error loading dashboard data:', error);
                showNotification('Error loading data: ' + error.message, 'error');
            } finally {
                if (refreshBtn) refreshBtn.classList.remove('loading');
                if (refreshText) refreshText.textContent = 'Refresh Data';
            }
        }

        function updateActivityFeed(logs) {
            console.log('ðŸ“ Updating activity feed with', logs.length, 'items');

            const activityFeed = document.getElementById('activityFeed');
            if (!activityFeed) return;

            if (logs.length === 0) {
                activityFeed.innerHTML = `
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="activity-content">
                                <p class="activity-text">
                                    <strong>No recent activity</strong>
                                </p>
                                <p class="activity-time">System ready</p>
                            </div>
                        </div>
                    `;
                return;
            }

            activityFeed.innerHTML = logs.map(log => `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-${getActionIcon(log.action)}"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">
                                <strong>${log.user_id || 'System'}:</strong> ${log.details || 'No details'}
                            </p>
                            <p class="activity-time">${formatTimeAgo(log.created_at)}</p>
                        </div>
                    </div>
                `).join('');
        }

        function getActionIcon(action) {
            const icons = {
                login: 'sign-in-alt',
                logout: 'sign-out-alt',
                member_add: 'user-plus',
                member_update: 'user-edit',
                member_delete: 'user-minus',
                registration: 'user-plus',
                update: 'edit',
                delete: 'trash'
            };
            return icons[action] || 'clipboard-list';
        }

        function formatTimeAgo(dateString) {
            if (!dateString) return 'Unknown';

            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        // ==================== MEMBERS MANAGEMENT ====================

        let allMembers = [];
        let filteredMembers = [];
        let currentPage = 1;
        const membersPerPage = 10;

        async function loadMembersData() {
            console.log('ðŸ‘¥ Loading members table data...');

            const tbody = document.getElementById('membersTableBody');
            if (!tbody) {
                console.error('âŒ Members table body not found');
                return;
            }

            tbody.innerHTML = `
                    <tr id="loadingRow">
                        <td colspan="9" style="text-align: center; padding: 40px;">
                            <div class="spinner"></div> Loading members from database...
                        </td>
                    </tr>
                `;

            try {
                allMembers = await loadMembersFromDB();
                filteredMembers = [...allMembers];

                console.log('ðŸ“Š Loaded', allMembers.length, 'members');

                if (allMembers.length === 0) {
                    tbody.innerHTML = `
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                                    <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                    <p>No members found. Add your first member!</p>
                                </td>
                            </tr>
                        `;
                    updatePagination();
                    return;
                }

                renderMembersTable();
                console.log('âœ… Members table rendered');

            } catch (error) {
                console.error('âŒ Error loading members:', error);
                tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: #dc3545;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                <p>Error loading members. Please try again.</p>
                            </td>
                        </tr>
                    `;
            }
        }

        function renderMembersTable() {
            console.log('ðŸŽ¨ Rendering members table...');

            const tbody = document.getElementById('membersTableBody');
            if (!tbody) return;

            // Apply filters
            const searchTerm = document.getElementById('memberSearch')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('statusFilter')?.value || '';
            const typeFilter = document.getElementById('memberTypeFilter')?.value || '';

            filteredMembers = allMembers.filter(member => {
                const matchesSearch = !searchTerm ||
                    (member.full_name && member.full_name.toLowerCase().includes(searchTerm)) ||
                    (member.psn_number && member.psn_number.toLowerCase().includes(searchTerm)) ||
                    (member.email && member.email.toLowerCase().includes(searchTerm));

                const matchesStatus = !statusFilter ||
                    (statusFilter === 'active' && member.is_active !== false) ||
                    (statusFilter === 'inactive' && member.is_active === false);

                const matchesType = !typeFilter ||
                    (typeFilter === 'admin' && member.is_admin) ||
                    (typeFilter === 'member' && !member.is_admin);

                return matchesSearch && matchesStatus && matchesType;
            });

            console.log('ðŸ” Filtered to', filteredMembers.length, 'members');

            // Calculate pagination
            const totalPages = Math.ceil(filteredMembers.length / membersPerPage);
            const startIndex = (currentPage - 1) * membersPerPage;
            const endIndex = startIndex + membersPerPage;
            const pageMembers = filteredMembers.slice(startIndex, endIndex);

            // Render table
            tbody.innerHTML = '';

            pageMembers.forEach(member => {
                const row = document.createElement('tr');
                row.innerHTML = `
                        <td><input type="checkbox" class="member-checkbox" data-id="${member.id}"></td>
                        <td>${member.psn_number || member.psn || 'N/A'}</td>
                        <td>${member.full_name || 'Unknown'}</td>
                        <td>${member.email || 'N/A'}</td>
                        <td>${member.phone || 'N/A'}</td>
                        <td><span class="status-badge ${member.is_active !== false ? 'active' : 'inactive'}">${member.is_active !== false ? 'Active' : 'Inactive'}</span></td>
                        <td><span class="type-badge ${member.is_admin ? 'admin' : 'member'}">${member.is_admin ? 'Admin' : 'Member'}</span></td>
                        <td>${member.created_at ? new Date(member.created_at).toLocaleDateString() : 'Unknown'}</td>
                        <td>
                            <button class="btn btn-outline btn-sm view-member-btn" data-id="${member.id}" title="View details">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                tbody.appendChild(row);
            });

            // Add event listeners
            document.querySelectorAll('.member-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectedCount);
            });

            document.querySelectorAll('.view-member-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    console.log('ðŸ‘ï¸ View member clicked:', this.getAttribute('data-id'));
                    const memberId = this.getAttribute('data-id');
                    viewMember(memberId);
                });
            });

            updatePagination();
            updateSelectedCount();

            console.log('âœ… Table rendered with', pageMembers.length, 'visible members');
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredMembers.length / membersPerPage);

            const currentPageEl = document.getElementById('currentPage');
            const totalPagesEl = document.getElementById('totalPages');
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');

            if (currentPageEl) currentPageEl.textContent = currentPage;
            if (totalPagesEl) totalPagesEl.textContent = totalPages || 1;

            if (prevBtn) prevBtn.disabled = currentPage === 1;
            if (nextBtn) nextBtn.disabled = currentPage === totalPages || totalPages === 0;
        }

        function updateSelectedCount() {
            const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
            const selectedCount = selectedCheckboxes.length;

            const selectedCountEl = document.getElementById('selectedCount');
            if (selectedCountEl) selectedCountEl.textContent = selectedCount;

            const hasSelection = selectedCount > 0;

            const exportBtn = document.getElementById('exportSelectedBtn');
            const deactivateBtn = document.getElementById('deactivateSelectedBtn');
            const deleteBtn = document.getElementById('deleteSelectedBtn');

            if (exportBtn) exportBtn.disabled = !hasSelection;
            if (deactivateBtn) deactivateBtn.disabled = !hasSelection;
            if (deleteBtn) deleteBtn.disabled = !hasSelection;

            // Update select all checkbox
            const totalCheckboxes = document.querySelectorAll('.member-checkbox').length;
            const selectAllCheckbox = document.getElementById('selectAllMembers');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = totalCheckboxes > 0 && selectedCount === totalCheckboxes;
            }
        }

        async function viewMember(memberId) {
            console.log('ðŸ‘ï¸ Viewing member:', memberId);

            try {
                const member = allMembers.find(m => m.id === memberId || m.id === parseInt(memberId));

                if (!member) {
                    showNotification('Member not found', 'error');
                    return;
                }

                const content = document.getElementById('memberDetailsContent');
                if (!content) return;

                content.innerHTML = `
                        <div class="member-details" style="display: grid; gap: 1rem;">
                            <div class="detail-row" style="padding: 0.75rem; background: #f8f9fa; border-radius: 6px;">
                                <strong>PSN Number:</strong> ${member.psn_number || member.psn || 'N/A'}
                            </div>
                            <div class="detail-row" style="padding: 0.75rem; background: #f8f9fa; border-radius: 6px;">
                                <strong>Full Name:</strong> ${member.full_name || 'Unknown'}
                            </div>
                            <div class="detail-row" style="padding: 0.75rem; background: #f8f9fa; border-radius: 6px;">
                                <strong>Email:</strong> ${member.email || 'N/A'}
                            </div>
                            <div class="detail-row" style="padding: 0.75rem; background: #f8f9fa; border-radius: 6px;">
                                <strong>Phone:</strong> ${member.phone || 'N/A'}
                            </div>
                            <div class="detail-row" style="padding: 0.75rem; background: #f8f9fa; border-radius: 6px;">
                                <strong>Status:</strong> <span class="status-badge ${member.is_active !== false ? 'active' : 'inactive'}">${member.is_active !== false ? 'Active' : 'Inactive'}</span>
                            </div>
                            <div class="detail-row" style="padding: 0.75rem; background: #f8f9fa; border-radius: 6px;">
                                <strong>Type:</strong> <span class="type-badge ${member.is_admin ? 'admin' : 'member'}">${member.is_admin ? 'Administrator' : 'Regular Member'}</span>
                            </div>
                            <div class="detail-row" style="padding: 0.75rem; background: #f8f9fa; border-radius: 6px;">
                                <strong>Registered:</strong> ${member.created_at ? new Date(member.created_at).toLocaleString() : 'Unknown'}
                            </div>
                        </div>
                    `;

                const modal = document.getElementById('viewMemberModal');
                if (modal) modal.classList.add('show');

                console.log('âœ… Member details displayed');

            } catch (error) {
                console.error('âŒ Error viewing member:', error);
                showNotification('Error loading member details', 'error');
            }
        }
        // ==================== âœ… CRITICAL FIX: BUTTON EVENT LISTENERS ====================

            function attachAllEventListeners() {
                console.log('ðŸ”— Attaching all event listeners...');

                // ===== MOBILE MENU =====
                const mobileMenuToggle = document.getElementById('mobileMenuToggle');
                const mobileCloseBtn = document.getElementById('mobileCloseBtn');
                const mobileOverlay = document.getElementById('mobileOverlay');
                const sidebar = document.getElementById('sidebar');

                function toggleMobileMenu() {
                    console.log('ðŸ“± Toggle mobile menu');
                    if (sidebar) sidebar.classList.toggle('mobile-open');
                    if (mobileOverlay) mobileOverlay.classList.toggle('active');
                    document.body.style.overflow = sidebar?.classList.contains('mobile-open') ? 'hidden' : '';
                }

                if (mobileMenuToggle) {
                    mobileMenuToggle.addEventListener('click', toggleMobileMenu);
                    console.log('âœ… Mobile menu toggle attached');
                }
                if (mobileCloseBtn) {
                    mobileCloseBtn.addEventListener('click', toggleMobileMenu);
                    console.log('âœ… Mobile close button attached');
                }
                if (mobileOverlay) {
                    mobileOverlay.addEventListener('click', toggleMobileMenu);
                    console.log('âœ… Mobile overlay attached');
                }

                // ===== NAVIGATION =====
                const navItems = document.querySelectorAll('.nav-item[data-section]');
                const sections = {
                    'admin-dashboard': document.getElementById('admin-dashboard-section'),
                    'manage-members': document.getElementById('manage-members-section'),
                    'reminder-logs': document.getElementById('reminder-logs-section'),
                    'upcoming-events': document.getElementById('upcoming-events-section'),
                    'reports': document.getElementById('reports-section'),
                    'system-logs': document.getElementById('system-logs-section'),
                    'settings': document.getElementById('settings-section')
                };

                navItems.forEach(item => {
                    item.addEventListener('click', function (e) {
                        e.preventDefault();
                        const sectionId = this.getAttribute('data-section');
                        console.log('ðŸ”€ Navigation clicked:', sectionId);

                        // Update active nav item
                        navItems.forEach(nav => nav.classList.remove('active'));
                        this.classList.add('active');

                        // Hide all sections
                        Object.values(sections).forEach(section => {
                            if (section) section.style.display = 'none';
                        });

                        // Show selected section
                        if (sections[sectionId]) {
                            sections[sectionId].style.display = 'block';
                            loadSectionData(sectionId);
                        }

                        // Update page title
                        updatePageTitle(sectionId);

                        // Close mobile menu if open
                        if (window.innerWidth <= 768 && sidebar) {
                            toggleMobileMenu();
                        }
                    });
                });
                console.log('âœ… Navigation items attached:', navItems.length);

                // ===== LOGOUT BUTTON =====
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', function () {
                        console.log('ðŸšª Logout clicked');
                        if (confirm('Are you sure you want to logout?')) {
                            localStorage.removeItem('psn_welfare_token');
                            localStorage.removeItem('psn_welfare_user');
                            window.location.href = '../pages/admin-login.html';
                        }
                    });
                    console.log('âœ… Logout button attached');
                }

                // ===== REFRESH DATA BUTTON =====
                const refreshDataBtn = document.getElementById('refreshDataBtn');
                if (refreshDataBtn) {
                    refreshDataBtn.addEventListener('click', async function () {
                        console.log('ðŸ”„ Refresh data clicked');
                        await loadDashboardData();
                    });
                    console.log('âœ… Refresh data button attached');
                }

                // ===== QUICK EXPORT BUTTON =====
                const quickExportBtn = document.getElementById('quickExportBtn');
                if (quickExportBtn) {
                    quickExportBtn.addEventListener('click', function () {
                        console.log('ðŸ“¥ Quick export clicked');
                        quickExportData();
                    });
                    console.log('âœ… Quick export button attached');
                }

                // ===== ADD MEMBER BUTTONS =====
                const addMemberBtn = document.getElementById('addMemberBtn');
                const addNewMemberBtn = document.getElementById('addNewMemberBtn');

                function openAddMemberModal() {
                    console.log('âž• Opening add member modal');
                    const modal = document.getElementById('addMemberModal');
                    if (modal) modal.classList.add('show');
                }

                if (addMemberBtn) {
                    addMemberBtn.addEventListener('click', openAddMemberModal);
                    console.log('âœ… Add member button (quick action) attached');
                }
                if (addNewMemberBtn) {
                    addNewMemberBtn.addEventListener('click', openAddMemberModal);
                    console.log('âœ… Add new member button attached');
                }

                // ===== SAVE NEW MEMBER =====
                const saveNewMemberBtn = document.getElementById('saveNewMember');
                if (saveNewMemberBtn) {
                    saveNewMemberBtn.addEventListener('click', async function () {
                        console.log('ðŸ’¾ Save new member clicked');
                        await handleSaveNewMember();
                    });
                    console.log('âœ… Save new member button attached');
                }

                // ===== CANCEL ADD MEMBER =====
                const cancelAddMemberBtn = document.getElementById('cancelAddMember');
                if (cancelAddMemberBtn) {
                    cancelAddMemberBtn.addEventListener('click', function () {
                        console.log('âŒ Cancel add member clicked');
                        closeModal('addMemberModal');
                    });
                    console.log('âœ… Cancel add member button attached');
                }

                // ===== CLOSE MEMBER MODAL =====
                const closeMemberModalBtn = document.getElementById('closeMemberModal');
                if (closeMemberModalBtn) {
                    closeMemberModalBtn.addEventListener('click', function () {
                        console.log('âŒ Close member modal clicked');
                        closeModal('viewMemberModal');
                    });
                    console.log('âœ… Close member modal button attached');
                }

                // ===== MODAL CLOSE BUTTONS =====
                const modalCloseButtons = document.querySelectorAll('.modal-close');
                modalCloseButtons.forEach(btn => {
                    btn.addEventListener('click', function () {
                        const modal = this.closest('.modal');
                        if (modal) {
                            console.log('âŒ Modal close button clicked');
                            modal.classList.remove('show');
                        }
                    });
                });
                console.log('âœ… Modal close buttons attached:', modalCloseButtons.length);

                // ===== QUICK ACTION BUTTONS =====
                const sendAnnouncementBtn = document.getElementById('sendAnnouncementBtn');
                if (sendAnnouncementBtn) {
                    sendAnnouncementBtn.addEventListener('click', function () {
                        console.log('ðŸ“¢ Send announcement clicked');
                        const message = prompt('Enter announcement message:');
                        if (message && message.trim()) {
                            showNotification('Announcement sent to all members', 'success');
                            logSystemAction('announcement', `Sent: ${message}`);
                        }
                    });
                    console.log('âœ… Send announcement button attached');
                }

                const backupDatabaseBtn = document.getElementById('backupDatabaseBtn');
                if (backupDatabaseBtn) {
                    backupDatabaseBtn.addEventListener('click', function () {
                        console.log('ðŸ’¾ Backup database clicked');
                        backupDatabase();
                    });
                    console.log('âœ… Backup database button attached');
                }

                const viewLogsBtn = document.getElementById('viewLogsBtn');
                if (viewLogsBtn) {
                    viewLogsBtn.addEventListener('click', function () {
                        console.log('ðŸ“‹ View logs clicked');
                        const logsNav = document.querySelector('.nav-item[data-section="system-logs"]');
                        if (logsNav) logsNav.click();
                    });
                    console.log('âœ… View logs button attached');
                }

                const viewAllActivityBtn = document.getElementById('viewAllActivity');
                if (viewAllActivityBtn) {
                    viewAllActivityBtn.addEventListener('click', function () {
                        console.log('ðŸ“Š View all activity clicked');
                        const logsNav = document.querySelector('.nav-item[data-section="system-logs"]');
                        if (logsNav) logsNav.click();
                    });
                    console.log('âœ… View all activity button attached');
                }

                // ===== REFRESH MONITORING =====
                const refreshMonitoringBtn = document.getElementById('refreshMonitoring');
                if (refreshMonitoringBtn) {
                    refreshMonitoringBtn.addEventListener('click', async function () {
                        console.log('ðŸ”„ Refresh monitoring clicked');
                        await loadDashboardData();
                    });
                    console.log('âœ… Refresh monitoring button attached');
                }

                // ===== MEMBERS SEARCH =====
                const memberSearch = document.getElementById('memberSearch');
                if (memberSearch) {
                    memberSearch.addEventListener('input', function () {
                        console.log('ðŸ” Search input changed');
                        currentPage = 1;
                        renderMembersTable();
                    });
                    console.log('âœ… Member search attached');
                }

                // ===== FILTERS =====
                const statusFilter = document.getElementById('statusFilter');
                const memberTypeFilter = document.getElementById('memberTypeFilter');

                if (statusFilter) {
                    statusFilter.addEventListener('change', function () {
                        console.log('ðŸ”½ Status filter changed');
                        currentPage = 1;
                        renderMembersTable();
                    });
                    console.log('âœ… Status filter attached');
                }

                if (memberTypeFilter) {
                    memberTypeFilter.addEventListener('change', function () {
                        console.log('ðŸ”½ Type filter changed');
                        currentPage = 1;
                        renderMembersTable();
                    });
                    console.log('âœ… Type filter attached');
                }

                const clearFiltersBtn = document.getElementById('clearFiltersBtn');
                if (clearFiltersBtn) {
                    clearFiltersBtn.addEventListener('click', function () {
                        console.log('ðŸ§¹ Clear filters clicked');
                        if (memberSearch) memberSearch.value = '';
                        if (statusFilter) statusFilter.value = '';
                        if (memberTypeFilter) memberTypeFilter.value = '';
                        currentPage = 1;
                        renderMembersTable();
                        showNotification('Filters cleared', 'info');
                    });
                    console.log('âœ… Clear filters button attached');
                }

                // ===== PAGINATION =====
                const prevPageBtn = document.getElementById('prevPageBtn');
                const nextPageBtn = document.getElementById('nextPageBtn');

                if (prevPageBtn) {
                    prevPageBtn.addEventListener('click', function () {
                        if (currentPage > 1) {
                            console.log('â—€ï¸ Previous page clicked');
                            currentPage--;
                            renderMembersTable();
                        }
                    });
                    console.log('âœ… Previous page button attached');
                }

                if (nextPageBtn) {
                    nextPageBtn.addEventListener('click', function () {
                        const totalPages = Math.ceil(filteredMembers.length / membersPerPage);
                        if (currentPage < totalPages) {
                            console.log('â–¶ï¸ Next page clicked');
                            currentPage++;
                            renderMembersTable();
                        }
                    });
                    console.log('âœ… Next page button attached');
                }

                // ===== SELECT ALL MEMBERS =====
                const selectAllMembers = document.getElementById('selectAllMembers');
                if (selectAllMembers) {
                    selectAllMembers.addEventListener('change', function () {
                        console.log('â˜‘ï¸ Select all clicked:', this.checked);
                        document.querySelectorAll('.member-checkbox').forEach(cb => {
                            cb.checked = this.checked;
                        });
                        updateSelectedCount();
                    });
                    console.log('âœ… Select all members attached');
                }

                // ===== TABLE ACTIONS =====
                const exportSelectedBtn = document.getElementById('exportSelectedBtn');
                if (exportSelectedBtn) {
                    exportSelectedBtn.addEventListener('click', function () {
                        console.log('ðŸ“¤ Export selected clicked');
                        exportSelectedMembers();
                    });
                    console.log('âœ… Export selected button attached');
                }

                const deactivateSelectedBtn = document.getElementById('deactivateSelectedBtn');
                if (deactivateSelectedBtn) {
                    deactivateSelectedBtn.addEventListener('click', function () {
                        console.log('ðŸš« Deactivate selected clicked');
                        deactivateSelectedMembers();
                    });
                    console.log('âœ… Deactivate selected button attached');
                }

                const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
                if (deleteSelectedBtn) {
                    deleteSelectedBtn.addEventListener('click', function () {
                        console.log('ðŸ—‘ï¸ Delete selected clicked');
                        deleteSelectedMembers();
                    });
                    console.log('âœ… Delete selected button attached');
                }

                // ===== SETTINGS =====
                const saveSettingsBtn = document.getElementById('saveSettingsBtn');
                if (saveSettingsBtn) {
                    saveSettingsBtn.addEventListener('click', function () {
                        console.log('ðŸ’¾ Save settings clicked');
                        saveSettings();
                    });
                    console.log('âœ… Save settings button attached');
                }

                const backupNowBtn = document.getElementById('backupNowBtn');
                if (backupNowBtn) {
                    backupNowBtn.addEventListener('click', function () {
                        console.log('ðŸ’¾ Backup now clicked');
                        backupDatabase();
                    });
                    console.log('âœ… Backup now button attached');
                }

                const exportAllDataBtn = document.getElementById('exportAllDataBtn');
                if (exportAllDataBtn) {
                    exportAllDataBtn.addEventListener('click', function () {
                        console.log('ðŸ“¥ Export all data clicked');
                        exportAllData();
                    });
                    console.log('âœ… Export all data button attached');
                }

                // ===== SETTINGS TABS =====
                const settingsTabs = document.querySelectorAll('.settings-tab');
                settingsTabs.forEach(tab => {
                    tab.addEventListener('click', function () {
                        const tabId = this.getAttribute('data-tab');
                        console.log('ðŸ“‘ Settings tab clicked:', tabId);

                        settingsTabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');

                        document.querySelectorAll('.settings-tab-content').forEach(content => {
                            content.classList.remove('active');
                        });

                        const targetContent = document.getElementById(`${tabId}-settings`);
                        if (targetContent) targetContent.classList.add('active');
                    });
                });
                console.log('âœ… Settings tabs attached:', settingsTabs.length);

                // ===== SEND BULK REMINDERS =====
                const sendBulkRemindersBtn = document.getElementById('sendBulkRemindersBtn');
                if (sendBulkRemindersBtn) {
                    sendBulkRemindersBtn.addEventListener('click', function () {
                        console.log('ðŸ“¨ Send bulk reminders clicked');
                        sendBulkReminders();
                    });
                    console.log('âœ… Send bulk reminders button attached');
                }

                // ===== GENERATE REPORT =====
                const generateReportBtn = document.getElementById('generateReportBtn');
                if (generateReportBtn) {
                    generateReportBtn.addEventListener('click', function () {
                        console.log('ðŸ“Š Generate report clicked');
                        generateReport();
                    });
                    console.log('âœ… Generate report button attached');
                }

                // ===== CLOSE MODALS ON OUTSIDE CLICK =====
                window.addEventListener('click', function (e) {
                    if (e.target.classList.contains('modal')) {
                        console.log('âŒ Modal background clicked');
                        e.target.classList.remove('show');
                    }
                });

                // ===== CLOSE MODALS ON ESC KEY =====
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') {
                        console.log('âŒ¨ï¸ Escape key pressed');
                        document.querySelectorAll('.modal.show').forEach(modal => {
                            modal.classList.remove('show');
                        });
                    }
                });

                console.log('âœ… All event listeners attached successfully!');
            }

            // ==================== HELPER FUNCTIONS ====================

            function closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('show');
                    console.log('âœ… Modal closed:', modalId);
                }
            }

            function updatePageTitle(sectionId) {
                const titles = {
                    'admin-dashboard': { title: 'Admin Dashboard', subtitle: 'Welfare Secretary Control Panel' },
                    'manage-members': { title: 'Manage Members', subtitle: 'View and manage all registered members' },
                    'reminder-logs': { title: 'Reminder Logs', subtitle: 'View reminder delivery history' },
                    'upcoming-events': { title: 'Upcoming Celebrations', subtitle: 'View and manage upcoming events' },
                    'reports': { title: 'Reports & Analytics', subtitle: 'Generate system reports' },
                    'system-logs': { title: 'Audit Logs', subtitle: 'View system activity and audit trail' },
                    'settings': { title: 'System Settings', subtitle: 'Configure platform settings' }
                };

                const pageTitle = document.getElementById('pageTitle');
                const pageSubtitle = document.getElementById('pageSubtitle');

                if (titles[sectionId]) {
                    if (pageTitle) pageTitle.textContent = titles[sectionId].title;
                    if (pageSubtitle) pageSubtitle.textContent = titles[sectionId].subtitle;
                }
            }

            function loadSectionData(sectionId) {
                console.log('ðŸ“‚ Loading section data:', sectionId);

                switch (sectionId) {
                    case 'manage-members':
                        loadMembersData();
                        break;
                    case 'system-logs':
                        loadAuditLogs();
                        break;
                    case 'reminder-logs':
                        loadReminderLogs();
                        break;
                    case 'upcoming-events':
                        loadUpcomingEvents();
                        break;
                }
            }

            async function loadAuditLogs() {
                console.log('ðŸ“‹ Loading audit logs...');

                const tbody = document.getElementById('logsTableBody');
                if (!tbody) return;

                try {
                    const logs = await loadSystemLogsFromDB();

                    if (logs.length === 0) {
                        tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #6c757d;">
                                <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                <p>No audit logs found</p>
                            </td>
                        </tr>
                    `;
                        return;
                    }

                    tbody.innerHTML = logs.map(log => `
                    <tr>
                        <td>${new Date(log.created_at || log.timestamp).toLocaleString()}</td>
                        <td>${log.user_id || 'System'}</td>
                        <td><span class="log-action ${log.action}">${log.action || 'unknown'}</span></td>
                        <td>${log.details || 'No details'}</td>
                        <td>${log.ip_address || 'N/A'}</td>
                    </tr>
                `).join('');

                    console.log('âœ… Audit logs loaded:', logs.length);

                } catch (error) {
                    console.error('âŒ Error loading audit logs:', error);
                    tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            <p>Error loading audit logs</p>
                        </td>
                    </tr>
                `;
                }
            }

            async function loadReminderLogs() {
                console.log('ðŸ“¨ Loading reminder logs...');

                const tbody = document.getElementById('remindersTableBody');
                if (!tbody) return;

                tbody.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center; padding: 40px; color: #6c757d;">
                        <i class="fas fa-bell" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                        <p>No reminder logs yet</p>
                    </td>
                </tr>
            `;
            }

            async function loadUpcomingEvents() {
                console.log('ðŸ“… Loading upcoming events...');

                const container = document.getElementById('upcomingEventsList');
                if (!container) return;

                container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #6c757d;">
                    <i class="fas fa-calendar-alt" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                    <p>No upcoming events in the next 30 days</p>
                </div>
            `;
            }

            async function handleSaveNewMember() {
                const saveBtn = document.getElementById('saveNewMember');
                const saveText = document.getElementById('saveMemberText');
                const originalText = saveText?.textContent || 'Add Member';

                const memberData = {
                    psn_number: document.getElementById('newPsnNumber')?.value.trim(),
                    full_name: document.getElementById('newMemberName')?.value.trim(),
                    email: document.getElementById('newMemberEmail')?.value.trim(),
                    phone: document.getElementById('newMemberPhone')?.value.trim(),
                    date_of_birth: document.getElementById('newMemberDob')?.value || null,
                    password_hash: btoa(document.getElementById('newMemberPassword')?.value || 'default123'),
                    is_admin: document.getElementById('makeAdmin')?.checked || false,
                    is_active: true,
                    created_at: new Date().toISOString()
                };

                if (!memberData.psn_number || !memberData.full_name || !memberData.email || !memberData.phone) {
                    showNotification('Please fill all required fields', 'error');
                    return;
                }

                if (saveBtn) saveBtn.disabled = true;
                if (saveText) saveText.innerHTML = '<span class="spinner"></span> Saving...';

                try {
                    const result = await addMemberToDB(memberData);

                    if (result.success) {
                        showNotification(`Member ${memberData.full_name} added successfully`, 'success');
                        closeModal('addMemberModal');

                        const form = document.getElementById('addMemberForm');
                        if (form) form.reset();

                        await loadDashboardData();

                        const manageMembersSection = document.getElementById('manage-members-section');
                        if (manageMembersSection && manageMembersSection.style.display !== 'none') {
                            await loadMembersData();
                        }
                    } else {
                        showNotification(`Error: ${result.error}`, 'error');
                    }
                } catch (error) {
                    console.error('âŒ Error saving member:', error);
                    showNotification('Error saving member', 'error');
                } finally {
                    if (saveBtn) saveBtn.disabled = false;
                    if (saveText) saveText.textContent = originalText;
                }
            }

            async function exportSelectedMembers() {
                const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
                if (selectedCheckboxes.length === 0) {
                    showNotification('No members selected', 'warning');
                    return;
                }

                const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.getAttribute('data-id'));
                const selectedMembers = allMembers.filter(member =>
                    selectedIds.includes(member.id?.toString())
                );

                if (selectedMembers.length === 0) {
                    showNotification('No members found to export', 'warning');
                    return;
                }

                const csvContent = 'PSN Number,Full Name,Email,Phone,Status,Type\n' +
                    selectedMembers.map(m =>
                        `"${m.psn_number || m.psn || ''}","${m.full_name || ''}","${m.email || ''}","${m.phone || ''}","${m.is_active !== false ? 'Active' : 'Inactive'}","${m.is_admin ? 'Admin' : 'Member'}"`
                    ).join('\n');

                downloadCSV(csvContent, `selected-members-${new Date().toISOString().split('T')[0]}.csv`);
                showNotification(`Exported ${selectedMembers.length} members`, 'success');
            }

            async function deactivateSelectedMembers() {
                const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
                if (selectedCheckboxes.length === 0) {
                    showNotification('No members selected', 'warning');
                    return;
                }

                if (!confirm(`Deactivate ${selectedCheckboxes.length} selected member(s)?`)) return;

                const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.getAttribute('data-id'));
                let updatedCount = 0;

                for (const memberId of selectedIds) {
                    const result = await updateMemberInDB(memberId, { is_active: false });
                    if (result.success) updatedCount++;
                }

                await loadMembersData();
                await loadDashboardData();
                showNotification(`${updatedCount} member(s) deactivated`, 'success');
            }

            async function deleteSelectedMembers() {
                const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
                if (selectedCheckboxes.length === 0) {
                    showNotification('No members selected', 'warning');
                    return;
                }

                if (!confirm(`Permanently delete ${selectedCheckboxes.length} selected member(s)? This cannot be undone.`)) return;

                const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.getAttribute('data-id'));
                let deletedCount = 0;

                for (const memberId of selectedIds) {
                    const result = await deleteMemberFromDB(memberId);
                    if (result.success) deletedCount++;
                }

                await loadMembersData();
                await loadDashboardData();
                showNotification(`${deletedCount} member(s) deleted`, 'success');
            }

            function quickExportData() {
                const exportData = {
                    summary: {
                        total_members: document.getElementById('totalMembers')?.textContent || '0',
                        active_members: document.getElementById('activeMembers')?.textContent || '0',
                        export_date: new Date().toISOString()
                    },
                    system_status: {
                        database: document.getElementById('dbConnection')?.textContent || 'Unknown',
                        health: document.getElementById('systemHealth')?.textContent || 'Unknown'
                    }
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `psn-quick-export-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showNotification('Quick export downloaded', 'success');
            }

            async function backupDatabase() {
                const backupBtn = document.getElementById('backupNowBtn') || document.getElementById('backupDatabaseBtn');
                const backupText = document.getElementById('backupText');
                const originalText = backupText?.textContent || 'Create Backup';

                if (backupBtn) backupBtn.disabled = true;
                if (backupText) backupText.innerHTML = '<span class="spinner"></span> Backing up...';

                try {
                    const members = await loadMembersFromDB();
                    const logs = await loadSystemLogsFromDB();

                    const backupData = {
                        timestamp: new Date().toISOString(),
                        members: members,
                        logs: logs,
                        version: '1.0'
                    };

                    const dataStr = JSON.stringify(backupData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `psn-backup-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);

                    await logSystemAction('backup', 'Created database backup');
                    showNotification('Database backup created and downloaded', 'success');

                } catch (error) {
                    console.error('âŒ Error creating backup:', error);
                    showNotification('Error creating backup', 'error');
                } finally {
                    if (backupBtn) backupBtn.disabled = false;
                    if (backupText) backupText.textContent = originalText;
                }
            }

            function exportAllData() {
                console.log('ðŸ“¥ Exporting all data...');

                const csvContent = 'PSN Number,Full Name,Email,Phone,Status,Type,Registered\n' +
                    allMembers.map(m =>
                        `"${m.psn_number || m.psn || ''}","${m.full_name || ''}","${m.email || ''}","${m.phone || ''}","${m.is_active !== false ? 'Active' : 'Inactive'}","${m.is_admin ? 'Admin' : 'Member'}","${m.created_at ? new Date(m.created_at).toLocaleDateString() : ''}"`
                    ).join('\n');

                downloadCSV(csvContent, `psn-all-members-${new Date().toISOString().split('T')[0]}.csv`);
                showNotification('All data exported to CSV', 'success');
            }

            function downloadCSV(content, filename) {
                const blob = new Blob([content], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }

            function saveSettings() {
                const platformName = document.getElementById('platformName')?.value || '';
                const welfareSecretary = document.getElementById('welfareSecretary')?.value || '';
                const contactEmail = document.getElementById('contactEmail')?.value || '';

                const settings = {
                    platformName,
                    welfareSecretary,
                    contactEmail,
                    updated_at: new Date().toISOString()
                };

                localStorage.setItem('psn_settings', JSON.stringify(settings));
                showNotification('Settings saved successfully', 'success');
                logSystemAction('settings_update', 'Updated system settings');
            }

            async function sendBulkReminders() {
                showNotification('Bulk reminders feature coming soon', 'info');
            }

            function generateReport() {
                showNotification('Report generation feature coming soon', 'info');
            }

            // ==================== âœ… MAIN INITIALIZATION ====================

            document.addEventListener('DOMContentLoaded', async function () {
                console.log('ðŸš€ DOM Content Loaded - Initializing Admin Dashboard...');

                // Check authentication
                if (!requireAuth()) {
                    console.error('âŒ Authentication failed');
                    return;
                }

                // Initialize Supabase
                const supabaseInitialized = initSupabase();
                console.log('ðŸ“Š Supabase initialized:', supabaseInitialized);

                // Load user info
                const user = getCurrentUser();
                if (user) {
                    const adminName = document.getElementById('adminName');
                    const adminPsn = document.getElementById('adminPsn');

                    if (adminName) adminName.textContent = user.full_name || user.name || 'Admin User';
                    if (adminPsn) adminPsn.textContent = user.psn_number || user.psn || 'System Administrator';

                    console.log('ðŸ‘¤ User loaded:', user.full_name || user.email);
                }

                // Attach all event listeners
                attachAllEventListeners();

                // Load initial dashboard data
                await loadDashboardData();

                console.log('âœ… Admin Dashboard fully initialized and ready!');
                showNotification('Admin dashboard loaded successfully', 'success');
            });

            console.log('âœ… Admin Dashboard Script Loaded Successfully');
        </script>
    </body>
    
    </html>
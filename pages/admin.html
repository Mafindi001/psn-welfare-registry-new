<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - PSN Taraba Welfare Registry</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet" href="../styles/admin.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Include Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        /* Enhanced Mobile Responsive Styles */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }

            .dashboard-sidebar {
                width: 100%;
                height: 100vh;
                position: fixed;
                top: 0;
                left: -100%;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
                overflow-y: auto;
            }

            .dashboard-sidebar.mobile-open {
                left: 0;
            }

            .dashboard-main {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }

            .header-actions {
                flex-direction: column;
                gap: 10px;
                margin-top: 15px;
            }

            .header-actions .btn {
                width: 100%;
            }

            .admin-stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .quick-actions-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .reports-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .monitoring-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .modal-content {
                width: 95%;
                margin: 20px auto;
                max-height: 90vh;
                overflow-y: auto;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .settings-tabs {
                flex-wrap: wrap;
            }

            .settings-tab {
                flex: 1 0 50%;
                padding: 10px;
                text-align: center;
            }

            .mobile-close {
                display: block !important;
                position: absolute;
                right: 15px;
                top: 15px;
                background: rgba(255, 255, 255, 0.2);
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1001;
            }

            .sidebar-header {
                padding-right: 60px;
            }

            .table-actions {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .action-buttons {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }

            .filter-bar {
                flex-direction: column;
                gap: 10px;
            }

            .date-range {
                flex-direction: column;
                gap: 10px;
            }

            .date-range input {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .admin-stats-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions-grid {
                grid-template-columns: 1fr;
            }

            .reminder-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .header-controls {
                flex-direction: column;
                gap: 10px;
            }

            .header-title {
                margin-bottom: 15px;
            }

            .filter-bar {
                flex-direction: column;
                gap: 10px;
            }

            .date-range {
                flex-direction: column;
            }

            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .action-buttons .btn {
                width: 100%;
            }
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary-color, #2c5aa0);
            cursor: pointer;
            padding: 10px;
            margin-right: 10px;
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
        }

        /* Mobile Overlay */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            backdrop-filter: blur(3px);
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Touch-friendly elements */
        .btn,
        button,
        .nav-item,
        .quick-action-btn,
        .pagination-btn,
        .settings-tab {
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        input,
        select {
            font-size: 16px;
            padding: 12px;
            border-radius: 8px;
        }

        /* Loading states */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Password toggle styles */
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 5px;
            font-size: 1rem;
            z-index: 10;
        }

        .password-toggle:hover {
            color: #2c5aa0;
        }

        .form-group {
            position: relative;
        }

        .form-control[type="password"],
        .form-control[type="text"] {
            padding-right: 40px;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1100;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
            border-radius: 12px 12px 0 0;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            position: sticky;
            bottom: 0;
            background: white;
            z-index: 1;
            border-radius: 0 0 12px 12px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            color: #333;
            background-color: #f5f5f5;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .notification-success {
            background: #28a745;
            border-left: 4px solid #1e7e34;
        }

        .notification-error {
            background: #dc3545;
            border-left: 4px solid #bd2130;
        }

        .notification-warning {
            background: #ffc107;
            border-left: 4px solid #d39e00;
            color: #212529;
        }

        .notification-info {
            background: #17a2b8;
            border-left: 4px solid #117a8b;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-hide {
            animation: slideOut 0.3s ease forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Status badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .type-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .type-badge.member {
            background: #e3f2fd;
            color: #1565c0;
        }

        .type-badge.admin {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        /* Enhanced button styles */
        .btn {
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #2c5aa0, #3a7bd5);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #2c5aa0;
            color: #2c5aa0;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.875rem;
        }

        /* Enhanced table styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .data-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* Enhanced form styles */
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #2c5aa0;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Enhanced card styles */
        .admin-stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border: 1px solid #e0e0e0;
        }

        .admin-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .quick-action-btn {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action-btn:hover {
            border-color: #2c5aa0;
            background: #f8faff;
            transform: translateY(-3px);
        }

        .action-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #2c5aa0, #3a7bd5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        /* Enhanced sidebar styles */
        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #495057;
            text-decoration: none;
            border-radius: 8px;
            margin: 5px 15px;
            transition: all 0.3s ease;
        }

        .nav-item:hover {
            background: rgba(44, 90, 160, 0.1);
            color: #2c5aa0;
        }

        .nav-item.active {
            background: #2c5aa0;
            color: white;
        }

        .nav-badge {
            margin-left: auto;
            background: #dc3545;
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            min-width: 25px;
            text-align: center;
        }

        /* Enhanced section headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .section-header h2 {
            margin: 0;
            color: #2c5aa0;
            font-size: 1.5rem;
        }

        /* Enhanced search box */
        .search-box {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .search-box input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        /* Enhanced filter bar */
        .filter-bar {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            font-size: 16px;
            min-width: 150px;
        }

        /* Enhanced pagination */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }

        .pagination-btn {
            width: 40px;
            height: 40px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            border-color: #2c5aa0;
            background: #f8faff;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Enhanced settings */
        .settings-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .settings-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .settings-tab:hover {
            color: #2c5aa0;
            background: rgba(44, 90, 160, 0.1);
        }

        .settings-tab.active {
            color: #2c5aa0;
            background: white;
            border-bottom: 3px solid #2c5aa0;
        }

        .settings-group {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .settings-group h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2c5aa0;
            font-size: 1.3rem;
        }

        .setting-item {
            margin-bottom: 20px;
        }

        .setting-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .consent-group {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .consent-group input[type="checkbox"] {
            margin-top: 5px;
        }

        .consent-text {
            flex: 1;
        }

        .consent-text label {
            margin-bottom: 0;
            cursor: pointer;
        }

        /* Activity feed */
        .activity-feed {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            background: #f8f9fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c5aa0;
            font-size: 1.2rem;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            margin: 0 0 5px 0;
            color: #495057;
        }

        .activity-time {
            margin: 0;
            font-size: 0.875rem;
            color: #6c757d;
        }

        /* Report preview */
        .report-preview {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 2px dashed #e0e0e0;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .preview-content {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            min-height: 200px;
        }

        /* Calendar */
        .calendar-view {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav {
            background: none;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-nav:hover {
            border-color: #2c5aa0;
            background: #f8faff;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            background: #f8faff;
            border-color: #2c5aa0;
        }

        .calendar-day.event {
            background: #e3f2fd;
            border-color: #1565c0;
        }

        /* Alert styles */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #117a8b;
            color: #0c5460;
        }

        /* Database info */
        .db-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        /* Log action styles */
        .log-action {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: capitalize;
            display: inline-block;
        }

        .log-action.login {
            background: #d4edda;
            color: #155724;
        }

        .log-action.logout {
            background: #cce5ff;
            color: #004085;
        }

        .log-action.registration {
            background: #d1ecf1;
            color: #0c5460;
        }

        .log-action.update {
            background: #fff3cd;
            color: #856404;
        }

        .log-action.delete {
            background: #f8d7da;
            color: #721c24;
        }

        .log-action.member_add {
            background: #e3f2fd;
            color: #1565c0;
        }

        .log-action.member_update {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .log-action.member_delete {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="dashboard-sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="mobile-close" id="mobileCloseBtn"
                    style="display: none; background: none; border: none; color: white; font-size: 1.5rem; margin-left: auto;">
                    <i class="fas fa-times"></i>
                </button>
                <div class="sidebar-logo admin-logo">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div>
                    <h3 style="margin: 0; font-size: 1.1rem;">PSN Admin</h3>
                    <p style="margin: 0; font-size: 0.8rem; color: var(--text-light);">Welfare Registry</p>
                </div>
            </div>

            <div class="sidebar-user admin-user">
                <p class="user-greeting">Welfare Secretary</p>
                <h2 class="user-name" id="adminName">Loading...</h2>
                <p class="user-psn" id="adminPsn">Loading...</p>
            </div>

            <nav class="sidebar-nav">
                <a href="#admin-dashboard" class="nav-item active" data-section="admin-dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#manage-members" class="nav-item" data-section="manage-members">
                    <i class="fas fa-users"></i>
                    <span>Manage Members</span>
                    <span class="nav-badge" id="membersCount">0</span>
                </a>
                <a href="#reminder-logs" class="nav-item" data-section="reminder-logs">
                    <i class="fas fa-bell"></i>
                    <span>Reminder Logs</span>
                    <span class="nav-badge" id="remindersCount">0</span>
                </a>
                <a href="#upcoming-events" class="nav-item" data-section="upcoming-events">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Upcoming Events</span>
                    <span class="nav-badge" id="eventsCount">0</span>
                </a>
                <a href="#reports" class="nav-item" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="#system-logs" class="nav-item" data-section="system-logs">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Audit Logs</span>
                </a>
                <a href="#settings" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>System Settings</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <a href="../pages/dashboard.html" class="btn btn-outline"
                    style="margin-bottom: 0.5rem; display: block; text-align: center;">
                    <i class="fas fa-user"></i> Switch to Member View
                </a>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="dashboard-main">
            <!-- Header with Mobile Menu Toggle -->
            <header class="dashboard-header">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="header-title">
                    <h1 id="pageTitle">Admin Dashboard</h1>
                    <p id="pageSubtitle" style="color: var(--text-light); margin: 0.5rem 0 0; font-size: 0.95rem;">
                        Welfare Secretary Control Panel
                    </p>
                </div>

                <div class="header-actions">
                    <button class="btn btn-primary" id="refreshDataBtn">
                        <i class="fas fa-sync-alt"></i> <span id="refreshText">Refresh Data</span>
                    </button>
                    <button class="btn btn-secondary" id="quickExportBtn">
                        <i class="fas fa-download"></i> Quick Export
                    </button>
                </div>
            </header>

            <!-- Dashboard Overview Section -->
            <section class="dashboard-section active-section" id="admin-dashboard-section">
                <div class="section-header">
                    <h2>System Overview</h2>
                    <div class="last-updated">
                        <i class="fas fa-clock"></i>
                        Last updated: <span id="lastUpdated">Just now</span>
                    </div>
                </div>

                <!-- Admin Stats Grid -->
                <div class="admin-stats-grid">
                    <div class="admin-stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalMembers">0</h3>
                            <p>Total Members</p>
                            <div class="stat-trend">
                                <i class="fas fa-database"></i>
                                <span>Live Database</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-birthday-cake"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="upcomingCelebrations">0</h3>
                            <p>Upcoming Celebrations</p>
                            <div class="stat-trend">
                                <i class="fas fa-calendar"></i>
                                <span>Next 30 days</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="remindersSent">0</h3>
                            <p>Reminders Sent</p>
                            <div class="stat-trend">
                                <i class="fas fa-check-circle"></i>
                                <span>Database Stored</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeMembers">0</h3>
                            <p>Active Members</p>
                            <div class="stat-trend">
                                <i class="fas fa-chart-line"></i>
                                <span>Real-time Data</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Monitoring -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h2>Database Status</h2>
                        <div class="monitoring-controls">
                            <button class="btn btn-outline btn-sm" id="refreshMonitoring">
                                <i class="fas fa-sync-alt"></i> <span id="monitoringText">Refresh</span>
                            </button>
                        </div>
                    </div>

                    <div class="monitoring-grid">
                        <div class="monitoring-card">
                            <h4>Database Connection</h4>
                            <div class="monitoring-value" id="dbConnection">Checking...</div>
                            <div class="monitoring-list" id="dbStatusList">
                                <div class="metric">
                                    <span>Tables Count</span>
                                    <span class="metric-value" id="tablesCount">0</span>
                                </div>
                                <div class="metric">
                                    <span>Last Sync</span>
                                    <span class="metric-value" id="lastSync">Never</span>
                                </div>
                            </div>
                        </div>

                        <div class="monitoring-card">
                            <h4>System Health</h4>
                            <div class="health-indicator">
                                <div class="health-status" id="systemHealth">Checking...</div>
                                <div class="health-metrics">
                                    <div class="metric">
                                        <span>API Status</span>
                                        <span class="metric-value" id="apiStatus">Checking</span>
                                    </div>
                                    <div class="metric">
                                        <span>Storage</span>
                                        <span class="metric-value" id="storageStatus">Unknown</span>
                                    </div>
                                    <div class="metric">
                                        <span>Backup</span>
                                        <span class="metric-value" id="backupStatus">None</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Quick Actions</h2>
                </div>

                <div class="quick-actions-grid">
                    <button class="quick-action-btn" id="addMemberBtn">
                        <div class="action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <span>Add New Member</span>
                    </button>

                    <button class="quick-action-btn" id="sendAnnouncementBtn">
                        <div class="action-icon">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <span>Send Announcement</span>
                    </button>

                    <button class="quick-action-btn" id="backupDatabaseBtn">
                        <div class="action-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <span>Backup Database</span>
                    </button>

                    <button class="quick-action-btn" id="viewLogsBtn">
                        <div class="action-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <span>View System Logs</span>
                    </button>
                </div>

                <!-- Recent Activity -->
                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Recent Activity</h2>
                    <button class="btn btn-outline btn-sm" id="viewAllActivity">
                        View All
                    </button>
                </div>

                <div class="activity-feed" id="activityFeed">
                    <!-- Activity will be loaded from database -->
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">
                                <strong>Database Connected:</strong> System ready for live data
                            </p>
                            <p class="activity-time">Just now</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Manage Members Section -->
            <section class="dashboard-section" id="manage-members-section" style="display: none;">
                <div class="section-header">
                    <h2>Manage Members</h2>
                    <div class="header-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="memberSearch" placeholder="Search members by name, PSN, or email...">
                        </div>
                        <button class="btn btn-primary" id="addNewMemberBtn">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filter-bar">
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>

                    <select id="memberTypeFilter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="member">Regular Member</option>
                        <option value="admin">Admin</option>
                    </select>

                    <button class="btn btn-outline btn-sm" id="clearFiltersBtn">
                        <i class="fas fa-times"></i> Clear Filters
                    </button>
                </div>

                <!-- Members Table -->
                <div class="table-responsive">
                    <table class="data-table" id="membersTable">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllMembers">
                                </th>
                                <th>PSN Number</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Type</th>
                                <th>Registered</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <!-- Members will be loaded from database -->
                            <tr id="loadingRow">
                                <td colspan="9" style="text-align: center; padding: 40px;">
                                    <div class="spinner"></div> Loading members from database...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Table Actions -->
                <div class="table-actions">
                    <div class="selected-count">
                        <span id="selectedCount">0</span> members selected
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-outline btn-sm" id="exportSelectedBtn" disabled>
                            <i class="fas fa-download"></i> Export Selected
                        </button>
                        <button class="btn btn-outline btn-sm" id="deactivateSelectedBtn" disabled>
                            <i class="fas fa-user-slash"></i> Deactivate
                        </button>
                        <button class="btn btn-outline btn-sm btn-danger" id="deleteSelectedBtn" disabled>
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="membersPagination">
                    <button class="pagination-btn" disabled id="prevPageBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="pagination-info">Page <span id="currentPage">1</span> of <span
                            id="totalPages">1</span></span>
                    <button class="pagination-btn" disabled id="nextPageBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </section>

            <!-- Reminder Logs Section -->
            <section class="dashboard-section" id="reminder-logs-section" style="display: none;">
                <div class="section-header">
                    <h2>Reminder Logs</h2>
                    <div class="header-controls">
                        <div class="date-range">
                            <input type="date" id="reminderStartDate" class="date-input">
                            <span>to</span>
                            <input type="date" id="reminderEndDate" class="date-input">
                            <button class="btn btn-outline btn-sm" id="applyDateRange">
                                Apply
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reminder Stats -->
                <div class="reminder-stats">
                    <div class="reminder-stat">
                        <h3 id="totalReminders">0</h3>
                        <p>Total Sent</p>
                    </div>
                    <div class="reminder-stat">
                        <h3 id="successfulReminders">0</h3>
                        <p>Successful</p>
                    </div>
                    <div class="reminder-stat">
                        <h3 id="failedReminders">0</h3>
                        <p>Failed</p>
                    </div>
                    <div class="reminder-stat">
                        <h3 id="pendingReminders">0</h3>
                        <p>Pending</p>
                    </div>
                </div>

                <!-- Reminder Logs Table -->
                <div class="table-responsive">
                    <table class="data-table" id="remindersTable">
                        <thead>
                            <tr>
                                <th>Sent Date</th>
                                <th>Recipient</th>
                                <th>Event</th>
                                <th>Event Date</th>
                                <th>Status</th>
                                <th>Type</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="remindersTableBody">
                            <!-- Reminder logs will be loaded from database -->
                            <tr id="loadingReminders">
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    <div class="spinner"></div> Loading reminder logs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Upcoming Events Section -->
            <section class="dashboard-section" id="upcoming-events-section" style="display: none;">
                <div class="section-header">
                    <h2>Upcoming Celebrations</h2>
                    <button class="btn btn-primary" id="sendBulkRemindersBtn">
                        <i class="fas fa-bell"></i> Send Bulk Reminders
                    </button>
                </div>

                <!-- Events Calendar View -->
                <div class="calendar-view">
                    <div class="calendar-header">
                        <button class="calendar-nav" id="prevMonth">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="currentMonth">Loading...</h3>
                        <button class="calendar-nav" id="nextMonth">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be generated from database -->
                        <div style="text-align: center; padding: 40px; grid-column: span 7;">
                            <div class="spinner"></div> Loading calendar...
                        </div>
                    </div>
                </div>

                <!-- Upcoming Events List -->
                <div class="upcoming-events-list" id="upcomingEventsList">
                    <!-- Events will be loaded from database -->
                    <div style="text-align: center; padding: 40px;">
                        <div class="spinner"></div> Loading upcoming events...
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section class="dashboard-section" id="reports-section" style="display: none;">
                <div class="section-header">
                    <h2>Reports & Analytics</h2>
                    <button class="btn btn-primary" id="generateReportBtn">
                        <i class="fas fa-file-export"></i> Generate Report
                    </button>
                </div>

                <!-- Report Types -->
                <div class="reports-grid">
                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Member Demographics</h3>
                        <p>Age, gender, location analysis</p>
                        <button class="btn btn-outline btn-sm" data-report="demographics">
                            Generate
                        </button>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-birthday-cake"></i>
                        </div>
                        <h3>Celebration Calendar</h3>
                        <p>Monthly celebration schedule</p>
                        <button class="btn btn-outline btn-sm" data-report="calendar">
                            Generate
                        </button>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <h3>Reminder Analytics</h3>
                        <p>Delivery rates and patterns</p>
                        <button class="btn btn-outline btn-sm" data-report="reminders">
                            Generate
                        </button>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Growth Report</h3>
                        <p>Member registration trends</p>
                        <button class="btn btn-outline btn-sm" data-report="growth">
                            Generate
                        </button>
                    </div>
                </div>

                <!-- Report Preview Area -->
                <div class="report-preview" id="reportPreview" style="display: none;">
                    <div class="preview-header">
                        <h3>Report Preview</h3>
                        <div>
                            <select id="reportFormat" class="form-control"
                                style="display: inline-block; width: auto; margin-right: 10px;">
                                <option value="pdf">PDF</option>
                                <option value="csv">CSV</option>
                                <option value="excel">Excel</option>
                            </select>
                            <button class="btn btn-primary btn-sm" id="downloadReportBtn">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    </div>
                    <div class="preview-content" id="reportContent">
                        <!-- Report content will appear here -->
                    </div>
                </div>
            </section>

            <!-- System Logs Section -->
            <section class="dashboard-section" id="system-logs-section" style="display: none;">
                <div class="section-header">
                    <h2>System Audit Logs</h2>
                    <div class="log-filters">
                        <select id="logTypeFilter" class="filter-select">
                            <option value="">All Actions</option>
                            <option value="login">Logins</option>
                            <option value="registration">Registrations</option>
                            <option value="update">Updates</option>
                            <option value="delete">Deletions</option>
                        </select>
                        <input type="text" id="logSearch" class="search-input" placeholder="Search logs...">
                    </div>
                </div>

                <!-- Logs Table -->
                <div class="table-responsive">
                    <table class="data-table" id="logsTable">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Details</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <!-- Logs will be loaded from database -->
                            <tr id="loadingLogs">
                                <td colspan="5" style="text-align: center; padding: 40px;">
                                    <div class="spinner"></div> Loading audit logs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- System Settings Section -->
            <section class="dashboard-section" id="settings-section" style="display: none;">
                <div class="section-header">
                    <h2>System Settings</h2>
                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> <span id="saveSettingsText">Save Settings</span>
                    </button>
                </div>

                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">General</button>
                    <button class="settings-tab" data-tab="email">Email Settings</button>
                    <button class="settings-tab" data-tab="security">Security</button>
                    <button class="settings-tab" data-tab="database">Database</button>
                </div>

                <!-- General Settings -->
                <div class="settings-tab-content active" id="general-settings">
                    <div class="settings-group">
                        <h3>Platform Settings</h3>

                        <div class="setting-item">
                            <label for="platformName">Platform Name</label>
                            <input type="text" id="platformName" class="form-control"
                                value="PSN Taraba Welfare Registry">
                        </div>

                        <div class="setting-item">
                            <label for="welfareSecretary">Welfare Secretary Name</label>
                            <input type="text" id="welfareSecretary" class="form-control"
                                value="Dr. Pharmacist Welfare">
                        </div>

                        <div class="setting-item">
                            <label for="contactEmail">Contact Email</label>
                            <input type="email" id="contactEmail" class="form-control" value="welfare@psntaraba.org.ng">
                        </div>

                        <div class="setting-item">
                            <label for="reminderTime">Default Reminder Time</label>
                            <select id="reminderTime" class="form-control">
                                <option value="24">24 hours before</option>
                                <option value="48">48 hours before</option>
                                <option value="72">72 hours before</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Email Settings -->
                <div class="settings-tab-content" id="email-settings">
                    <div class="settings-group">
                        <h3>Email Configuration</h3>

                        <div class="setting-item">
                            <label for="smtpHost">SMTP Host</label>
                            <input type="text" id="smtpHost" class="form-control" value="smtp.gmail.com">
                        </div>

                        <div class="setting-item">
                            <label for="smtpPort">SMTP Port</label>
                            <input type="number" id="smtpPort" class="form-control" value="587">
                        </div>

                        <div class="setting-item">
                            <label for="smtpUser">SMTP Username</label>
                            <input type="text" id="smtpUser" class="form-control" value="welfare@psntaraba.org.ng">
                        </div>

                        <div class="setting-item">
                            <label for="smtpPass">SMTP Password</label>
                            <div style="position: relative;">
                                <input type="password" id="smtpPass" class="form-control" placeholder="Enter password">
                                <button type="button" class="password-toggle" id="smtpPasswordToggle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="consent-group">
                                <input type="checkbox" id="emailNotifications" checked>
                                <div class="consent-text">
                                    <label for="emailNotifications">Enable email notifications</label>
                                </div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <button class="btn btn-outline" id="testEmailBtn">
                                <i class="fas fa-paper-plane"></i> Test Email Configuration
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="settings-tab-content" id="security-settings">
                    <div class="settings-group">
                        <h3>Security & Access Control</h3>

                        <div class="setting-item">
                            <div class="consent-group">
                                <input type="checkbox" id="require2FA">
                                <div class="consent-text">
                                    <label for="require2FA">Require two-factor authentication for admins</label>
                                </div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label for="sessionTimeout">Session Timeout (minutes)</label>
                            <input type="number" id="sessionTimeout" class="form-control" value="60" min="15" max="480">
                        </div>

                        <div class="setting-item">
                            <label for="maxLoginAttempts">Max Login Attempts</label>
                            <input type="number" id="maxLoginAttempts" class="form-control" value="5" min="1" max="10">
                        </div>

                        <button class="btn btn-outline" id="viewAccessLogsBtn">
                            <i class="fas fa-shield-alt"></i> View Access Logs
                        </button>
                    </div>
                </div>

                <!-- Database Settings -->
                <div class="settings-tab-content" id="database-settings">
                    <div class="settings-group">
                        <h3>Database Management</h3>

                        <div class="setting-item">
                            <label>Database Status</label>
                            <div class="db-status-indicator">
                                <span class="status-dot" id="dbStatusDot"></span>
                                <span id="dbStatusText">Checking...</span>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label>Last Backup</label>
                            <p id="lastBackup">No backups yet</p>
                        </div>

                        <div class="setting-item">
                            <label>Total Members</label>
                            <p id="dbTotalMembers">0</p>
                        </div>

                        <div class="setting-actions">
                            <button class="btn btn-primary" id="backupNowBtn">
                                <i class="fas fa-database"></i> <span id="backupText">Create Backup</span>
                            </button>
                            <button class="btn btn-outline" id="exportAllDataBtn">
                                <i class="fas fa-file-export"></i> Export All Data
                            </button>
                            <button class="btn btn-outline btn-danger" id="resetDemoBtn">
                                <i class="fas fa-trash"></i> Clear All Data
                            </button>
                        </div>

                        <!-- Database Info -->
                        <div class="database-info-section">
                            <h4>Database Information</h4>
                            <div class="db-info">
                                <div class="info-row">
                                    <span>Provider:</span>
                                    <span>Supabase (PostgreSQL)</span>
                                </div>
                                <div class="info-row">
                                    <span>Tables:</span>
                                    <span id="dbTablesInfo">5 tables</span>
                                </div>
                                <div class="info-row">
                                    <span>Connection:</span>
                                    <span id="dbConnectionInfo">Secure HTTPS</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Member Modal -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Add New Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMemberForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newPsnNumber">PSN Number *</label>
                            <input type="text" id="newPsnNumber" class="form-control" required>
                            <div class="form-text" id="psnValidation"></div>
                        </div>
                        <div class="form-group">
                            <label for="newMemberEmail">Email *</label>
                            <input type="email" id="newMemberEmail" class="form-control" required>
                            <div class="form-text" id="emailValidation"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newMemberName">Full Name *</label>
                        <input type="text" id="newMemberName" class="form-control" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="newMemberPhone">Phone Number *</label>
                            <input type="tel" id="newMemberPhone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newMemberDob">Date of Birth</label>
                            <input type="date" id="newMemberDob" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newMemberPassword">Temporary Password *</label>
                        <div style="position: relative;">
                            <input type="password" id="newMemberPassword" class="form-control" required minlength="6">
                            <button type="button" class="password-toggle" id="newMemberPasswordToggle">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <div class="form-text">Minimum 6 characters. Member will change on first login</div>
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="makeAdmin">
                            <div class="consent-text">
                                <label for="makeAdmin">Grant administrative privileges</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="sendWelcomeEmail" checked>
                            <div class="consent-text">
                                <label for="sendWelcomeEmail">Send welcome email with login instructions</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelAddMember">Cancel</button>
                <button class="btn btn-primary" id="saveNewMember">
                    <span id="saveMemberText">Add Member</span>
                </button>
            </div>
        </div>
    </div>

    <!-- View Member Modal -->
    <div class="modal" id="viewMemberModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Member Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="memberDetailsContent">
                    <!-- Member details will be loaded from database -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeMemberModal">Close</button>
                <button class="btn btn-primary" id="editMemberBtn">Edit Member</button>
            </div>
        </div>
    </div>

    <!-- Database Config Modal -->
    <div class="modal" id="dbConfigModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Database Configuration Required</h3>
            </div>
            <div class="modal-body">
                <p>To use the permanent database features, you need to configure your Supabase credentials.</p>

                <div class="form-group">
                    <label for="supabaseUrl">Supabase URL *</label>
                    <input type="text" id="supabaseUrl" class="form-control"
                        placeholder="https://your-project.supabase.co">
                </div>

                <div class="form-group">
                    <label for="supabaseKey">Supabase Anon Key *</label>
                    <input type="text" id="supabaseKey" class="form-control" placeholder="eyJhbGciOiJIUzI1NiIs...">
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <p>Get these credentials from your Supabase project dashboard  Settings  API</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveDbConfig">Save Configuration</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // ==================== SUPABASE CONFIGURATION ====================
        const SUPABASE_CONFIG = {
            url: localStorage.getItem('supabase_url') || '',
            key: localStorage.getItem('supabase_key') || '',
            tables: {
                members: 'members',
                events: 'events',
                reminders: 'reminder_logs',
                logs: 'system_logs',
                settings: 'system_settings'
            }
        };

        // Initialize Supabase client
        let supabase = null;
        let isDatabaseConnected = false;

        function initSupabase() {
            if (!SUPABASE_CONFIG.url || !SUPABASE_CONFIG.key) {
                console.warn('Supabase credentials not configured');
                showNotification('Database not configured. Using local storage only.', 'warning');
                return false;
            }

            try {
                supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                console.log('Supabase client initialized');
                return true;
            } catch (error) {
                console.error('Failed to initialize Supabase:', error);
                showNotification('Failed to connect to database', 'error');
                return false;
            }
        }

        // ==================== DATABASE FUNCTIONS ====================

        async function testDatabaseConnection() {
            if (!supabase) return false;

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .select('count', { count: 'exact', head: true });

                if (error) throw error;
                isDatabaseConnected = true;
                return true;
            } catch (error) {
                console.error('Database connection test failed:', error);
                isDatabaseConnected = false;
                return false;
            }
        }

        async function loadMembersFromDB() {
            if (!supabase) {
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                return members;
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Error loading members:', error);
                showNotification('Failed to load members from database', 'error');
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                return members;
            }
        }

        async function addMemberToDB(memberData) {
            if (!supabase) {
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                memberData.id = Date.now().toString();
                memberData.created_at = new Date().toISOString();
                members.push(memberData);
                localStorage.setItem('psn_members', JSON.stringify(members));

                // Log the action
                const logs = JSON.parse(localStorage.getItem('psn_logs') || '[]');
                logs.unshift({
                    user_id: getCurrentUser()?.id || 'admin',
                    action: 'member_add',
                    details: `Added new member: ${memberData.full_name}`,
                    ip_address: '127.0.0.1',
                    created_at: new Date().toISOString()
                });
                localStorage.setItem('psn_logs', JSON.stringify(logs));

                return { success: true, data: memberData };
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .insert([memberData])
                    .select()
                    .single();

                if (error) throw error;
                await logSystemAction('member_add', `Added member: ${memberData.full_name}`);
                return { success: true, data };
            } catch (error) {
                console.error('Error adding member:', error);
                return { success: false, error: error.message };
            }
        }

        async function updateMemberInDB(id, updates) {
            if (!supabase) {
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                const index = members.findIndex(m => m.id === id);
                if (index !== -1) {
                    members[index] = { ...members[index], ...updates };
                    localStorage.setItem('psn_members', JSON.stringify(members));
                }
                return { success: true };
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .update(updates)
                    .eq('id', id)
                    .select()
                    .single();

                if (error) throw error;
                await logSystemAction('member_update', `Updated member: ${id}`);
                return { success: true, data };
            } catch (error) {
                console.error('Error updating member:', error);
                return { success: false, error: error.message };
            }
        }

        async function deleteMemberFromDB(id) {
            if (!supabase) {
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                const filtered = members.filter(m => m.id !== id);
                localStorage.setItem('psn_members', JSON.stringify(filtered));
                return { success: true };
            }

            try {
                const { error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                await logSystemAction('member_delete', `Deleted member: ${id}`);
                return { success: true };
            } catch (error) {
                console.error('Error deleting member:', error);
                return { success: false, error: error.message };
            }
        }

        async function loadSystemLogsFromDB() {
            if (!supabase) {
                const logs = JSON.parse(localStorage.getItem('psn_logs') || '[]');
                return logs;
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.logs)
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(100);

                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Error loading logs:', error);
                const logs = JSON.parse(localStorage.getItem('psn_logs') || '[]');
                return logs;
            }
        }

        async function logSystemAction(action, details) {
            const user = getCurrentUser();
            if (!user) return;

            const logEntry = {
                user_id: user.id,
                action: action,
                details: details,
                ip_address: await getClientIP(),
                created_at: new Date().toISOString()
            };

            if (!supabase) {
                const logs = JSON.parse(localStorage.getItem('psn_logs') || '[]');
                logs.unshift(logEntry);
                localStorage.setItem('psn_logs', JSON.stringify(logs));
                return;
            }

            try {
                await supabase
                    .from(SUPABASE_CONFIG.tables.logs)
                    .insert([logEntry]);
            } catch (error) {
                console.error('Error logging action:', error);
            }
        }

        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch {
                return '127.0.0.1';
            }
        }

        // ==================== AUTHENTICATION & UI FUNCTIONS ====================

        function requireAuth() {
            const token = localStorage.getItem('psn_welfare_token');
            const user = localStorage.getItem('psn_welfare_user');

            if (!token || !user) {
                window.location.href = '../pages/admin-login.html';
                return false;
            }

            try {
                const userData = JSON.parse(user);
                if (!userData.is_admin && !userData.isAdmin) {
                    window.location.href = '../pages/dashboard.html';
                    return false;
                }
                return true;
            } catch {
                window.location.href = '../pages/admin-login.html';
                return false;
            }
        }

        function getCurrentUser() {
            const user = localStorage.getItem('psn_welfare_user');
            if (user) {
                try {
                    return JSON.parse(user);
                } catch {
                    return null;
                }
            }
            return null;
        }

        function showNotification(message, type = 'info') {
            // Remove any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(n => n.remove());

            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('notification-hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // ==================== PASSWORD TOGGLE FUNCTIONS ====================

        function initializePasswordToggles() {
            // SMTP password toggle
            const smtpPasswordToggle = document.getElementById('smtpPasswordToggle');
            const smtpPass = document.getElementById('smtpPass');

            if (smtpPasswordToggle && smtpPass) {
                smtpPasswordToggle.addEventListener('click', function () {
                    const type = smtpPass.type === 'password' ? 'text' : 'password';
                    smtpPass.type = type;
                    const icon = this.querySelector('i');
                    icon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
                });
            }

            // New member password toggle
            const newMemberPasswordToggle = document.getElementById('newMemberPasswordToggle');
            const newMemberPassword = document.getElementById('newMemberPassword');

            if (newMemberPasswordToggle && newMemberPassword) {
                newMemberPasswordToggle.addEventListener('click', function () {
                    const type = newMemberPassword.type === 'password' ? 'text' : 'password';
                    newMemberPassword.type = type;
                    const icon = this.querySelector('i');
                    icon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
                });
            }
        }

        // ==================== DASHBOARD DATA LOADING ====================

        async function loadDashboardData() {
            const refreshBtn = document.getElementById('refreshDataBtn');
            const refreshText = document.getElementById('refreshText');

            refreshBtn.classList.add('loading');
            refreshText.innerHTML = '<span class="spinner"></span> Refreshing...';

            try {
                const dbConnected = await testDatabaseConnection();

                if (dbConnected && supabase) {
                    const members = await loadMembersFromDB();
                    const activeMembers = members.filter(m => m.is_active).length;
                    const events = JSON.parse(localStorage.getItem('psn_events') || '[]');

                    // Get upcoming events (next 30 days)
                    const today = new Date();
                    const nextMonth = new Date(today);
                    nextMonth.setDate(nextMonth.getDate() + 30);

                    const upcomingEvents = events.filter(event => {
                        const eventDate = new Date(event.date);
                        return eventDate >= today && eventDate <= nextMonth;
                    });

                    document.getElementById('totalMembers').textContent = members.length;
                    document.getElementById('activeMembers').textContent = activeMembers;
                    document.getElementById('upcomingCelebrations').textContent = upcomingEvents.length;
                    document.getElementById('membersCount').textContent = members.length;

                    document.getElementById('dbConnection').textContent = 'Connected';
                    document.getElementById('dbConnection').style.color = '#28a745';
                    document.getElementById('tablesCount').textContent = '5 tables';
                    document.getElementById('systemHealth').textContent = 'Healthy';
                    document.getElementById('apiStatus').textContent = 'Online';

                    const logs = await loadSystemLogsFromDB();
                    updateActivityFeed(logs.slice(0, 5));

                    // Update reminder stats
                    const reminders = JSON.parse(localStorage.getItem('psn_reminders') || '[]');
                    document.getElementById('remindersSent').textContent = reminders.length;
                    document.getElementById('remindersCount').textContent = reminders.length;

                    showNotification('Data refreshed from database', 'success');
                } else {
                    const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                    const events = JSON.parse(localStorage.getItem('psn_events') || '[]');
                    const activeMembers = members.filter(m => m.is_active !== false).length;

                    // Get upcoming events
                    const today = new Date();
                    const nextMonth = new Date(today);
                    nextMonth.setDate(nextMonth.getDate() + 30);

                    const upcomingEvents = events.filter(event => {
                        const eventDate = new Date(event.date);
                        return eventDate >= today && eventDate <= nextMonth;
                    });

                    document.getElementById('totalMembers').textContent = members.length;
                    document.getElementById('activeMembers').textContent = activeMembers;
                    document.getElementById('upcomingCelebrations').textContent = upcomingEvents.length;
                    document.getElementById('membersCount').textContent = members.length;

                    document.getElementById('dbConnection').textContent = 'Local Storage';
                    document.getElementById('dbConnection').style.color = '#ffc107';
                    document.getElementById('systemHealth').textContent = 'Limited';
                    document.getElementById('apiStatus').textContent = 'Offline';

                    // Update reminder stats
                    const reminders = JSON.parse(localStorage.getItem('psn_reminders') || '[]');
                    document.getElementById('remindersSent').textContent = reminders.length;
                    document.getElementById('remindersCount').textContent = reminders.length;

                    // Load recent activity from local logs
                    const logs = JSON.parse(localStorage.getItem('psn_logs') || '[]');
                    updateActivityFeed(logs.slice(0, 5));

                    showNotification('Using local storage (database not configured)', 'warning');
                }

                document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('Error loading data', 'error');
            } finally {
                refreshBtn.classList.remove('loading');
                refreshText.textContent = 'Refresh Data';
            }
        }

        function updateActivityFeed(logs) {
            const activityFeed = document.getElementById('activityFeed');
            if (!activityFeed) return;

            if (logs.length === 0) {
                activityFeed.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">
                                <strong>No recent activity</strong>
                            </p>
                            <p class="activity-time">System ready</p>
                        </div>
                    </div>
                `;
                return;
            }

            activityFeed.innerHTML = logs.map(log => `
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="fas fa-${getActionIcon(log.action)}"></i>
                    </div>
                    <div class="activity-content">
                        <p class="activity-text">
                            <strong>${log.user_id || 'System'}:</strong> ${log.details}
                        </p>
                        <p class="activity-time">${formatTimeAgo(log.created_at)}</p>
                    </div>
                </div>
            `).join('');
        }

        function getActionIcon(action) {
            const icons = {
                login: 'sign-in-alt',
                logout: 'sign-out-alt',
                member_add: 'user-plus',
                member_update: 'user-edit',
                member_delete: 'user-minus',
                default: 'clipboard-list'
            };
            return icons[action] || icons.default;
        }

        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        // ==================== MEMBERS MANAGEMENT ====================

        let allMembers = [];
        let filteredMembers = [];
        let currentPage = 1;
        const membersPerPage = 10;

        async function loadMembersData() {
            const tbody = document.getElementById('membersTableBody');
            if (!tbody) return;

            tbody.innerHTML = `
                <tr id="loadingRow">
                    <td colspan="9" style="text-align: center; padding: 40px;">
                        <div class="spinner"></div> Loading members from database...
                    </td>
                </tr>
            `;

            try {
                allMembers = await loadMembersFromDB();
                filteredMembers = [...allMembers];

                if (allMembers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                                <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                <p>No members found. Add your first member!</p>
                            </td>
                        </tr>
                    `;
                    updatePagination();
                    return;
                }

                renderMembersTable();

            } catch (error) {
                console.error('Error loading members:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            <p>Error loading members. Please try again.</p>
                        </td>
                    </tr>
                `;
            }
        }

        function renderMembersTable() {
            const tbody = document.getElementById('membersTableBody');
            if (!tbody) return;

            // Apply filters
            const searchTerm = document.getElementById('memberSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const typeFilter = document.getElementById('memberTypeFilter').value;

            filteredMembers = allMembers.filter(member => {
                // Search filter
                const matchesSearch = !searchTerm ||
                    (member.full_name && member.full_name.toLowerCase().includes(searchTerm)) ||
                    (member.psn_number && member.psn_number.toLowerCase().includes(searchTerm)) ||
                    (member.email && member.email.toLowerCase().includes(searchTerm));

                // Status filter
                const matchesStatus = !statusFilter ||
                    (statusFilter === 'active' && member.is_active) ||
                    (statusFilter === 'inactive' && !member.is_active);

                // Type filter
                const matchesType = !typeFilter ||
                    (typeFilter === 'admin' && member.is_admin) ||
                    (typeFilter === 'member' && !member.is_admin);

                return matchesSearch && matchesStatus && matchesType;
            });

            // Calculate pagination
            const totalPages = Math.ceil(filteredMembers.length / membersPerPage);
            const startIndex = (currentPage - 1) * membersPerPage;
            const endIndex = startIndex + membersPerPage;
            const pageMembers = filteredMembers.slice(startIndex, endIndex);

            // Render table
            tbody.innerHTML = '';

            pageMembers.forEach(member => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="member-checkbox" data-id="${member.id}"></td>
                    <td>${member.psn_number || member.psn || 'N/A'}</td>
                    <td>${member.full_name}</td>
                    <td>${member.email}</td>
                    <td>${member.phone || 'N/A'}</td>
                    <td><span class="status-badge ${member.is_active ? 'active' : 'inactive'}">${member.is_active ? 'Active' : 'Inactive'}</span></td>
                    <td><span class="type-badge ${member.is_admin ? 'admin' : 'member'}">${member.is_admin ? 'Admin' : 'Member'}</span></td>
                    <td>${member.created_at ? new Date(member.created_at).toLocaleDateString() : 'Unknown'}</td>
                    <td>
                        <button class="btn btn-outline btn-sm view-member-btn" data-id="${member.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-outline btn-sm edit-member-btn" data-id="${member.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Add event listeners
            document.querySelectorAll('.member-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectedCount);
            });

            document.querySelectorAll('.view-member-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const memberId = this.getAttribute('data-id');
                    viewMember(memberId);
                });
            });

            document.querySelectorAll('.edit-member-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const memberId = this.getAttribute('data-id');
                    editMember(memberId);
                });
            });

            updatePagination();
            updateSelectedCount();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredMembers.length / membersPerPage);
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages || 1;

            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;
        }

        function updateSelectedCount() {
            const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
            const selectedCount = selectedCheckboxes.length;

            document.getElementById('selectedCount').textContent = selectedCount;

            const hasSelection = selectedCount > 0;
            document.getElementById('exportSelectedBtn').disabled = !hasSelection;
            document.getElementById('deactivateSelectedBtn').disabled = !hasSelection;
            document.getElementById('deleteSelectedBtn').disabled = !hasSelection;

            // Update select all checkbox
            const totalCheckboxes = document.querySelectorAll('.member-checkbox').length;
            const selectAllCheckbox = document.getElementById('selectAllMembers');
            selectAllCheckbox.checked = totalCheckboxes > 0 && selectedCount === totalCheckboxes;
        }

        async function viewMember(memberId) {
            try {
                const member = allMembers.find(m => m.id === memberId);

                if (!member) {
                    showNotification('Member not found', 'error');
                    return;
                }

                const content = document.getElementById('memberDetailsContent');
                content.innerHTML = `
                    <div class="member-details">
                        <div class="detail-row">
                            <strong>PSN Number:</strong> ${member.psn_number || member.psn || 'N/A'}
                        </div>
                        <div class="detail-row">
                            <strong>Full Name:</strong> ${member.full_name}
                        </div>
                        <div class="detail-row">
                            <strong>Email:</strong> ${member.email}
                        </div>
                        <div class="detail-row">
                            <strong>Phone:</strong> ${member.phone || 'N/A'}
                        </div>
                        <div class="detail-row">
                            <strong>Date of Birth:</strong> ${member.date_of_birth ? new Date(member.date_of_birth).toLocaleDateString() : 'Not set'}
                        </div>
                        <div class="detail-row">
                            <strong>Status:</strong> <span class="status-badge ${member.is_active ? 'active' : 'inactive'}">${member.is_active ? 'Active' : 'Inactive'}</span>
                        </div>
                        <div class="detail-row">
                            <strong>Type:</strong> <span class="type-badge ${member.is_admin ? 'admin' : 'member'}">${member.is_admin ? 'Administrator' : 'Regular Member'}</span>
                        </div>
                        <div class="detail-row">
                            <strong>Registered:</strong> ${member.created_at ? new Date(member.created_at).toLocaleString() : 'Unknown'}
                        </div>
                        <div class="detail-row">
                            <strong>Last Updated:</strong> ${member.updated_at ? new Date(member.updated_at).toLocaleString() : 'Never'}
                        </div>
                    </div>
                `;

                document.getElementById('viewMemberModal').style.display = 'block';

            } catch (error) {
                console.error('Error viewing member:', error);
                showNotification('Error loading member details', 'error');
            }
        }

        async function editMember(memberId) {
            showNotification('Edit functionality will be implemented in the next update', 'info');
        }

        // ==================== AUDIT LOGS LOADING ====================

        async function loadAuditLogs() {
            const tbody = document.getElementById('logsTableBody');
            if (!tbody) return;

            try {
                let logs = await loadSystemLogsFromDB();

                if (logs.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: #6c757d;">
                                <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                <p>No audit logs found</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                const logTypeFilter = document.getElementById('logTypeFilter').value;
                const logSearch = document.getElementById('logSearch').value.toLowerCase();

                let filteredLogs = logs;

                if (logTypeFilter) {
                    filteredLogs = filteredLogs.filter(log => log.action === logTypeFilter);
                }

                if (logSearch) {
                    filteredLogs = filteredLogs.filter(log =>
                        (log.details && log.details.toLowerCase().includes(logSearch)) ||
                        (log.user_id && log.user_id.toString().includes(logSearch)) ||
                        (log.ip_address && log.ip_address.includes(logSearch))
                    );
                }

                tbody.innerHTML = filteredLogs.map(log => `
                    <tr>
                        <td>${new Date(log.created_at || log.timestamp).toLocaleString()}</td>
                        <td>${log.user_id || 'System'}</td>
                        <td><span class="log-action ${log.action}">${log.action}</span></td>
                        <td>${log.details || 'No details'}</td>
                        <td>${log.ip_address || 'N/A'}</td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('Error loading audit logs:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            <p>Error loading audit logs</p>
                        </td>
                    </tr>
                `;
            }
        }

        // ==================== SETTINGS DATA LOADING ====================

        async function loadSettingsData() {
            try {
                const settings = JSON.parse(localStorage.getItem('psn_settings') || '{}');

                // General settings
                if (settings.platformName) document.getElementById('platformName').value = settings.platformName;
                if (settings.welfareSecretary) document.getElementById('welfareSecretary').value = settings.welfareSecretary;
                if (settings.contactEmail) document.getElementById('contactEmail').value = settings.contactEmail;
                if (settings.reminderTime) document.getElementById('reminderTime').value = settings.reminderTime;

                // Email settings
                if (settings.smtpHost) document.getElementById('smtpHost').value = settings.smtpHost;
                if (settings.smtpPort) document.getElementById('smtpPort').value = settings.smtpPort;
                if (settings.smtpUser) document.getElementById('smtpUser').value = settings.smtpUser;
                if (settings.smtpPass) document.getElementById('smtpPass').value = settings.smtpPass || '';
                if (settings.emailNotifications !== undefined) document.getElementById('emailNotifications').checked = settings.emailNotifications;

                // Security settings
                if (settings.require2FA !== undefined) document.getElementById('require2FA').checked = settings.require2FA;
                if (settings.sessionTimeout) document.getElementById('sessionTimeout').value = settings.sessionTimeout;
                if (settings.maxLoginAttempts) document.getElementById('maxLoginAttempts').value = settings.maxLoginAttempts;

                // Database settings
                if (settings.lastBackup) {
                    document.getElementById('lastBackup').textContent = new Date(settings.lastBackup).toLocaleString();
                }

                // Update database status
                const dbConnected = await testDatabaseConnection();
                const dbStatusDot = document.getElementById('dbStatusDot');
                const dbStatusText = document.getElementById('dbStatusText');

                if (dbConnected) {
                    dbStatusDot.className = 'status-dot connected';
                    dbStatusText.textContent = 'Connected';
                    dbStatusText.style.color = '#28a745';
                } else {
                    dbStatusDot.className = 'status-dot';
                    dbStatusText.textContent = 'Not Connected';
                    dbStatusText.style.color = '#dc3545';
                }

                // Load member count
                const members = await loadMembersFromDB();
                document.getElementById('dbTotalMembers').textContent = members.length;

            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // ==================== BUTTON FUNCTIONS ====================

        function activateAllButtons() {
            // Save Settings Button
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);

            // Test Email Button
            document.getElementById('testEmailBtn').addEventListener('click', testEmailConfiguration);

            // View Access Logs Button
            document.getElementById('viewAccessLogsBtn').addEventListener('click', function () {
                document.querySelector('.nav-item[data-section="system-logs"]').click();
                setTimeout(() => {
                    document.getElementById('logTypeFilter').value = 'login';
                    loadAuditLogs();
                }, 500);
            });

            // Backup Now Button
            document.getElementById('backupNowBtn').addEventListener('click', backupDatabase);

            // Export All Data Button
            document.getElementById('exportAllDataBtn').addEventListener('click', exportAllData);

            // Reset Demo Button
            document.getElementById('resetDemoBtn').addEventListener('click', resetDatabase);

            // Send Bulk Reminders Button
            document.getElementById('sendBulkRemindersBtn').addEventListener('click', sendBulkReminders);

            // Apply Date Range Button
            document.getElementById('applyDateRange').addEventListener('click', applyReminderDateFilter);

            // Clear Filters Button
            document.getElementById('clearFiltersBtn').addEventListener('click', clearMemberFilters);

            // Export Selected Button
            document.getElementById('exportSelectedBtn').addEventListener('click', exportSelectedMembers);

            // Deactivate Selected Button
            document.getElementById('deactivateSelectedBtn').addEventListener('click', deactivateSelectedMembers);

            // Delete Selected Button
            document.getElementById('deleteSelectedBtn').addEventListener('click', deleteSelectedMembers);

            // Select All Members Checkbox
            document.getElementById('selectAllMembers').addEventListener('change', function () {
                toggleSelectAllMembers(this.checked);
            });

            // Previous Page Button
            document.getElementById('prevPageBtn').addEventListener('click', function () {
                if (currentPage > 1) {
                    currentPage--;
                    renderMembersTable();
                }
            });

            // Next Page Button
            document.getElementById('nextPageBtn').addEventListener('click', function () {
                const totalPages = Math.ceil(filteredMembers.length / membersPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderMembersTable();
                }
            });

            // View All Activity Button
            document.getElementById('viewAllActivity').addEventListener('click', function () {
                document.querySelector('.nav-item[data-section="system-logs"]').click();
            });

            // Quick Export Button
            document.getElementById('quickExportBtn').addEventListener('click', quickExportData);

            // Monitoring Refresh Button
            document.getElementById('refreshMonitoring').addEventListener('click', refreshMonitoring);

            // Send Announcement Button
            document.getElementById('sendAnnouncementBtn').addEventListener('click', sendAnnouncement);

            // Backup Database Button
            document.getElementById('backupDatabaseBtn').addEventListener('click', backupDatabase);

            // View Logs Button
            document.getElementById('viewLogsBtn').addEventListener('click', function () {
                document.querySelector('.nav-item[data-section="system-logs"]').click();
            });

            // Generate Report Button
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);

            // Download Report Button
            document.getElementById('downloadReportBtn').addEventListener('click', downloadReport);

            // Edit Member Button
            document.getElementById('editMemberBtn').addEventListener('click', editCurrentMember);

            // Report Type Buttons
            document.querySelectorAll('[data-report]').forEach(btn => {
                btn.addEventListener('click', function () {
                    generateSpecificReport(this.getAttribute('data-report'));
                });
            });

            // Settings Tabs
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    activateSettingsTab(this.getAttribute('data-tab'));
                });
            });

            // Calendar Navigation
            document.getElementById('prevMonth').addEventListener('click', function () {
                navigateCalendar(-1);
            });

            document.getElementById('nextMonth').addEventListener('click', function () {
                navigateCalendar(1);
            });

            // Search functionality
            document.getElementById('memberSearch').addEventListener('input', function () {
                currentPage = 1;
                renderMembersTable();
            });

            // Filter functionality
            document.getElementById('statusFilter').addEventListener('change', function () {
                currentPage = 1;
                renderMembersTable();
            });

            document.getElementById('memberTypeFilter').addEventListener('change', function () {
                currentPage = 1;
                renderMembersTable();
            });

            // Log search functionality
            document.getElementById('logSearch').addEventListener('input', function () {
                loadAuditLogs();
            });

            document.getElementById('logTypeFilter').addEventListener('change', function () {
                loadAuditLogs();
            });
        }

        async function saveSettings() {
            const saveBtn = document.getElementById('saveSettingsBtn');
            const saveText = document.getElementById('saveSettingsText');
            const originalText = saveText.textContent;

            saveBtn.disabled = true;
            saveText.innerHTML = '<span class="spinner"></span> Saving...';

            try {
                const settings = {
                    platformName: document.getElementById('platformName').value,
                    welfareSecretary: document.getElementById('welfareSecretary').value,
                    contactEmail: document.getElementById('contactEmail').value,
                    reminderTime: document.getElementById('reminderTime').value,
                    smtpHost: document.getElementById('smtpHost').value,
                    smtpPort: document.getElementById('smtpPort').value,
                    smtpUser: document.getElementById('smtpUser').value,
                    smtpPass: document.getElementById('smtpPass').value,
                    emailNotifications: document.getElementById('emailNotifications').checked,
                    require2FA: document.getElementById('require2FA').checked,
                    sessionTimeout: document.getElementById('sessionTimeout').value,
                    maxLoginAttempts: document.getElementById('maxLoginAttempts').value,
                    updated_at: new Date().toISOString()
                };

                localStorage.setItem('psn_settings', JSON.stringify(settings));

                // Log the action
                await logSystemAction('settings_update', 'Updated system settings');

                showNotification('Settings saved successfully', 'success');

                // Reload settings to update UI
                setTimeout(() => {
                    loadSettingsData();
                }, 500);

            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('Error saving settings', 'error');
            } finally {
                saveBtn.disabled = false;
                saveText.textContent = originalText;
            }
        }

        async function testEmailConfiguration() {
            const testBtn = document.getElementById('testEmailBtn');
            const originalText = testBtn.textContent;

            testBtn.disabled = true;
            testBtn.innerHTML = '<span class="spinner"></span> Testing...';

            try {
                await new Promise(resolve => setTimeout(resolve, 2000));

                const smtpHost = document.getElementById('smtpHost').value;
                const smtpUser = document.getElementById('smtpUser').value;

                if (!smtpHost || !smtpUser) {
                    showNotification('Please fill in SMTP configuration first', 'warning');
                } else {
                    showNotification('Email configuration test successful! Test email sent.', 'success');
                }
            } catch (error) {
                console.error('Error testing email:', error);
                showNotification('Email test failed. Check your configuration.', 'error');
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = originalText;
            }
        }

        async function backupDatabase() {
            const backupBtn = document.getElementById('backupNowBtn');
            const backupText = document.getElementById('backupText');
            const originalText = backupText.textContent;

            backupBtn.disabled = true;
            backupText.innerHTML = '<span class="spinner"></span> Backing up...';

            try {
                const backupData = {
                    timestamp: new Date().toISOString(),
                    members: JSON.parse(localStorage.getItem('psn_members') || '[]'),
                    settings: JSON.parse(localStorage.getItem('psn_settings') || '{}'),
                    logs: JSON.parse(localStorage.getItem('psn_logs') || '[]'),
                    events: JSON.parse(localStorage.getItem('psn_events') || '[]'),
                    reminders: JSON.parse(localStorage.getItem('psn_reminders') || '[]')
                };

                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `psn-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // Update last backup timestamp
                const settings = JSON.parse(localStorage.getItem('psn_settings') || '{}');
                settings.lastBackup = new Date().toISOString();
                localStorage.setItem('psn_settings', JSON.stringify(settings));

                document.getElementById('lastBackup').textContent = new Date().toLocaleString();
                await logSystemAction('backup', 'Created database backup');

                showNotification('Database backup created and downloaded', 'success');

            } catch (error) {
                console.error('Error creating backup:', error);
                showNotification('Error creating backup', 'error');
            } finally {
                backupBtn.disabled = false;
                backupText.textContent = originalText;
            }
        }

        function exportAllData() {
            try {
                const exportData = {
                    members: JSON.parse(localStorage.getItem('psn_members') || '[]'),
                    events: JSON.parse(localStorage.getItem('psn_events') || '[]'),
                    settings: JSON.parse(localStorage.getItem('psn_settings') || '{}'),
                    export_date: new Date().toISOString(),
                    system: 'PSN Taraba Welfare Registry'
                };

                // Convert to CSV format
                let csvContent = "PSN Taraba Welfare Registry - Data Export\n";
                csvContent += "Export Date: " + new Date().toLocaleString() + "\n\n";

                // Members section
                if (exportData.members.length > 0) {
                    csvContent += "MEMBERS\n";
                    const memberHeaders = ["PSN Number", "Full Name", "Email", "Phone", "Status", "Type", "Registered"];
                    csvContent += memberHeaders.join(",") + "\n";

                    exportData.members.forEach(member => {
                        const row = [
                            `"${member.psn_number || member.psn || ''}"`,
                            `"${member.full_name || ''}"`,
                            `"${member.email || ''}"`,
                            `"${member.phone || ''}"`,
                            `"${member.is_active ? 'Active' : 'Inactive'}"`,
                            `"${member.is_admin ? 'Admin' : 'Member'}"`,
                            `"${member.created_at ? new Date(member.created_at).toLocaleDateString() : ''}"`
                        ];
                        csvContent += row.join(",") + "\n";
                    });
                    csvContent += "\n";
                }

                // Events section
                if (exportData.events.length > 0) {
                    csvContent += "EVENTS\n";
                    const eventHeaders = ["Title", "Date", "Type", "Description"];
                    csvContent += eventHeaders.join(",") + "\n";

                    exportData.events.forEach(event => {
                        const row = [
                            `"${event.title || ''}"`,
                            `"${event.date || ''}"`,
                            `"${event.type || ''}"`,
                            `"${event.description || ''}"`
                        ];
                        csvContent += row.join(",") + "\n";
                    });
                    csvContent += "\n";
                }

                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `psn-data-export-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showNotification('All data exported to CSV', 'success');
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification('Error exporting data', 'error');
            }
        }

        function resetDatabase() {
            if (confirm('WARNING: This will clear ALL data including members, events, and settings. This action cannot be undone. Are you absolutely sure?')) {
                if (confirm('This is your final warning. All data will be permanently deleted. Type "RESET" to confirm.')) {
                    const userInput = prompt('Type RESET to confirm database reset:');
                    if (userInput === 'RESET') {
                        // Clear local storage
                        localStorage.removeItem('psn_members');
                        localStorage.removeItem('psn_events');
                        localStorage.removeItem('psn_logs');
                        localStorage.removeItem('psn_settings');
                        localStorage.removeItem('psn_reminders');

                        // Clear database if connected
                        if (supabase) {
                            console.log('Database reset requested - clear tables manually');
                        }

                        // Reset UI
                        document.getElementById('totalMembers').textContent = '0';
                        document.getElementById('activeMembers').textContent = '0';
                        document.getElementById('membersCount').textContent = '0';
                        document.getElementById('lastBackup').textContent = 'No backups yet';
                        document.getElementById('dbTotalMembers').textContent = '0';

                        if (document.getElementById('manage-members-section').style.display !== 'none') {
                            loadMembersData();
                        }

                        // Log the action
                        logSystemAction('system_reset', 'Reset all system data');

                        showNotification('All data has been cleared. Page will reload.', 'warning');
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    } else {
                        showNotification('Database reset cancelled', 'info');
                    }
                }
            }
        }

        async function sendBulkReminders() {
            const sendBtn = document.getElementById('sendBulkRemindersBtn');
            const originalText = sendBtn.textContent;

            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span class="spinner"></span> Sending...';

            try {
                const events = JSON.parse(localStorage.getItem('psn_events') || '[]');
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');

                // Get upcoming events in next 7 days
                const today = new Date();
                const nextWeek = new Date(today);
                nextWeek.setDate(nextWeek.getDate() + 7);

                const upcomingEvents = events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate >= today && eventDate <= nextWeek;
                });

                if (upcomingEvents.length === 0) {
                    showNotification('No upcoming events in the next 7 days', 'info');
                    return;
                }

                // Simulate sending reminders
                let remindersSent = 0;
                for (const event of upcomingEvents) {
                    for (const member of members) {
                        // Create reminder log entry
                        const reminder = {
                            event_id: event.id || Date.now(),
                            event_title: event.title,
                            event_date: event.date,
                            member_id: member.id,
                            member_name: member.full_name,
                            member_email: member.email,
                            status: 'sent',
                            sent_at: new Date().toISOString(),
                            type: 'birthday' // or 'anniversary' based on event type
                        };

                        // Save to local storage
                        const reminders = JSON.parse(localStorage.getItem('psn_reminders') || '[]');
                        reminders.push(reminder);
                        localStorage.setItem('psn_reminders', JSON.stringify(reminders));

                        remindersSent++;
                    }
                }

                // Update UI
                const currentReminders = parseInt(document.getElementById('remindersSent').textContent) || 0;
                document.getElementById('remindersSent').textContent = currentReminders + remindersSent;

                const currentLogs = parseInt(document.getElementById('remindersCount').textContent) || 0;
                document.getElementById('remindersCount').textContent = currentLogs + remindersSent;

                // Log the action
                await logSystemAction('bulk_reminders', `Sent ${remindersSent} reminders for ${upcomingEvents.length} events`);

                showNotification(`Bulk reminders sent for ${upcomingEvents.length} events (${remindersSent} total)`, 'success');

            } catch (error) {
                console.error('Error sending bulk reminders:', error);
                showNotification('Error sending reminders', 'error');
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = originalText;
            }
        }

        function applyReminderDateFilter() {
            const startDate = document.getElementById('reminderStartDate').value;
            const endDate = document.getElementById('reminderEndDate').value;

            if (startDate && endDate) {
                // This would filter the reminders table in a real implementation
                showNotification(`Filter applied: ${startDate} to ${endDate}`, 'info');
            } else {
                showNotification('Please select both start and end dates', 'warning');
            }
        }

        function clearMemberFilters() {
            document.getElementById('memberSearch').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('memberTypeFilter').value = '';

            currentPage = 1;
            renderMembersTable();

            showNotification('Filters cleared', 'info');
        }

        function exportSelectedMembers() {
            const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
            if (selectedCheckboxes.length === 0) {
                showNotification('No members selected', 'warning');
                return;
            }

            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.getAttribute('data-id'));
            const selectedMembers = allMembers.filter(member =>
                selectedIds.includes(member.id.toString())
            );

            if (selectedMembers.length === 0) {
                showNotification('No members found to export', 'warning');
                return;
            }

            // Convert to CSV
            const headers = ['PSN Number', 'Full Name', 'Email', 'Phone', 'Status', 'Type', 'Registered'];
            const csvRows = [
                headers.join(','),
                ...selectedMembers.map(member => [
                    member.psn_number || member.psn || '',
                    member.full_name,
                    member.email,
                    member.phone || '',
                    member.is_active ? 'Active' : 'Inactive',
                    member.is_admin ? 'Admin' : 'Member',
                    member.created_at ? new Date(member.created_at).toLocaleDateString() : ''
                ].map(value => `"${value}"`).join(','))
            ];

            const csvContent = csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `selected-members-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showNotification(`Exported ${selectedMembers.length} members to CSV`, 'success');
        }

        async function deactivateSelectedMembers() {
            const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
            if (selectedCheckboxes.length === 0) {
                showNotification('No members selected', 'warning');
                return;
            }

            if (confirm(`Deactivate ${selectedCheckboxes.length} selected member(s)? They will not be able to login until reactivated.`)) {
                const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.getAttribute('data-id'));
                let updatedCount = 0;

                for (const memberId of selectedIds) {
                    const result = await updateMemberInDB(memberId, { is_active: false });
                    if (result.success) {
                        updatedCount++;
                    }
                }

                // Reload data
                await loadMembersData();
                await loadDashboardData();

                showNotification(`${updatedCount} member(s) deactivated`, 'success');
            }
        }

        async function deleteSelectedMembers() {
            const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
            if (selectedCheckboxes.length === 0) {
                showNotification('No members selected', 'warning');
                return;
            }

            if (confirm(`Permanently delete ${selectedCheckboxes.length} selected member(s)? This action cannot be undone.`)) {
                if (confirm('This is your final warning. All selected member data will be permanently deleted.')) {
                    const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.getAttribute('data-id'));
                    let deletedCount = 0;

                    for (const memberId of selectedIds) {
                        const result = await deleteMemberFromDB(memberId);
                        if (result.success) {
                            deletedCount++;
                        }
                    }

                    // Reload data
                    await loadMembersData();
                    await loadDashboardData();

                    showNotification(`${deletedCount} member(s) deleted`, 'success');
                }
            }
        }

        function toggleSelectAllMembers(checked) {
            document.querySelectorAll('.member-checkbox').forEach(checkbox => {
                checkbox.checked = checked;
            });
            updateSelectedCount();
        }

        function quickExportData() {
            const exportData = {
                summary: {
                    total_members: document.getElementById('totalMembers').textContent,
                    active_members: document.getElementById('activeMembers').textContent,
                    upcoming_celebrations: document.getElementById('upcomingCelebrations').textContent,
                    reminders_sent: document.getElementById('remindersSent').textContent,
                    export_date: new Date().toISOString()
                },
                system_status: {
                    database: document.getElementById('dbConnection').textContent,
                    health: document.getElementById('systemHealth').textContent,
                    api: document.getElementById('apiStatus').textContent
                }
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `psn-quick-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showNotification('Quick export downloaded', 'success');
        }

        function refreshMonitoring() {
            const refreshBtn = document.getElementById('refreshMonitoring');
            const refreshText = document.getElementById('monitoringText');
            const originalText = refreshText.textContent;

            refreshBtn.disabled = true;
            refreshText.innerHTML = '<span class="spinner"></span> Refreshing...';

            setTimeout(async () => {
                const now = new Date();
                document.getElementById('lastSync').textContent = now.toLocaleTimeString();

                // Test database connection
                const dbConnected = await testDatabaseConnection();
                if (dbConnected) {
                    document.getElementById('systemHealth').textContent = 'Healthy';
                    document.getElementById('apiStatus').textContent = 'Online';
                    document.getElementById('storageStatus').textContent = 'Normal';
                    document.getElementById('backupStatus').textContent = 'Up to date';
                } else {
                    document.getElementById('systemHealth').textContent = 'Limited';
                    document.getElementById('apiStatus').textContent = 'Offline';
                    document.getElementById('storageStatus').textContent = 'Local Only';
                    document.getElementById('backupStatus').textContent = 'Manual';
                }

                refreshBtn.disabled = false;
                refreshText.textContent = originalText;
                showNotification('System monitoring refreshed', 'success');
            }, 1500);
        }

        function sendAnnouncement() {
            const announcement = prompt('Enter announcement message to send to all members:');
            if (announcement && announcement.trim()) {
                // Log the announcement
                logSystemAction('announcement', `Sent announcement: ${announcement}`);
                showNotification('Announcement queued for sending to all members', 'success');
            }
        }

        function generateReport() {
            const reportPreview = document.getElementById('reportPreview');
            const reportContent = document.getElementById('reportContent');

            reportPreview.style.display = 'block';
            const now = new Date();

            // Create a simple report
            const totalMembers = document.getElementById('totalMembers').textContent;
            const activeMembers = document.getElementById('activeMembers').textContent;
            const upcomingEvents = document.getElementById('upcomingCelebrations').textContent;
            const remindersSent = document.getElementById('remindersSent').textContent;

            reportContent.innerHTML = `
                <div class="report-content">
                    <h4>System Report - ${now.toLocaleDateString()}</h4>
                    <div class="report-stats">
                        <div class="report-stat">
                            <strong>Total Members:</strong> ${totalMembers}
                        </div>
                        <div class="report-stat">
                            <strong>Active Members:</strong> ${activeMembers}
                        </div>
                        <div class="report-stat">
                            <strong>Upcoming Celebrations:</strong> ${upcomingEvents}
                        </div>
                        <div class="report-stat">
                            <strong>Reminders Sent:</strong> ${remindersSent}
                        </div>
                        <div class="report-stat">
                            <strong>System Status:</strong> ${document.getElementById('systemHealth').textContent}
                        </div>
                        <div class="report-stat">
                            <strong>Database Connection:</strong> ${document.getElementById('dbConnection').textContent}
                        </div>
                    </div>
                    <div class="report-timestamp">
                        Generated: ${now.toLocaleString()}
                    </div>
                </div>
            `;

            showNotification('Report generated. Select format and download.', 'info');
        }

        function downloadReport() {
            const format = document.getElementById('reportFormat').value;
            const reportContent = document.getElementById('reportContent').innerText;

            let mimeType, extension;
            switch (format) {
                case 'csv':
                    mimeType = 'text/csv';
                    extension = 'csv';
                    break;
                case 'excel':
                    mimeType = 'application/vnd.ms-excel';
                    extension = 'xls';
                    break;
                case 'pdf':
                default:
                    mimeType = 'application/pdf';
                    extension = 'pdf';
            }

            const blob = new Blob([reportContent], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `psn-report-${new Date().toISOString().split('T')[0]}.${extension}`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showNotification(`Report downloaded as ${format.toUpperCase()}`, 'success');
        }

        function editCurrentMember() {
            showNotification('Edit member functionality will be implemented in next update', 'info');
            document.getElementById('viewMemberModal').style.display = 'none';
        }

        function activateSettingsTab(tabId) {
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                }
            });

            document.querySelectorAll('.settings-tab-content').forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabId}-settings`) {
                    content.classList.add('active');
                }
            });
        }

        function generateSpecificReport(reportType) {
            const reportTypes = {
                demographics: 'Member Demographics Report',
                calendar: 'Celebration Calendar Report',
                reminders: 'Reminder Analytics Report',
                growth: 'Growth Trends Report'
            };

            showNotification(`Generating ${reportTypes[reportType]}...`, 'info');

            // Show report preview
            const reportPreview = document.getElementById('reportPreview');
            const reportContent = document.getElementById('reportContent');

            reportPreview.style.display = 'block';
            reportContent.innerHTML = `
                <div class="report-content">
                    <h4>${reportTypes[reportType]}</h4>
                    <p>This report would show detailed ${reportType} data.</p>
                    <p>In a full implementation, this would include charts, graphs, and detailed statistics.</p>
                    <div class="report-timestamp">
                        Generated: ${new Date().toLocaleString()}
                    </div>
                </div>
            `;
        }

        function navigateCalendar(direction) {
            const monthElement = document.getElementById('currentMonth');
            const currentText = monthElement.textContent;
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];

            const now = new Date();
            let currentMonth = months.indexOf(currentText.split(' ')[0]);
            if (currentMonth === -1) currentMonth = now.getMonth();

            let newMonth = currentMonth + direction;
            if (newMonth < 0) newMonth = 11;
            if (newMonth > 11) newMonth = 0;

            const year = now.getFullYear();
            monthElement.textContent = `${months[newMonth]} ${year}`;

            // Generate calendar days (simplified)
            generateCalendar(newMonth, year);
        }

        function generateCalendar(month, year) {
            const calendarGrid = document.getElementById('calendarGrid');
            if (!calendarGrid) return;

            // Simplified calendar - in a real app, you would generate actual dates
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();

            let calendarHTML = '';

            // Day headers
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(day => {
                calendarHTML += `<div class="calendar-day header">${day}</div>`;
            });

            // Empty cells for days before the first day of month
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += `<div class="calendar-day empty"></div>`;
            }

            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                // Check if this day has events
                const hasEvent = Math.random() > 0.8; // Random for demo
                const dayClass = hasEvent ? 'calendar-day event' : 'calendar-day';
                calendarHTML += `<div class="${dayClass}">${day}</div>`;
            }

            calendarGrid.innerHTML = calendarHTML;
        }

        // ==================== MAIN INITIALIZATION ====================

        document.addEventListener('DOMContentLoaded', async function () {
            if (!requireAuth()) return;

            const dbInitialized = initSupabase();

            const user = getCurrentUser();
            if (user) {
                document.getElementById('adminName').textContent = user.full_name || user.fullName || 'Admin User';
                document.getElementById('adminPsn').textContent = user.psn_number || user.psn || 'System Administrator';
            }

            if (!SUPABASE_CONFIG.url || !SUPABASE_CONFIG.key) {
                document.getElementById('dbConfigModal').style.display = 'block';
            }

            // Load initial data
            await loadDashboardData();

            // ==================== EVENT LISTENERS ====================

            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const mobileCloseBtn = document.getElementById('mobileCloseBtn');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const sidebar = document.getElementById('sidebar');

            function toggleMobileMenu() {
                sidebar.classList.toggle('mobile-open');
                mobileOverlay.classList.toggle('active');
                document.body.style.overflow = sidebar.classList.contains('mobile-open') ? 'hidden' : '';
            }

            if (mobileMenuToggle) mobileMenuToggle.addEventListener('click', toggleMobileMenu);
            if (mobileCloseBtn) mobileCloseBtn.addEventListener('click', toggleMobileMenu);
            if (mobileOverlay) mobileOverlay.addEventListener('click', toggleMobileMenu);

            // Navigation
            const navItems = document.querySelectorAll('.nav-item[data-section]');
            const sections = {
                'admin-dashboard': document.getElementById('admin-dashboard-section'),
                'manage-members': document.getElementById('manage-members-section'),
                'reminder-logs': document.getElementById('reminder-logs-section'),
                'upcoming-events': document.getElementById('upcoming-events-section'),
                'reports': document.getElementById('reports-section'),
                'system-logs': document.getElementById('system-logs-section'),
                'settings': document.getElementById('settings-section')
            };

            navItems.forEach(item => {
                item.addEventListener('click', function (e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');

                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    Object.values(sections).forEach(section => {
                        if (section) section.style.display = 'none';
                    });

                    if (sections[sectionId]) {
                        sections[sectionId].style.display = 'block';

                        const titles = {
                            'admin-dashboard': { title: 'Admin Dashboard', subtitle: 'Welfare Secretary Control Panel' },
                            'manage-members': { title: 'Manage Members', subtitle: 'View and manage all registered members' },
                            'reminder-logs': { title: 'Reminder Logs', subtitle: 'View reminder delivery history and statistics' },
                            'upcoming-events': { title: 'Upcoming Celebrations', subtitle: 'View and manage upcoming birthdays and anniversaries' },
                            'reports': { title: 'Reports & Analytics', subtitle: 'Generate and download system reports' },
                            'system-logs': { title: 'Audit Logs', subtitle: 'View system activity and audit trail' },
                            'settings': { title: 'System Settings', subtitle: 'Configure platform settings and preferences' }
                        };

                        const pageTitle = document.getElementById('pageTitle');
                        const pageSubtitle = document.getElementById('pageSubtitle');
                        if (titles[sectionId]) {
                            pageTitle.textContent = titles[sectionId].title;
                            pageSubtitle.textContent = titles[sectionId].subtitle;
                        }

                        loadSectionData(sectionId);
                    }

                    if (window.innerWidth <= 768) {
                        toggleMobileMenu();
                    }
                });
            });

            function loadSectionData(sectionId) {
                switch (sectionId) {
                    case 'manage-members':
                        loadMembersData();
                        break;
                    case 'system-logs':
                        loadAuditLogs();
                        break;
                    case 'settings':
                        loadSettingsData();
                        break;
                    case 'upcoming-events':
                        // Initialize calendar
                        const now = new Date();
                        const currentMonth = now.getMonth();
                        const currentYear = now.getFullYear();
                        const months = ['January', 'February', 'March', 'April', 'May', 'June',
                            'July', 'August', 'September', 'October', 'November', 'December'];
                        document.getElementById('currentMonth').textContent = `${months[currentMonth]} ${currentYear}`;
                        generateCalendar(currentMonth, currentYear);
                        break;
                }
            }

            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function () {
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('psn_welfare_token');
                    localStorage.removeItem('psn_welfare_user');
                    window.location.href = '../pages/admin-login.html';
                }
            });

            // Refresh data button
            document.getElementById('refreshDataBtn').addEventListener('click', loadDashboardData);

            // Add member buttons
            document.getElementById('addMemberBtn').addEventListener('click', function () {
                document.getElementById('addMemberModal').style.display = 'block';
            });

            document.getElementById('addNewMemberBtn').addEventListener('click', function () {
                document.getElementById('addMemberModal').style.display = 'block';
            });

            // Save new member
            document.getElementById('saveNewMember').addEventListener('click', async function () {
                const saveBtn = this;
                const saveText = document.getElementById('saveMemberText');
                const originalText = saveText.textContent;

                const memberData = {
                    psn_number: document.getElementById('newPsnNumber').value.trim(),
                    full_name: document.getElementById('newMemberName').value.trim(),
                    email: document.getElementById('newMemberEmail').value.trim(),
                    phone: document.getElementById('newMemberPhone').value.trim(),
                    date_of_birth: document.getElementById('newMemberDob').value || null,
                    password_hash: btoa(document.getElementById('newMemberPassword').value),
                    is_admin: document.getElementById('makeAdmin').checked,
                    is_active: true,
                    created_at: new Date().toISOString()
                };

                if (!memberData.psn_number || !memberData.full_name || !memberData.email || !memberData.phone) {
                    showNotification('Please fill all required fields', 'error');
                    return;
                }

                saveBtn.disabled = true;
                saveText.innerHTML = '<span class="spinner"></span> Saving...';

                try {
                    const result = await addMemberToDB(memberData);

                    if (result.success) {
                        showNotification(`Member ${memberData.full_name} added successfully`, 'success');
                        document.getElementById('addMemberModal').style.display = 'none';
                        document.getElementById('addMemberForm').reset();

                        await loadDashboardData();
                        if (document.getElementById('manage-members-section').style.display !== 'none') {
                            await loadMembersData();
                        }
                    } else {
                        showNotification(`Error: ${result.error}`, 'error');
                    }
                } catch (error) {
                    showNotification('Error saving member', 'error');
                } finally {
                    saveBtn.disabled = false;
                    saveText.textContent = originalText;
                }
            });

            // Cancel add member
            document.getElementById('cancelAddMember').addEventListener('click', function () {
                document.getElementById('addMemberModal').style.display = 'none';
                document.getElementById('addMemberForm').reset();
            });

            // Close member modal
            document.getElementById('closeMemberModal').addEventListener('click', function () {
                document.getElementById('viewMemberModal').style.display = 'none';
            });

            // Save database configuration
            document.getElementById('saveDbConfig').addEventListener('click', function () {
                const url = document.getElementById('supabaseUrl').value.trim();
                const key = document.getElementById('supabaseKey').value.trim();

                if (!url || !key) {
                    showNotification('Please enter both URL and Key', 'error');
                    return;
                }

                localStorage.setItem('supabase_url', url);
                localStorage.setItem('supabase_key', key);

                initSupabase();
                loadDashboardData();

                document.getElementById('dbConfigModal').style.display = 'none';
                showNotification('Database configuration saved', 'success');
            });

            // Close modals when clicking outside
            window.addEventListener('click', function (e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });

            // Close modals with ESC key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });

            // Close modals with close buttons
            document.querySelectorAll('.modal-close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function () {
                    this.closest('.modal').style.display = 'none';
                });
            });

            function updateMobileCloseButton() {
                if (window.innerWidth <= 768) {
                    mobileCloseBtn.style.display = 'block';
                } else {
                    mobileCloseBtn.style.display = 'none';
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }

            updateMobileCloseButton();
            window.addEventListener('resize', updateMobileCloseButton);

            // Initialize password toggles
            initializePasswordToggles();

            // Activate all buttons
            activateAllButtons();

            console.log('Admin dashboard fully initialized with all buttons activated');
        });
    </script>
</body>

</html>
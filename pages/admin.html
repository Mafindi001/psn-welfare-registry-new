<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - PSN Taraba Welfare Registry</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet" href="../styles/admin.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Include Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }

            .dashboard-sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                top: 0;
                left: -100%;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .dashboard-sidebar.mobile-open {
                left: 0;
            }

            .dashboard-main {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }

            .header-actions {
                flex-direction: column;
                gap: 10px;
                margin-top: 15px;
            }

            .header-actions .btn {
                width: 100%;
            }

            .admin-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .reports-grid {
                grid-template-columns: 1fr;
            }

            .monitoring-grid {
                grid-template-columns: 1fr;
            }

            .table-responsive {
                overflow-x: auto;
            }

            .modal-content {
                width: 95%;
                margin: 20px auto;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .settings-tabs {
                flex-wrap: wrap;
            }

            .settings-tab {
                flex: 1 0 50%;
            }
        }

        @media (max-width: 480px) {
            .admin-stats-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions-grid {
                grid-template-columns: 1fr;
            }

            .reminder-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .header-controls {
                flex-direction: column;
                gap: 10px;
            }

            .filter-bar {
                flex-direction: column;
                gap: 10px;
            }

            .date-range {
                flex-direction: column;
            }

            .table-actions {
                flex-direction: column;
                gap: 15px;
            }

            .action-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary-color, #2c5aa0);
            cursor: pointer;
            padding: 10px;
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
        }

        /* Mobile Overlay */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Touch-friendly elements */
        .btn,
        button,
        .nav-item,
        .quick-action-btn {
            min-height: 44px;
            min-width: 44px;
        }

        input,
        select {
            font-size: 16px;
            /* Prevents zoom on iOS */
        }

        /* Loading states */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="dashboard-sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="mobile-close" id="mobileCloseBtn"
                    style="display: none; background: none; border: none; color: white; font-size: 1.5rem; margin-left: auto;">
                    <i class="fas fa-times"></i>
                </button>
                <div class="sidebar-logo admin-logo">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div>
                    <h3 style="margin: 0; font-size: 1.1rem;">PSN Admin</h3>
                    <p style="margin: 0; font-size: 0.8rem; color: var(--text-light);">Welfare Registry</p>
                </div>
            </div>

            <div class="sidebar-user admin-user">
                <p class="user-greeting">Welfare Secretary</p>
                <h2 class="user-name" id="adminName">Loading...</h2>
                <p class="user-psn" id="adminPsn">Loading...</p>
            </div>

            <nav class="sidebar-nav">
                <a href="#admin-dashboard" class="nav-item active" data-section="admin-dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#manage-members" class="nav-item" data-section="manage-members">
                    <i class="fas fa-users"></i>
                    <span>Manage Members</span>
                    <span class="nav-badge" id="membersCount">0</span>
                </a>
                <a href="#reminder-logs" class="nav-item" data-section="reminder-logs">
                    <i class="fas fa-bell"></i>
                    <span>Reminder Logs</span>
                    <span class="nav-badge" id="remindersCount">0</span>
                </a>
                <a href="#upcoming-events" class="nav-item" data-section="upcoming-events">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Upcoming Events</span>
                    <span class="nav-badge" id="eventsCount">0</span>
                </a>
                <a href="#reports" class="nav-item" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="#system-logs" class="nav-item" data-section="system-logs">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Audit Logs</span>
                </a>
                <a href="#settings" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>System Settings</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <a href="../pages/dashboard.html" class="btn btn-outline"
                    style="margin-bottom: 0.5rem; display: block; text-align: center;">
                    <i class="fas fa-user"></i> Switch to Member View
                </a>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="dashboard-main">
            <!-- Header with Mobile Menu Toggle -->
            <header class="dashboard-header">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="header-title">
                    <h1 id="pageTitle">Admin Dashboard</h1>
                    <p id="pageSubtitle" style="color: var(--text-light); margin: 0.5rem 0 0; font-size: 0.95rem;">
                        Welfare Secretary Control Panel
                    </p>
                </div>

                <div class="header-actions">
                    <button class="btn btn-primary" id="refreshDataBtn">
                        <i class="fas fa-sync-alt"></i> <span id="refreshText">Refresh Data</span>
                    </button>
                    <button class="btn btn-secondary" id="quickExportBtn">
                        <i class="fas fa-download"></i> Quick Export
                    </button>
                </div>
            </header>

            <!-- Dashboard Overview Section -->
            <section class="dashboard-section active-section" id="admin-dashboard-section">
                <div class="section-header">
                    <h2>System Overview</h2>
                    <div class="last-updated">
                        <i class="fas fa-clock"></i>
                        Last updated: <span id="lastUpdated">Just now</span>
                    </div>
                </div>

                <!-- Admin Stats Grid -->
                <div class="admin-stats-grid">
                    <div class="admin-stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalMembers">0</h3>
                            <p>Total Members</p>
                            <div class="stat-trend">
                                <i class="fas fa-database"></i>
                                <span>Live Database</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-birthday-cake"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="upcomingCelebrations">0</h3>
                            <p>Upcoming Celebrations</p>
                            <div class="stat-trend">
                                <i class="fas fa-calendar"></i>
                                <span>Next 30 days</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="remindersSent">0</h3>
                            <p>Reminders Sent</p>
                            <div class="stat-trend">
                                <i class="fas fa-check-circle"></i>
                                <span>Database Stored</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeMembers">0</h3>
                            <p>Active Members</p>
                            <div class="stat-trend">
                                <i class="fas fa-chart-line"></i>
                                <span>Real-time Data</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Monitoring -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h2>Database Status</h2>
                        <div class="monitoring-controls">
                            <button class="btn btn-outline btn-sm" id="refreshMonitoring">
                                <i class="fas fa-sync-alt"></i> <span id="monitoringText">Refresh</span>
                            </button>
                        </div>
                    </div>

                    <div class="monitoring-grid">
                        <div class="monitoring-card">
                            <h4>Database Connection</h4>
                            <div class="monitoring-value" id="dbConnection">Checking...</div>
                            <div class="monitoring-list" id="dbStatusList">
                                <div class="metric">
                                    <span>Tables Count</span>
                                    <span class="metric-value" id="tablesCount">0</span>
                                </div>
                                <div class="metric">
                                    <span>Last Sync</span>
                                    <span class="metric-value" id="lastSync">Never</span>
                                </div>
                            </div>
                        </div>

                        <div class="monitoring-card">
                            <h4>System Health</h4>
                            <div class="health-indicator">
                                <div class="health-status" id="systemHealth">Checking...</div>
                                <div class="health-metrics">
                                    <div class="metric">
                                        <span>API Status</span>
                                        <span class="metric-value" id="apiStatus">Checking</span>
                                    </div>
                                    <div class="metric">
                                        <span>Storage</span>
                                        <span class="metric-value" id="storageStatus">Unknown</span>
                                    </div>
                                    <div class="metric">
                                        <span>Backup</span>
                                        <span class="metric-value" id="backupStatus">None</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Quick Actions</h2>
                </div>

                <div class="quick-actions-grid">
                    <button class="quick-action-btn" id="addMemberBtn">
                        <div class="action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <span>Add New Member</span>
                    </button>

                    <button class="quick-action-btn" id="sendAnnouncementBtn">
                        <div class="action-icon">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <span>Send Announcement</span>
                    </button>

                    <button class="quick-action-btn" id="backupDatabaseBtn">
                        <div class="action-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <span>Backup Database</span>
                    </button>

                    <button class="quick-action-btn" id="viewLogsBtn">
                        <div class="action-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <span>View System Logs</span>
                    </button>
                </div>

                <!-- Recent Activity -->
                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Recent Activity</h2>
                    <button class="btn btn-outline btn-sm" id="viewAllActivity">
                        View All
                    </button>
                </div>

                <div class="activity-feed" id="activityFeed">
                    <!-- Activity will be loaded from database -->
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">
                                <strong>Database Connected:</strong> System ready for live data
                            </p>
                            <p class="activity-time">Just now</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Manage Members Section -->
            <section class="dashboard-section" id="manage-members-section" style="display: none;">
                <div class="section-header">
                    <h2>Manage Members</h2>
                    <div class="header-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="memberSearch" placeholder="Search members by name, PSN, or email...">
                        </div>
                        <button class="btn btn-primary" id="addNewMemberBtn">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filter-bar">
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>

                    <select id="memberTypeFilter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="member">Regular Member</option>
                        <option value="admin">Admin</option>
                    </select>

                    <button class="btn btn-outline btn-sm" id="clearFiltersBtn">
                        <i class="fas fa-times"></i> Clear Filters
                    </button>
                </div>

                <!-- Members Table -->
                <div class="table-responsive">
                    <table class="data-table" id="membersTable">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllMembers">
                                </th>
                                <th>PSN Number</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Type</th>
                                <th>Registered</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <!-- Members will be loaded from database -->
                            <tr id="loadingRow">
                                <td colspan="9" style="text-align: center; padding: 40px;">
                                    <div class="spinner"></div> Loading members from database...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Table Actions -->
                <div class="table-actions">
                    <div class="selected-count">
                        <span id="selectedCount">0</span> members selected
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-outline btn-sm" id="exportSelectedBtn" disabled>
                            <i class="fas fa-download"></i> Export Selected
                        </button>
                        <button class="btn btn-outline btn-sm" id="deactivateSelectedBtn" disabled>
                            <i class="fas fa-user-slash"></i> Deactivate
                        </button>
                        <button class="btn btn-outline btn-sm btn-danger" id="deleteSelectedBtn" disabled>
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="membersPagination">
                    <button class="pagination-btn" disabled id="prevPageBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="pagination-info">Page <span id="currentPage">1</span> of <span
                            id="totalPages">1</span></span>
                    <button class="pagination-btn" disabled id="nextPageBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </section>

            <!-- Reminder Logs Section -->
            <section class="dashboard-section" id="reminder-logs-section" style="display: none;">
                <div class="section-header">
                    <h2>Reminder Logs</h2>
                    <div class="header-controls">
                        <div class="date-range">
                            <input type="date" id="reminderStartDate" class="date-input">
                            <span>to</span>
                            <input type="date" id="reminderEndDate" class="date-input">
                            <button class="btn btn-outline btn-sm" id="applyDateRange">
                                Apply
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reminder Stats -->
                <div class="reminder-stats">
                    <div class="reminder-stat">
                        <h3 id="totalReminders">0</h3>
                        <p>Total Sent</p>
                    </div>
                    <div class="reminder-stat">
                        <h3 id="successfulReminders">0</h3>
                        <p>Successful</p>
                    </div>
                    <div class="reminder-stat">
                        <h3 id="failedReminders">0</h3>
                        <p>Failed</p>
                    </div>
                    <div class="reminder-stat">
                        <h3 id="pendingReminders">0</h3>
                        <p>Pending</p>
                    </div>
                </div>

                <!-- Reminder Logs Table -->
                <div class="table-responsive">
                    <table class="data-table" id="remindersTable">
                        <thead>
                            <tr>
                                <th>Sent Date</th>
                                <th>Recipient</th>
                                <th>Event</th>
                                <th>Event Date</th>
                                <th>Status</th>
                                <th>Type</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="remindersTableBody">
                            <!-- Reminder logs will be loaded from database -->
                            <tr id="loadingReminders">
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    <div class="spinner"></div> Loading reminder logs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Upcoming Events Section -->
            <section class="dashboard-section" id="upcoming-events-section" style="display: none;">
                <div class="section-header">
                    <h2>Upcoming Celebrations</h2>
                    <button class="btn btn-primary" id="sendBulkRemindersBtn">
                        <i class="fas fa-bell"></i> Send Bulk Reminders
                    </button>
                </div>

                <!-- Events Calendar View -->
                <div class="calendar-view">
                    <div class="calendar-header">
                        <button class="calendar-nav" id="prevMonth">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="currentMonth">Loading...</h3>
                        <button class="calendar-nav" id="nextMonth">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be generated from database -->
                        <div style="text-align: center; padding: 40px; grid-column: span 7;">
                            <div class="spinner"></div> Loading calendar...
                        </div>
                    </div>
                </div>

                <!-- Upcoming Events List -->
                <div class="upcoming-events-list" id="upcomingEventsList">
                    <!-- Events will be loaded from database -->
                    <div style="text-align: center; padding: 40px;">
                        <div class="spinner"></div> Loading upcoming events...
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section class="dashboard-section" id="reports-section" style="display: none;">
                <div class="section-header">
                    <h2>Reports & Analytics</h2>
                    <button class="btn btn-primary" id="generateReportBtn">
                        <i class="fas fa-file-export"></i> Generate Report
                    </button>
                </div>

                <!-- Report Types -->
                <div class="reports-grid">
                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Member Demographics</h3>
                        <p>Age, gender, location analysis</p>
                        <button class="btn btn-outline btn-sm" data-report="demographics">
                            Generate
                        </button>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-birthday-cake"></i>
                        </div>
                        <h3>Celebration Calendar</h3>
                        <p>Monthly celebration schedule</p>
                        <button class="btn btn-outline btn-sm" data-report="calendar">
                            Generate
                        </button>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <h3>Reminder Analytics</h3>
                        <p>Delivery rates and patterns</p>
                        <button class="btn btn-outline btn-sm" data-report="reminders">
                            Generate
                        </button>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Growth Report</h3>
                        <p>Member registration trends</p>
                        <button class="btn btn-outline btn-sm" data-report="growth">
                            Generate
                        </button>
                    </div>
                </div>

                <!-- Report Preview Area -->
                <div class="report-preview" id="reportPreview" style="display: none;">
                    <div class="preview-header">
                        <h3>Report Preview</h3>
                        <div>
                            <select id="reportFormat" class="form-control"
                                style="display: inline-block; width: auto; margin-right: 10px;">
                                <option value="pdf">PDF</option>
                                <option value="csv">CSV</option>
                                <option value="excel">Excel</option>
                            </select>
                            <button class="btn btn-primary btn-sm" id="downloadReportBtn">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    </div>
                    <div class="preview-content" id="reportContent">
                        <!-- Report content will appear here -->
                    </div>
                </div>
            </section>

            <!-- System Logs Section -->
            <section class="dashboard-section" id="system-logs-section" style="display: none;">
                <div class="section-header">
                    <h2>System Audit Logs</h2>
                    <div class="log-filters">
                        <select id="logTypeFilter" class="filter-select">
                            <option value="">All Actions</option>
                            <option value="login">Logins</option>
                            <option value="registration">Registrations</option>
                            <option value="update">Updates</option>
                            <option value="delete">Deletions</option>
                        </select>
                        <input type="text" id="logSearch" class="search-input" placeholder="Search logs...">
                    </div>
                </div>

                <!-- Logs Table -->
                <div class="table-responsive">
                    <table class="data-table" id="logsTable">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Details</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <!-- Logs will be loaded from database -->
                            <tr id="loadingLogs">
                                <td colspan="5" style="text-align: center; padding: 40px;">
                                    <div class="spinner"></div> Loading audit logs...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- System Settings Section -->
            <section class="dashboard-section" id="settings-section" style="display: none;">
                <div class="section-header">
                    <h2>System Settings</h2>
                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> <span id="saveSettingsText">Save Settings</span>
                    </button>
                </div>

                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">General</button>
                    <button class="settings-tab" data-tab="email">Email Settings</button>
                    <button class="settings-tab" data-tab="security">Security</button>
                    <button class="settings-tab" data-tab="database">Database</button>
                </div>

                <!-- General Settings -->
                <div class="settings-tab-content active" id="general-settings">
                    <div class="settings-group">
                        <h3>Platform Settings</h3>

                        <div class="setting-item">
                            <label for="platformName">Platform Name</label>
                            <input type="text" id="platformName" class="form-control"
                                value="PSN Taraba Welfare Registry">
                        </div>

                        <div class="setting-item">
                            <label for="welfareSecretary">Welfare Secretary Name</label>
                            <input type="text" id="welfareSecretary" class="form-control"
                                value="Dr. Pharmacist Welfare">
                        </div>

                        <div class="setting-item">
                            <label for="contactEmail">Contact Email</label>
                            <input type="email" id="contactEmail" class="form-control" value="welfare@psntaraba.org.ng">
                        </div>

                        <div class="setting-item">
                            <label for="reminderTime">Default Reminder Time</label>
                            <select id="reminderTime" class="form-control">
                                <option value="24">24 hours before</option>
                                <option value="48">48 hours before</option>
                                <option value="72">72 hours before</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Email Settings -->
                <div class="settings-tab-content" id="email-settings">
                    <div class="settings-group">
                        <h3>Email Configuration</h3>

                        <div class="setting-item">
                            <label for="smtpHost">SMTP Host</label>
                            <input type="text" id="smtpHost" class="form-control" value="smtp.gmail.com">
                        </div>

                        <div class="setting-item">
                            <label for="smtpPort">SMTP Port</label>
                            <input type="number" id="smtpPort" class="form-control" value="587">
                        </div>

                        <div class="setting-item">
                            <label for="smtpUser">SMTP Username</label>
                            <input type="text" id="smtpUser" class="form-control" value="welfare@psntaraba.org.ng">
                        </div>

                        <div class="setting-item">
                            <label for="smtpPass">SMTP Password</label>
                            <input type="password" id="smtpPass" class="form-control" placeholder="Enter password">
                        </div>

                        <div class="setting-item">
                            <div class="consent-group">
                                <input type="checkbox" id="emailNotifications" checked>
                                <div class="consent-text">
                                    <label for="emailNotifications">Enable email notifications</label>
                                </div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <button class="btn btn-outline" id="testEmailBtn">
                                <i class="fas fa-paper-plane"></i> Test Email Configuration
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="settings-tab-content" id="security-settings">
                    <div class="settings-group">
                        <h3>Security & Access Control</h3>

                        <div class="setting-item">
                            <div class="consent-group">
                                <input type="checkbox" id="require2FA">
                                <div class="consent-text">
                                    <label for="require2FA">Require two-factor authentication for admins</label>
                                </div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label for="sessionTimeout">Session Timeout (minutes)</label>
                            <input type="number" id="sessionTimeout" class="form-control" value="60" min="15" max="480">
                        </div>

                        <div class="setting-item">
                            <label for="maxLoginAttempts">Max Login Attempts</label>
                            <input type="number" id="maxLoginAttempts" class="form-control" value="5" min="1" max="10">
                        </div>

                        <button class="btn btn-outline" id="viewAccessLogsBtn">
                            <i class="fas fa-shield-alt"></i> View Access Logs
                        </button>
                    </div>
                </div>

                <!-- Database Settings -->
                <div class="settings-tab-content" id="database-settings">
                    <div class="settings-group">
                        <h3>Database Management</h3>

                        <div class="setting-item">
                            <label>Database Status</label>
                            <div class="db-status-indicator">
                                <span class="status-dot" id="dbStatusDot"></span>
                                <span id="dbStatusText">Checking...</span>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label>Last Backup</label>
                            <p id="lastBackup">No backups yet</p>
                        </div>

                        <div class="setting-item">
                            <label>Total Members</label>
                            <p id="dbTotalMembers">0</p>
                        </div>

                        <div class="setting-actions">
                            <button class="btn btn-primary" id="backupNowBtn">
                                <i class="fas fa-database"></i> <span id="backupText">Create Backup</span>
                            </button>
                            <button class="btn btn-outline" id="exportAllDataBtn">
                                <i class="fas fa-file-export"></i> Export All Data
                            </button>
                            <button class="btn btn-outline btn-danger" id="resetDemoBtn">
                                <i class="fas fa-trash"></i> Clear All Data
                            </button>
                        </div>

                        <!-- Database Info -->
                        <div class="database-info-section">
                            <h4>Database Information</h4>
                            <div class="db-info">
                                <div class="info-row">
                                    <span>Provider:</span>
                                    <span>Supabase (PostgreSQL)</span>
                                </div>
                                <div class="info-row">
                                    <span>Tables:</span>
                                    <span id="dbTablesInfo">5 tables</span>
                                </div>
                                <div class="info-row">
                                    <span>Connection:</span>
                                    <span id="dbConnectionInfo">Secure HTTPS</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Member Modal -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Add New Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMemberForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newPsnNumber">PSN Number *</label>
                            <input type="text" id="newPsnNumber" class="form-control" required>
                            <div class="form-text" id="psnValidation"></div>
                        </div>
                        <div class="form-group">
                            <label for="newMemberEmail">Email *</label>
                            <input type="email" id="newMemberEmail" class="form-control" required>
                            <div class="form-text" id="emailValidation"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newMemberName">Full Name *</label>
                        <input type="text" id="newMemberName" class="form-control" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="newMemberPhone">Phone Number *</label>
                            <input type="tel" id="newMemberPhone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newMemberDob">Date of Birth</label>
                            <input type="date" id="newMemberDob" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newMemberPassword">Temporary Password *</label>
                        <input type="password" id="newMemberPassword" class="form-control" required minlength="6">
                        <div class="form-text">Minimum 6 characters. Member will change on first login</div>
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="makeAdmin">
                            <div class="consent-text">
                                <label for="makeAdmin">Grant administrative privileges</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="sendWelcomeEmail" checked>
                            <div class="consent-text">
                                <label for="sendWelcomeEmail">Send welcome email with login instructions</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelAddMember">Cancel</button>
                <button class="btn btn-primary" id="saveNewMember">
                    <span id="saveMemberText">Add Member</span>
                </button>
            </div>
        </div>
    </div>

    <!-- View Member Modal -->
    <div class="modal" id="viewMemberModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Member Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="memberDetailsContent">
                    <!-- Member details will be loaded from database -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeMemberModal">Close</button>
                <button class="btn btn-primary" id="editMemberBtn">Edit Member</button>
            </div>
        </div>
    </div>

    <!-- Database Config Modal -->
    <div class="modal" id="dbConfigModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Database Configuration Required</h3>
            </div>
            <div class="modal-body">
                <p>To use the permanent database features, you need to configure your Supabase credentials.</p>

                <div class="form-group">
                    <label for="supabaseUrl">Supabase URL *</label>
                    <input type="text" id="supabaseUrl" class="form-control"
                        placeholder="https://your-project.supabase.co">
                </div>

                <div class="form-group">
                    <label for="supabaseKey">Supabase Anon Key *</label>
                    <input type="text" id="supabaseKey" class="form-control" placeholder="eyJhbGciOiJIUzI1NiIs...">
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <p>Get these credentials from your Supabase project dashboard → Settings → API</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveDbConfig">Save Configuration</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // ==================== SUPABASE CONFIGURATION ====================
        // You MUST replace these with your actual Supabase credentials
        const SUPABASE_CONFIG = {
            url: localStorage.getItem('supabase_url') || '',
            key: localStorage.getItem('supabase_key') || '',
            tables: {
                members: 'members',
                events: 'events',
                reminders: 'reminder_logs',
                logs: 'system_logs',
                settings: 'system_settings'
            }
        };

        // Initialize Supabase client
        let supabase = null;
        let isDatabaseConnected = false;

        function initSupabase() {
            if (!SUPABASE_CONFIG.url || !SUPABASE_CONFIG.key) {
                console.warn('Supabase credentials not configured');
                showNotification('Database not configured. Using local storage only.', 'warning');
                return false;
            }

            try {
                supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
                console.log('Supabase client initialized');
                return true;
            } catch (error) {
                console.error('Failed to initialize Supabase:', error);
                showNotification('Failed to connect to database', 'error');
                return false;
            }
        }

        // ==================== DATABASE FUNCTIONS ====================

        // Test database connection
        async function testDatabaseConnection() {
            if (!supabase) return false;

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .select('count', { count: 'exact', head: true });

                if (error) throw error;
                isDatabaseConnected = true;
                return true;
            } catch (error) {
                console.error('Database connection test failed:', error);
                isDatabaseConnected = false;
                return false;
            }
        }

        // Load members from database
        async function loadMembersFromDB() {
            if (!supabase) return [];

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Error loading members:', error);
                showNotification('Failed to load members from database', 'error');
                return [];
            }
        }

        // Add member to database
        async function addMemberToDB(memberData) {
            if (!supabase) {
                // Fallback to localStorage
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                memberData.id = Date.now().toString();
                memberData.created_at = new Date().toISOString();
                members.push(memberData);
                localStorage.setItem('psn_members', JSON.stringify(members));
                return { success: true, data: memberData };
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .insert([memberData])
                    .select()
                    .single();

                if (error) throw error;

                // Log the action
                await logSystemAction('member_add', `Added member: ${memberData.full_name}`);

                return { success: true, data };
            } catch (error) {
                console.error('Error adding member:', error);
                return { success: false, error: error.message };
            }
        }

        // Update member in database
        async function updateMemberInDB(id, updates) {
            if (!supabase) {
                // Fallback to localStorage
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                const index = members.findIndex(m => m.id === id);
                if (index !== -1) {
                    members[index] = { ...members[index], ...updates };
                    localStorage.setItem('psn_members', JSON.stringify(members));
                }
                return { success: true };
            }

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .update(updates)
                    .eq('id', id)
                    .select()
                    .single();

                if (error) throw error;
                await logSystemAction('member_update', `Updated member: ${id}`);
                return { success: true, data };
            } catch (error) {
                console.error('Error updating member:', error);
                return { success: false, error: error.message };
            }
        }

        // Delete member from database
        async function deleteMemberFromDB(id) {
            if (!supabase) {
                // Fallback to localStorage
                const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                const filtered = members.filter(m => m.id !== id);
                localStorage.setItem('psn_members', JSON.stringify(filtered));
                return { success: true };
            }

            try {
                const { error } = await supabase
                    .from(SUPABASE_CONFIG.tables.members)
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                await logSystemAction('member_delete', `Deleted member: ${id}`);
                return { success: true };
            } catch (error) {
                console.error('Error deleting member:', error);
                return { success: false, error: error.message };
            }
        }

        // Load system logs from database
        async function loadSystemLogsFromDB() {
            if (!supabase) return [];

            try {
                const { data, error } = await supabase
                    .from(SUPABASE_CONFIG.tables.logs)
                    .select(`
                        *,
                        member:members(full_name, email)
                    `)
                    .order('created_at', { ascending: false })
                    .limit(100);

                if (error) throw error;
                return data || [];
            } catch (error) {
                console.error('Error loading logs:', error);
                return [];
            }
        }

        // Log system action to database
        async function logSystemAction(action, details) {
            const user = getCurrentUser();
            if (!user || !supabase) return;

            try {
                await supabase
                    .from(SUPABASE_CONFIG.tables.logs)
                    .insert([{
                        user_id: user.id,
                        action: action,
                        details: details,
                        ip_address: await getClientIP(),
                        created_at: new Date().toISOString()
                    }]);
            } catch (error) {
                console.error('Error logging action:', error);
            }
        }

        // Get client IP (simplified)
        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch {
                return 'unknown';
            }
        }

        // ==================== AUTHENTICATION & UI FUNCTIONS ====================

        function requireAuth() {
            const token = localStorage.getItem('psn_welfare_token');
            const user = localStorage.getItem('psn_welfare_user');

            if (!token || !user) {
                window.location.href = '../pages/admin-login.html';
                return false;
            }

            try {
                const userData = JSON.parse(user);
                if (!userData.is_admin && !userData.isAdmin) {
                    window.location.href = '../pages/dashboard.html';
                    return false;
                }
                return true;
            } catch {
                window.location.href = '../pages/admin-login.html';
                return false;
            }
        }

        function getCurrentUser() {
            const user = localStorage.getItem('psn_welfare_user');
            if (user) {
                try {
                    return JSON.parse(user);
                } catch {
                    return null;
                }
            }
            return null;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('notification-hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // ==================== DASHBOARD DATA LOADING ====================

        async function loadDashboardData() {
            const refreshBtn = document.getElementById('refreshDataBtn');
            const refreshText = document.getElementById('refreshText');

            // Show loading state
            refreshBtn.classList.add('loading');
            refreshText.innerHTML = '<span class="spinner"></span> Refreshing...';

            try {
                // Test database connection
                const dbConnected = await testDatabaseConnection();

                if (dbConnected && supabase) {
                    // Load real data from database
                    const members = await loadMembersFromDB();
                    const activeMembers = members.filter(m => m.is_active).length;

                    // Update UI with real data
                    document.getElementById('totalMembers').textContent = members.length;
                    document.getElementById('activeMembers').textContent = activeMembers;
                    document.getElementById('membersCount').textContent = members.length;

                    // Update database status
                    document.getElementById('dbConnection').textContent = 'Connected';
                    document.getElementById('dbConnection').style.color = '#28a745';
                    document.getElementById('tablesCount').textContent = '5 tables';
                    document.getElementById('systemHealth').textContent = 'Healthy';
                    document.getElementById('apiStatus').textContent = 'Online';

                    // Update recent activity from logs
                    const logs = await loadSystemLogsFromDB();
                    updateActivityFeed(logs.slice(0, 5));

                    showNotification('Data refreshed from database', 'success');
                } else {
                    // Fallback to localStorage
                    const members = JSON.parse(localStorage.getItem('psn_members') || '[]');
                    document.getElementById('totalMembers').textContent = members.length;
                    document.getElementById('activeMembers').textContent = members.filter(m => m.is_active !== false).length;
                    document.getElementById('membersCount').textContent = members.length;

                    document.getElementById('dbConnection').textContent = 'Local Storage';
                    document.getElementById('dbConnection').style.color = '#ffc107';
                    document.getElementById('systemHealth').textContent = 'Limited';
                    document.getElementById('apiStatus').textContent = 'Offline';

                    showNotification('Using local storage (database not configured)', 'warning');
                }

                // Update last updated time
                document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('Error loading data', 'error');
            } finally {
                // Remove loading state
                refreshBtn.classList.remove('loading');
                refreshText.textContent = 'Refresh Data';
            }
        }

        function updateActivityFeed(logs) {
            const activityFeed = document.getElementById('activityFeed');
            if (!activityFeed) return;

            if (logs.length === 0) {
                activityFeed.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">
                                <strong>No recent activity</strong>
                            </p>
                            <p class="activity-time">System ready</p>
                        </div>
                    </div>
                `;
                return;
            }

            activityFeed.innerHTML = logs.map(log => `
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="fas fa-${getActionIcon(log.action)}"></i>
                    </div>
                    <div class="activity-content">
                        <p class="activity-text">
                            <strong>${log.member?.full_name || 'System'}:</strong> ${log.details}
                        </p>
                        <p class="activity-time">${formatTimeAgo(log.created_at)}</p>
                    </div>
                </div>
            `).join('');
        }

        function getActionIcon(action) {
            const icons = {
                login: 'sign-in-alt',
                logout: 'sign-out-alt',
                member_add: 'user-plus',
                member_update: 'user-edit',
                member_delete: 'user-minus',
                default: 'clipboard-list'
            };
            return icons[action] || icons.default;
        }

        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        // ==================== MEMBERS MANAGEMENT ====================

        async function loadMembersData() {
            const tbody = document.getElementById('membersTableBody');
            if (!tbody) return;

            tbody.innerHTML = `
                <tr id="loadingRow">
                    <td colspan="9" style="text-align: center; padding: 40px;">
                        <div class="spinner"></div> Loading members from database...
                    </td>
                </tr>
            `;

            try {
                const members = await loadMembersFromDB();

                if (members.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">
                                <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                <p>No members found. Add your first member!</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = '';

                members.forEach(member => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><input type="checkbox" class="member-checkbox" data-id="${member.id}"></td>
                        <td>${member.psn_number || member.psn || 'N/A'}</td>
                        <td>${member.full_name}</td>
                        <td>${member.email}</td>
                        <td>${member.phone || 'N/A'}</td>
                        <td><span class="status-badge ${member.is_active ? 'active' : 'inactive'}">${member.is_active ? 'Active' : 'Inactive'}</span></td>
                        <td><span class="type-badge ${member.is_admin ? 'admin' : 'member'}">${member.is_admin ? 'Admin' : 'Member'}</span></td>
                        <td>${new Date(member.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-outline btn-sm view-member-btn" data-id="${member.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm edit-member-btn" data-id="${member.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                // Add event listeners
                document.querySelectorAll('.member-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', updateSelectedCount);
                });

                document.querySelectorAll('.view-member-btn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const memberId = this.getAttribute('data-id');
                        viewMember(memberId);
                    });
                });

                document.querySelectorAll('.edit-member-btn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const memberId = this.getAttribute('data-id');
                        editMember(memberId);
                    });
                });

            } catch (error) {
                console.error('Error loading members:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #dc3545;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            <p>Error loading members. Please try again.</p>
                        </td>
                    </tr>
                `;
            }
        }

        async function viewMember(memberId) {
            try {
                const members = await loadMembersFromDB();
                const member = members.find(m => m.id === memberId);

                if (!member) {
                    showNotification('Member not found', 'error');
                    return;
                }

                const content = document.getElementById('memberDetailsContent');
                content.innerHTML = `
                    <div class="member-details">
                        <div class="detail-row">
                            <strong>PSN Number:</strong> ${member.psn_number || member.psn || 'N/A'}
                        </div>
                        <div class="detail-row">
                            <strong>Full Name:</strong> ${member.full_name}
                        </div>
                        <div class="detail-row">
                            <strong>Email:</strong> ${member.email}
                        </div>
                        <div class="detail-row">
                            <strong>Phone:</strong> ${member.phone || 'N/A'}
                        </div>
                        <div class="detail-row">
                            <strong>Date of Birth:</strong> ${member.date_of_birth ? new Date(member.date_of_birth).toLocaleDateString() : 'Not set'}
                        </div>
                        <div class="detail-row">
                            <strong>Status:</strong> <span class="status-badge ${member.is_active ? 'active' : 'inactive'}">${member.is_active ? 'Active' : 'Inactive'}</span>
                        </div>
                        <div class="detail-row">
                            <strong>Type:</strong> <span class="type-badge ${member.is_admin ? 'admin' : 'member'}">${member.is_admin ? 'Administrator' : 'Regular Member'}</span>
                        </div>
                        <div class="detail-row">
                            <strong>Registered:</strong> ${new Date(member.created_at).toLocaleString()}
                        </div>
                        <div class="detail-row">
                            <strong>Last Updated:</strong> ${member.updated_at ? new Date(member.updated_at).toLocaleString() : 'Never'}
                        </div>
                    </div>
                `;

                document.getElementById('viewMemberModal').style.display = 'block';

            } catch (error) {
                console.error('Error viewing member:', error);
                showNotification('Error loading member details', 'error');
            }
        }

        async function editMember(memberId) {
            showNotification('Edit functionality will be implemented in the next update', 'info');
            // TODO: Implement edit modal
        }

        // ==================== MAIN INITIALIZATION ====================

        document.addEventListener('DOMContentLoaded', async function () {
            // Check authentication
            if (!requireAuth()) return;

            // Initialize Supabase
            const dbInitialized = initSupabase();

            // Load admin info
            const user = getCurrentUser();
            if (user) {
                document.getElementById('adminName').textContent = user.full_name || user.fullName || 'Admin User';
                document.getElementById('adminPsn').textContent = user.psn_number || user.psn || 'System Administrator';
            }

            // Check if database is configured
            if (!SUPABASE_CONFIG.url || !SUPABASE_CONFIG.key) {
                document.getElementById('dbConfigModal').style.display = 'block';
            }

            // Load initial dashboard data
            await loadDashboardData();

            // ==================== EVENT LISTENERS ====================

            // Mobile menu
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const mobileCloseBtn = document.getElementById('mobileCloseBtn');
            const mobileOverlay = document.getElementById('mobileOverlay');
            const sidebar = document.getElementById('sidebar');

            function toggleMobileMenu() {
                sidebar.classList.toggle('mobile-open');
                mobileOverlay.classList.toggle('active');
                document.body.style.overflow = sidebar.classList.contains('mobile-open') ? 'hidden' : '';
            }

            if (mobileMenuToggle) mobileMenuToggle.addEventListener('click', toggleMobileMenu);
            if (mobileCloseBtn) mobileCloseBtn.addEventListener('click', toggleMobileMenu);
            if (mobileOverlay) mobileOverlay.addEventListener('click', toggleMobileMenu);

            // Navigation
            const navItems = document.querySelectorAll('.nav-item[data-section]');
            const sections = {
                'admin-dashboard': document.getElementById('admin-dashboard-section'),
                'manage-members': document.getElementById('manage-members-section'),
                'reminder-logs': document.getElementById('reminder-logs-section'),
                'upcoming-events': document.getElementById('upcoming-events-section'),
                'reports': document.getElementById('reports-section'),
                'system-logs': document.getElementById('system-logs-section'),
                'settings': document.getElementById('settings-section')
            };

            navItems.forEach(item => {
                item.addEventListener('click', function (e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');

                    // Update active nav
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    // Hide all sections, show selected
                    Object.values(sections).forEach(section => {
                        if (section) section.style.display = 'none';
                    });

                    if (sections[sectionId]) {
                        sections[sectionId].style.display = 'block';

                        // Update page title
                        const titles = {
                            'admin-dashboard': { title: 'Admin Dashboard', subtitle: 'Welfare Secretary Control Panel' },
                            'manage-members': { title: 'Manage Members', subtitle: 'View and manage all registered members' },
                            'reminder-logs': { title: 'Reminder Logs', subtitle: 'View reminder delivery history and statistics' },
                            'upcoming-events': { title: 'Upcoming Celebrations', subtitle: 'View and manage upcoming birthdays and anniversaries' },
                            'reports': { title: 'Reports & Analytics', subtitle: 'Generate and download system reports' },
                            'system-logs': { title: 'Audit Logs', subtitle: 'View system activity and audit trail' },
                            'settings': { title: 'System Settings', subtitle: 'Configure platform settings and preferences' }
                        };

                        const pageTitle = document.getElementById('pageTitle');
                        const pageSubtitle = document.getElementById('pageSubtitle');
                        if (titles[sectionId]) {
                            pageTitle.textContent = titles[sectionId].title;
                            pageSubtitle.textContent = titles[sectionId].subtitle;
                        }

                        // Load section data
                        loadSectionData(sectionId);
                    }

                    // Close mobile menu
                    if (window.innerWidth <= 768) {
                        toggleMobileMenu();
                    }
                });
            });

            // Load section data
            function loadSectionData(sectionId) {
                switch (sectionId) {
                    case 'manage-members':
                        loadMembersData();
                        break;
                    case 'system-logs':
                        loadAuditLogs();
                        break;
                    case 'settings':
                        loadSettingsData();
                        break;
                }
            }

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', function () {
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('psn_welfare_token');
                    localStorage.removeItem('psn_welfare_user');
                    window.location.href = '../pages/admin-login.html';
                }
            });

            // Refresh data
            document.getElementById('refreshDataBtn').addEventListener('click', loadDashboardData);

            // Quick actions
            document.getElementById('addMemberBtn').addEventListener('click', function () {
                document.getElementById('addMemberModal').style.display = 'block';
            });

            document.getElementById('addNewMemberBtn').addEventListener('click', function () {
                document.getElementById('addMemberModal').style.display = 'block';
            });

            // Add member form submission
            document.getElementById('saveNewMember').addEventListener('click', async function () {
                const saveBtn = this;
                const saveText = document.getElementById('saveMemberText');
                const originalText = saveText.textContent;

                // Get form values
                const memberData = {
                    psn_number: document.getElementById('newPsnNumber').value.trim(),
                    full_name: document.getElementById('newMemberName').value.trim(),
                    email: document.getElementById('newMemberEmail').value.trim(),
                    phone: document.getElementById('newMemberPhone').value.trim(),
                    date_of_birth: document.getElementById('newMemberDob').value || null,
                    password_hash: btoa(document.getElementById('newMemberPassword').value), // Simple encoding
                    is_admin: document.getElementById('makeAdmin').checked,
                    is_active: true,
                    created_at: new Date().toISOString()
                };

                // Validation
                if (!memberData.psn_number || !memberData.full_name || !memberData.email || !memberData.phone) {
                    showNotification('Please fill all required fields', 'error');
                    return;
                }

                // Show loading
                saveBtn.disabled = true;
                saveText.innerHTML = '<span class="spinner"></span> Saving...';

                try {
                    const result = await addMemberToDB(memberData);

                    if (result.success) {
                        showNotification(`Member ${memberData.full_name} added successfully`, 'success');
                        document.getElementById('addMemberModal').style.display = 'none';
                        document.getElementById('addMemberForm').reset();

                        // Refresh data
                        await loadDashboardData();
                        if (document.getElementById('manage-members-section').style.display !== 'none') {
                            await loadMembersData();
                        }
                    } else {
                        showNotification(`Error: ${result.error}`, 'error');
                    }
                } catch (error) {
                    showNotification('Error saving member', 'error');
                } finally {
                    // Reset button
                    saveBtn.disabled = false;
                    saveText.textContent = originalText;
                }
            });

            // Cancel add member
            document.getElementById('cancelAddMember').addEventListener('click', function () {
                document.getElementById('addMemberModal').style.display = 'none';
                document.getElementById('addMemberForm').reset();
            });

            // Close member modal
            document.getElementById('closeMemberModal').addEventListener('click', function () {
                document.getElementById('viewMemberModal').style.display = 'none';
            });

            // Database configuration
            document.getElementById('saveDbConfig').addEventListener('click', function () {
                const url = document.getElementById('supabaseUrl').value.trim();
                const key = document.getElementById('supabaseKey').value.trim();

                if (!url || !key) {
                    showNotification('Please enter both URL and Key', 'error');
                    return;
                }

                localStorage.setItem('supabase_url', url);
                localStorage.setItem('supabase_key', key);

                // Reinitialize Supabase
                initSupabase();
                loadDashboardData();

                document.getElementById('dbConfigModal').style.display = 'none';
                showNotification('Database configuration saved', 'success');
            });

            // Close modals when clicking outside
            window.addEventListener('click', function (e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });

            // Close modals with escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });

            // Update mobile close button visibility
            function updateMobileCloseButton() {
                if (window.innerWidth <= 768) {
                    mobileCloseBtn.style.display = 'block';
                } else {
                    mobileCloseBtn.style.display = 'none';
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }

            updateMobileCloseButton();
            window.addEventListener('resize', updateMobileCloseButton);

            console.log('Admin dashboard initialized with database support');
        });
    </script>

    <!-- Notification Styles -->
    <style>
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .notification-success {
            background: #28a745;
            border-left: 4px solid #1e7e34;
        }

        .notification-error {
            background: #dc3545;
            border-left: 4px solid #bd2130;
        }

        .notification-warning {
            background: #ffc107;
            border-left: 4px solid #d39e00;
            color: #212529;
        }

        .notification-info {
            background: #17a2b8;
            border-left: 4px solid #117a8b;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-hide {
            animation: slideOut 0.3s ease forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Status badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .type-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .type-badge.member {
            background: #e3f2fd;
            color: #1565c0;
        }

        .type-badge.admin {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        /* Member details */
        .member-details {
            padding: 20px;
        }

        .detail-row {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .detail-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .detail-row strong {
            min-width: 150px;
        }

        /* Database status indicator */
        .db-status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #6c757d;
        }

        .status-dot.connected {
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }

            100% {
                opacity: 1;
            }
        }

        /* Alert styles */
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .alert-info {
            background: #d1ecf1;
            border-left: 4px solid #117a8b;
            color: #0c5460;
        }

        /* Database info */
        .db-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .info-row:last-child {
            border-bottom: none;
        }
    </style>
</body>

</html>
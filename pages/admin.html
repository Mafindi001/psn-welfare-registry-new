<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - PSN Taraba Welfare Registry</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet" href="../styles/admin.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }

            .dashboard-sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                top: 0;
                left: -100%;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .dashboard-sidebar.mobile-open {
                left: 0;
            }

            .dashboard-main {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }

            .header-actions {
                flex-direction: column;
                gap: 10px;
                margin-top: 15px;
            }

            .header-actions .btn {
                width: 100%;
            }

            .admin-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .reports-grid {
                grid-template-columns: 1fr;
            }

            .monitoring-grid {
                grid-template-columns: 1fr;
            }

            .table-responsive {
                overflow-x: auto;
            }

            .modal-content {
                width: 95%;
                margin: 20px auto;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .settings-tabs {
                flex-wrap: wrap;
            }

            .settings-tab {
                flex: 1 0 50%;
            }
        }

        @media (max-width: 480px) {
            .admin-stats-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions-grid {
                grid-template-columns: 1fr;
            }

            .reminder-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .header-controls {
                flex-direction: column;
                gap: 10px;
            }

            .filter-bar {
                flex-direction: column;
                gap: 10px;
            }

            .date-range {
                flex-direction: column;
            }

            .table-actions {
                flex-direction: column;
                gap: 15px;
            }

            .action-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary-color, #2c5aa0);
            cursor: pointer;
            padding: 10px;
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
        }

        /* Mobile Overlay */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Touch-friendly elements */
        .btn,
        button,
        .nav-item,
        .quick-action-btn {
            min-height: 44px;
            min-width: 44px;
        }

        input,
        select {
            font-size: 16px;
            /* Prevents zoom on iOS */
        }
    </style>
</head>

<body>
    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="dashboard-sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="mobile-close" id="mobileCloseBtn"
                    style="display: none; background: none; border: none; color: white; font-size: 1.5rem; margin-left: auto;">
                    <i class="fas fa-times"></i>
                </button>
                <div class="sidebar-logo admin-logo">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div>
                    <h3 style="margin: 0; font-size: 1.1rem;">PSN Admin</h3>
                    <p style="margin: 0; font-size: 0.8rem; color: var(--text-light);">Welfare Registry</p>
                </div>
            </div>

            <div class="sidebar-user admin-user">
                <p class="user-greeting">Welfare Secretary</p>
                <h2 class="user-name" id="adminName">Admin User</h2>
                <p class="user-psn" id="adminPsn">Loading...</p>
            </div>

            <nav class="sidebar-nav">
                <a href="#admin-dashboard" class="nav-item active" data-section="admin-dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#manage-members" class="nav-item" data-section="manage-members">
                    <i class="fas fa-users"></i>
                    <span>Manage Members</span>
                    <span class="nav-badge" id="membersCount">0</span>
                </a>
                <a href="#reminder-logs" class="nav-item" data-section="reminder-logs">
                    <i class="fas fa-bell"></i>
                    <span>Reminder Logs</span>
                    <span class="nav-badge" id="remindersCount">0</span>
                </a>
                <a href="#upcoming-events" class="nav-item" data-section="upcoming-events">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Upcoming Events</span>
                    <span class="nav-badge" id="eventsCount">0</span>
                </a>
                <a href="#reports" class="nav-item" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="#system-logs" class="nav-item" data-section="system-logs">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Audit Logs</span>
                </a>
                <a href="#settings" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>System Settings</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <a href="../dashboard" class="btn btn-outline"
                    style="margin-bottom: 0.5rem; display: block; text-align: center;">
                    <i class="fas fa-user"></i> Switch to Member View
                </a>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="dashboard-main">
            <!-- Header with Mobile Menu Toggle -->
            <header class="dashboard-header">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="header-title">
                    <h1 id="pageTitle">Admin Dashboard</h1>
                    <p id="pageSubtitle" style="color: var(--text-light); margin: 0.5rem 0 0; font-size: 0.95rem;">
                        Welfare Secretary Control Panel
                    </p>
                </div>

                <div class="header-actions">
                    <button class="btn btn-primary" id="refreshDataBtn">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                    <button class="btn btn-secondary" id="quickExportBtn">
                        <i class="fas fa-download"></i> Quick Export
                    </button>
                </div>
            </header>

            <!-- Dashboard Overview Section -->
            <section class="dashboard-section active-section" id="admin-dashboard-section">
                <div class="section-header">
                    <h2>System Overview</h2>
                    <div class="last-updated">
                        <i class="fas fa-clock"></i>
                        Last updated: <span id="lastUpdated">Just now</span>
                    </div>
                </div>

                <!-- Admin Stats Grid -->
                <div class="admin-stats-grid">
                    <div class="admin-stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalMembers">0</h3>
                            <p>Total Members</p>
                            <div class="stat-trend">
                                <i class="fas fa-arrow-up"></i>
                                <span>+12 this month</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-birthday-cake"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="upcomingCelebrations">0</h3>
                            <p>Upcoming Celebrations</p>
                            <div class="stat-trend">
                                <i class="fas fa-calendar"></i>
                                <span>Next 30 days</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="remindersSent">0</h3>
                            <p>Reminders Sent</p>
                            <div class="stat-trend">
                                <i class="fas fa-check-circle"></i>
                                <span>98% success rate</span>
                            </div>
                        </div>
                    </div>

                    <div class="admin-stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeMembers">0</h3>
                            <p>Active Members</p>
                            <div class="stat-trend">
                                <i class="fas fa-chart-line"></i>
                                <span>95% active rate</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Real-time Monitoring -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h2>Real-time Monitoring</h2>
                        <div class="monitoring-controls">
                            <button class="btn btn-outline btn-sm" id="refreshMonitoring">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>

                    <div class="monitoring-grid">
                        <div class="monitoring-card">
                            <h4>Active Users</h4>
                            <div class="monitoring-value" id="activeUsersCount">0</div>
                            <div class="monitoring-list" id="activeUsersList">
                                <!-- Active users will be loaded here -->
                            </div>
                        </div>

                        <div class="monitoring-card">
                            <h4>System Health</h4>
                            <div class="health-indicator">
                                <div class="health-status" id="systemHealth">Healthy</div>
                                <div class="health-metrics">
                                    <div class="metric">
                                        <span>API Response</span>
                                        <span class="metric-value" id="apiResponseTime">25ms</span>
                                    </div>
                                    <div class="metric">
                                        <span>Database</span>
                                        <span class="metric-value" id="dbStatus">Online</span>
                                    </div>
                                    <div class="metric">
                                        <span>Email Service</span>
                                        <span class="metric-value" id="emailStatus">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Quick Actions</h2>
                </div>

                <div class="quick-actions-grid">
                    <button class="quick-action-btn" id="addMemberBtn">
                        <div class="action-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <span>Add New Member</span>
                    </button>

                    <button class="quick-action-btn" id="sendAnnouncementBtn">
                        <div class="action-icon">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <span>Send Announcement</span>
                    </button>

                    <button class="quick-action-btn" id="viewReportsBtn">
                        <div class="action-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <span>View Reports</span>
                    </button>

                    <button class="quick-action-btn" id="systemHealthBtn">
                        <div class="action-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <span>System Health</span>
                    </button>
                </div>

                <!-- Recent Activity -->
                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Recent Activity</h2>
                    <button class="btn btn-outline btn-sm" id="viewAllActivity">
                        View All
                    </button>
                </div>

                <div class="activity-feed" id="activityFeed">
                    <!-- Activity items will be loaded here -->
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">
                                <strong>New member registered:</strong> Dr. Sarah Johnson (PSN-TARA-2024-045)
                            </p>
                            <p class="activity-time">10 minutes ago</p>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">
                                <strong>Reminder sent:</strong> Birthday reminder for Dr. James Williams
                            </p>
                            <p class="activity-time">2 hours ago</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Manage Members Section -->
            <section class="dashboard-section" id="manage-members-section" style="display: none;">
                <div class="section-header">
                    <h2>Manage Members</h2>
                    <div class="header-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="memberSearch" placeholder="Search members by name, PSN, or email...">
                        </div>
                        <button class="btn btn-primary" id="addNewMemberBtn">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filter-bar">
                    <select id="statusFilter" class="filter-select">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>

                    <select id="memberTypeFilter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="member">Regular Member</option>
                        <option value="admin">Admin</option>
                    </select>

                    <button class="btn btn-outline btn-sm" id="clearFiltersBtn">
                        <i class="fas fa-times"></i> Clear Filters
                    </button>
                </div>

                <!-- Members Table -->
                <div class="table-responsive">
                    <table class="data-table" id="membersTable">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllMembers">
                                </th>
                                <th>PSN Number</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Type</th>
                                <th>Registered</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="membersTableBody">
                            <!-- Members will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Table Actions -->
                <div class="table-actions">
                    <div class="selected-count">
                        <span id="selectedCount">0</span> members selected
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-outline btn-sm" id="exportSelectedBtn" disabled>
                            <i class="fas fa-download"></i> Export Selected
                        </button>
                        <button class="btn btn-outline btn-sm" id="deactivateSelectedBtn" disabled>
                            <i class="fas fa-user-slash"></i> Deactivate
                        </button>
                        <button class="btn btn-outline btn-sm btn-danger" id="deleteSelectedBtn" disabled>
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="membersPagination">
                    <button class="pagination-btn" disabled id="prevPageBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="pagination-info">Page <span id="currentPage">1</span> of <span
                            id="totalPages">1</span></span>
                    <button class="pagination-btn" disabled id="nextPageBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </section>

            <!-- Reminder Logs Section -->
            <section class="dashboard-section" id="reminder-logs-section" style="display: none;">
                <div class="section-header">
                    <h2>Reminder Logs</h2>
                    <div class="header-controls">
                        <div class="date-range">
                            <input type="date" id="reminderStartDate" class="date-input">
                            <span>to</span>
                            <input type="date" id="reminderEndDate" class="date-input">
                            <button class="btn btn-outline btn-sm" id="applyDateRange">
                                Apply
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reminder Stats -->
                <div class="reminder-stats">
                    <div class="reminder-stat">
                        <h3 id="totalReminders">0</h3>
                        <p>Total Sent</p>
                    </div>
                    <div class="reminder-stat">
                        <h3 id="successfulReminders">0</h3>
                        <p>Successful</p>
                    </div>
                    <div class="reminder-stat">
                        <h3 id="failedReminders">0</h3>
                        <p>Failed</p>
                    </div>
                    <div class="reminder-stat">
                        <h3 id="pendingReminders">0</h3>
                        <p>Pending</p>
                    </div>
                </div>

                <!-- Reminder Logs Table -->
                <div class="table-responsive">
                    <table class="data-table" id="remindersTable">
                        <thead>
                            <tr>
                                <th>Sent Date</th>
                                <th>Recipient</th>
                                <th>Event</th>
                                <th>Event Date</th>
                                <th>Status</th>
                                <th>Type</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="remindersTableBody">
                            <!-- Reminder logs will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Upcoming Events Section -->
            <section class="dashboard-section" id="upcoming-events-section" style="display: none;">
                <div class="section-header">
                    <h2>Upcoming Celebrations</h2>
                    <button class="btn btn-primary" id="sendBulkRemindersBtn">
                        <i class="fas fa-bell"></i> Send Bulk Reminders
                    </button>
                </div>

                <!-- Events Calendar View -->
                <div class="calendar-view">
                    <div class="calendar-header">
                        <button class="calendar-nav" id="prevMonth">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h3 id="currentMonth">May 2024</h3>
                        <button class="calendar-nav" id="nextMonth">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar will be generated here -->
                    </div>
                </div>

                <!-- Upcoming Events List -->
                <div class="upcoming-events-list" id="upcomingEventsList">
                    <!-- Events will be loaded here -->
                </div>
            </section>

            <!-- Reports Section -->
            <section class="dashboard-section" id="reports-section" style="display: none;">
                <div class="section-header">
                    <h2>Reports & Analytics</h2>
                    <button class="btn btn-primary" id="generateReportBtn">
                        <i class="fas fa-file-export"></i> Generate Report
                    </button>
                </div>

                <!-- Report Types -->
                <div class="reports-grid">
                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Member Demographics</h3>
                        <p>Age, gender, location analysis</p>
                        <button class="btn btn-outline btn-sm" data-report="demographics">
                            Generate
                        </button>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-birthday-cake"></i>
                        </div>
                        <h3>Celebration Calendar</h3>
                        <p>Monthly celebration schedule</p>
                        <button class="btn btn-outline btn-sm" data-report="calendar">
                            Generate
                        </button>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <h3>Reminder Analytics</h3>
                        <p>Delivery rates and patterns</p>
                        <button class="btn btn-outline btn-sm" data-report="reminders">
                            Generate
                        </button>
                    </div>

                    <div class="report-card">
                        <div class="report-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Growth Report</h3>
                        <p>Member registration trends</p>
                        <button class="btn btn-outline btn-sm" data-report="growth">
                            Generate
                        </button>
                    </div>
                </div>

                <!-- Report Preview Area -->
                <div class="report-preview" id="reportPreview" style="display: none;">
                    <div class="preview-header">
                        <h3>Report Preview</h3>
                        <div>
                            <select id="reportFormat" class="form-control"
                                style="display: inline-block; width: auto; margin-right: 10px;">
                                <option value="pdf">PDF</option>
                                <option value="csv">CSV</option>
                                <option value="excel">Excel</option>
                            </select>
                            <button class="btn btn-primary btn-sm" id="downloadReportBtn">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    </div>
                    <div class="preview-content" id="reportContent">
                        <!-- Report content will appear here -->
                    </div>
                </div>
            </section>

            <!-- System Logs Section -->
            <section class="dashboard-section" id="system-logs-section" style="display: none;">
                <div class="section-header">
                    <h2>System Audit Logs</h2>
                    <div class="log-filters">
                        <select id="logTypeFilter" class="filter-select">
                            <option value="">All Actions</option>
                            <option value="login">Logins</option>
                            <option value="registration">Registrations</option>
                            <option value="update">Updates</option>
                            <option value="delete">Deletions</option>
                        </select>
                        <input type="text" id="logSearch" class="search-input" placeholder="Search logs...">
                    </div>
                </div>

                <!-- Logs Table -->
                <div class="table-responsive">
                    <table class="data-table" id="logsTable">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Details</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <!-- Logs will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- System Settings Section -->
            <section class="dashboard-section" id="settings-section" style="display: none;">
                <div class="section-header">
                    <h2>System Settings</h2>
                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>

                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">General</button>
                    <button class="settings-tab" data-tab="email">Email Settings</button>
                    <button class="settings-tab" data-tab="security">Security</button>
                    <button class="settings-tab" data-tab="backup">Backup</button>
                </div>

                <!-- General Settings -->
                <div class="settings-tab-content active" id="general-settings">
                    <div class="settings-group">
                        <h3>Platform Settings</h3>

                        <div class="setting-item">
                            <label for="platformName">Platform Name</label>
                            <input type="text" id="platformName" class="form-control"
                                value="PSN Taraba Welfare Registry">
                        </div>

                        <div class="setting-item">
                            <label for="welfareSecretary">Welfare Secretary Name</label>
                            <input type="text" id="welfareSecretary" class="form-control"
                                value="Dr. Pharmacist Welfare">
                        </div>

                        <div class="setting-item">
                            <label for="contactEmail">Contact Email</label>
                            <input type="email" id="contactEmail" class="form-control" value="welfare@psntaraba.org.ng">
                        </div>

                        <div class="setting-item">
                            <label for="reminderTime">Default Reminder Time</label>
                            <select id="reminderTime" class="form-control">
                                <option value="24">24 hours before</option>
                                <option value="48">48 hours before</option>
                                <option value="72">72 hours before</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Email Settings -->
                <div class="settings-tab-content" id="email-settings">
                    <div class="settings-group">
                        <h3>Email Configuration</h3>

                        <div class="setting-item">
                            <label for="smtpHost">SMTP Host</label>
                            <input type="text" id="smtpHost" class="form-control" value="smtp.gmail.com">
                        </div>

                        <div class="setting-item">
                            <label for="smtpPort">SMTP Port</label>
                            <input type="number" id="smtpPort" class="form-control" value="587">
                        </div>

                        <div class="setting-item">
                            <label for="smtpUser">SMTP Username</label>
                            <input type="text" id="smtpUser" class="form-control" value="welfare@psntaraba.org.ng">
                        </div>

                        <div class="setting-item">
                            <label for="smtpPass">SMTP Password</label>
                            <input type="password" id="smtpPass" class="form-control" placeholder="Enter password">
                        </div>

                        <div class="setting-item">
                            <div class="consent-group">
                                <input type="checkbox" id="emailNotifications" checked>
                                <div class="consent-text">
                                    <label for="emailNotifications">Enable email notifications</label>
                                </div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <button class="btn btn-outline" id="testEmailBtn">
                                <i class="fas fa-paper-plane"></i> Test Email Configuration
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="settings-tab-content" id="security-settings">
                    <div class="settings-group">
                        <h3>Security & Access Control</h3>

                        <div class="setting-item">
                            <div class="consent-group">
                                <input type="checkbox" id="require2FA">
                                <div class="consent-text">
                                    <label for="require2FA">Require two-factor authentication for admins</label>
                                </div>
                            </div>
                        </div>

                        <div class="setting-item">
                            <label for="sessionTimeout">Session Timeout (minutes)</label>
                            <input type="number" id="sessionTimeout" class="form-control" value="60" min="15" max="480">
                        </div>

                        <div class="setting-item">
                            <label for="maxLoginAttempts">Max Login Attempts</label>
                            <input type="number" id="maxLoginAttempts" class="form-control" value="5" min="1" max="10">
                        </div>

                        <button class="btn btn-outline" id="viewAccessLogsBtn">
                            <i class="fas fa-shield-alt"></i> View Access Logs
                        </button>
                    </div>
                </div>

                <!-- Backup Settings -->
                <div class="settings-tab-content" id="backup-settings">
                    <div class="settings-group">
                        <h3>Data Backup & Recovery</h3>

                        <div class="setting-item">
                            <label>Last Backup</label>
                            <p id="lastBackup">Never</p>
                        </div>

                        <div class="setting-item">
                            <label for="backupFrequency">Backup Frequency</label>
                            <select id="backupFrequency" class="form-control">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="disabled">Disabled</option>
                            </select>
                        </div>

                        <div class="setting-item">
                            <div class="consent-group">
                                <input type="checkbox" id="autoBackup" checked>
                                <div class="consent-text">
                                    <label for="autoBackup">Enable automatic backups</label>
                                </div>
                            </div>
                        </div>

                        <div class="setting-actions">
                            <button class="btn btn-primary" id="backupNowBtn">
                                <i class="fas fa-database"></i> Backup Now
                            </button>
                            <button class="btn btn-outline" id="restoreBackupBtn">
                                <i class="fas fa-undo"></i> Restore Backup
                            </button>
                            <button class="btn btn-outline btn-danger" id="exportAllDataBtn">
                                <i class="fas fa-file-export"></i> Export All Data
                            </button>
                        </div>

                        <!-- Backup List -->
                        <div class="backup-list-section">
                            <h4>Available Backups</h4>
                            <div class="backup-list" id="backupList">
                                <!-- Backups will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Member Modal -->
    <div class="modal" id="addMemberModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Add New Member</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMemberForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newPsnNumber">PSN Number *</label>
                            <input type="text" id="newPsnNumber" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newMemberEmail">Email *</label>
                            <input type="email" id="newMemberEmail" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newMemberName">Full Name *</label>
                        <input type="text" id="newMemberName" class="form-control" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="newMemberPhone">Phone Number *</label>
                            <input type="tel" id="newMemberPhone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newMemberDob">Date of Birth</label>
                            <input type="date" id="newMemberDob" class="form-control">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="newMemberPassword">Temporary Password *</label>
                        <input type="password" id="newMemberPassword" class="form-control" required>
                        <div class="form-text">Member will be asked to change this on first login</div>
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="makeAdmin">
                            <div class="consent-text">
                                <label for="makeAdmin">Grant administrative privileges</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="sendWelcomeEmail" checked>
                            <div class="consent-text">
                                <label for="sendWelcomeEmail">Send welcome email with login instructions</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelAddMember">Cancel</button>
                <button class="btn btn-primary" id="saveNewMember">Add Member</button>
            </div>
        </div>
    </div>

    <!-- View Member Modal -->
    <div class="modal" id="viewMemberModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Member Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="memberDetailsContent">
                    <!-- Member details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeMemberModal">Close</button>
                <button class="btn btn-primary" id="editMemberBtn">Edit Member</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Authentication check
        function requireAuth() {
            const token = localStorage.getItem('psn_welfare_token');
            const user = localStorage.getItem('psn_welfare_user');

            if (!token || !user) {
                window.location.href = '../admin-login';
                return false;
            }

            try {
                const userData = JSON.parse(user);
                if (!userData.isAdmin) {
                    window.location.href = '../dashboard';
                    return false;
                }
                return true;
            } catch {
                window.location.href = '../admin-login';
                return false;
            }
        }

        function getCurrentUser() {
            const user = localStorage.getItem('psn_welfare_user');
            if (user) {
                try {
                    return JSON.parse(user);
                } catch {
                    return null;
                }
            }
            return null;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('notification-hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Mobile menu functionality
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const mobileCloseBtn = document.getElementById('mobileCloseBtn');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const sidebar = document.getElementById('sidebar');

        function toggleMobileMenu() {
            sidebar.classList.toggle('mobile-open');
            mobileOverlay.classList.toggle('active');
            document.body.style.overflow = sidebar.classList.contains('mobile-open') ? 'hidden' : '';
        }

        if (mobileMenuToggle) mobileMenuToggle.addEventListener('click', toggleMobileMenu);
        if (mobileCloseBtn) mobileCloseBtn.addEventListener('click', toggleMobileMenu);
        if (mobileOverlay) mobileOverlay.addEventListener('click', toggleMobileMenu);

        // Navigation functionality
        const navItems = document.querySelectorAll('.nav-item[data-section]');
        const sections = {
            'admin-dashboard': document.getElementById('admin-dashboard-section'),
            'manage-members': document.getElementById('manage-members-section'),
            'reminder-logs': document.getElementById('reminder-logs-section'),
            'upcoming-events': document.getElementById('upcoming-events-section'),
            'reports': document.getElementById('reports-section'),
            'system-logs': document.getElementById('system-logs-section'),
            'settings': document.getElementById('settings-section')
        };

        navItems.forEach(item => {
            item.addEventListener('click', function (e) {
                e.preventDefault();

                const sectionId = this.getAttribute('data-section');

                // Update active nav item
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Hide all sections
                Object.values(sections).forEach(section => {
                    if (section) section.style.display = 'none';
                });

                // Show selected section
                if (sections[sectionId]) {
                    sections[sectionId].style.display = 'block';

                    // Update page title based on section
                    const pageTitle = document.getElementById('pageTitle');
                    const pageSubtitle = document.getElementById('pageSubtitle');

                    const sectionTitles = {
                        'admin-dashboard': { title: 'Admin Dashboard', subtitle: 'Welfare Secretary Control Panel' },
                        'manage-members': { title: 'Manage Members', subtitle: 'View and manage all registered members' },
                        'reminder-logs': { title: 'Reminder Logs', subtitle: 'View reminder delivery history and statistics' },
                        'upcoming-events': { title: 'Upcoming Celebrations', subtitle: 'View and manage upcoming birthdays and anniversaries' },
                        'reports': { title: 'Reports & Analytics', subtitle: 'Generate and download system reports' },
                        'system-logs': { title: 'Audit Logs', subtitle: 'View system activity and audit trail' },
                        'settings': { title: 'System Settings', subtitle: 'Configure platform settings and preferences' }
                    };

                    if (sectionTitles[sectionId]) {
                        pageTitle.textContent = sectionTitles[sectionId].title;
                        pageSubtitle.textContent = sectionTitles[sectionId].subtitle;
                    }

                    // Load section data if needed
                    loadSectionData(sectionId);
                }

                // Close mobile menu on mobile
                if (window.innerWidth <= 768) {
                    toggleMobileMenu();
                }
            });
        });

        // Load section data
        function loadSectionData(sectionId) {
            switch (sectionId) {
                case 'manage-members':
                    loadMembersData();
                    break;
                case 'reminder-logs':
                    loadReminderLogs();
                    break;
                case 'upcoming-events':
                    loadUpcomingEvents();
                    break;
                case 'reports':
                    initializeReports();
                    break;
                case 'system-logs':
                    loadAuditLogs();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        // Mock data for demonstration
        const mockData = {
            totalMembers: 157,
            activeMembers: 149,
            upcomingCelebrations: 45,
            remindersSent: 1245,
            systemHealth: 'Healthy',
            apiResponseTime: '25ms',
            dbStatus: 'Online',
            emailStatus: 'Active',
            members: [
                { id: 1, psn: 'PSN-TARA-2023-001', name: 'Dr. John Pharmacist', email: 'john@example.com', phone: '0803 123 4567', status: 'Active', type: 'Member', registered: '2023-03-15' },
                { id: 2, psn: 'PSN-TARA-2023-002', name: 'Dr. Sarah Johnson', email: 'sarah@example.com', phone: '0803 234 5678', status: 'Active', type: 'Admin', registered: '2023-03-20' },
                { id: 3, psn: 'PSN-TARA-2023-003', name: 'Dr. Michael Brown', email: 'michael@example.com', phone: '0803 345 6789', status: 'Inactive', type: 'Member', registered: '2023-04-10' }
            ],
            reminderLogs: [
                { id: 1, sentDate: '2024-05-01 09:00', recipient: 'Dr. John Pharmacist', event: 'Birthday', eventDate: '2024-05-15', status: 'Sent', type: 'Email' },
                { id: 2, sentDate: '2024-05-01 09:05', recipient: 'Dr. Sarah Johnson', event: 'Anniversary', eventDate: '2024-05-22', status: 'Failed', type: 'Email' },
                { id: 3, sentDate: '2024-05-02 10:00', recipient: 'Dr. Michael Brown', event: 'Birthday', eventDate: '2024-05-30', status: 'Pending', type: 'SMS' }
            ],
            upcomingEvents: [
                { id: 1, name: 'Dr. John Pharmacist', event: 'Birthday', date: '2024-05-15', type: 'Birthday' },
                { id: 2, name: 'Dr. Sarah Johnson', event: 'Wedding Anniversary', date: '2024-05-22', type: 'Anniversary' },
                { id: 3, name: 'Dr. Michael Brown', event: 'Birthday', date: '2024-05-30', type: 'Birthday' }
            ],
            auditLogs: [
                { id: 1, timestamp: '2024-05-01 10:30:00', user: 'admin', action: 'Login', details: 'Successful login from 192.168.1.100', ip: '192.168.1.100' },
                { id: 2, timestamp: '2024-05-01 11:15:00', user: 'Dr. Sarah Johnson', action: 'Registration', details: 'New member registration', ip: '192.168.1.101' },
                { id: 3, timestamp: '2024-05-02 09:45:00', user: 'admin', action: 'Update', details: 'Updated member details for PSN-TARA-2023-001', ip: '192.168.1.100' }
            ]
        };

        // Load dashboard data
        function loadDashboardData() {
            // Update stats
            document.getElementById('totalMembers').textContent = mockData.totalMembers;
            document.getElementById('activeMembers').textContent = mockData.activeMembers;
            document.getElementById('upcomingCelebrations').textContent = mockData.upcomingCelebrations;
            document.getElementById('remindersSent').textContent = mockData.remindersSent;

            // Update navigation badges
            document.getElementById('membersCount').textContent = mockData.totalMembers;
            document.getElementById('remindersCount').textContent = mockData.remindersSent;
            document.getElementById('eventsCount').textContent = mockData.upcomingCelebrations;

            // Update system health
            document.getElementById('systemHealth').textContent = mockData.systemHealth;
            document.getElementById('apiResponseTime').textContent = mockData.apiResponseTime;
            document.getElementById('dbStatus').textContent = mockData.dbStatus;
            document.getElementById('emailStatus').textContent = mockData.emailStatus;

            // Update admin info
            const user = getCurrentUser();
            if (user) {
                document.getElementById('adminName').textContent = user.fullName || 'Admin User';
                document.getElementById('adminPsn').textContent = user.psn || 'System Administrator';
            }

            // Update last updated time
            document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Load members data
        function loadMembersData() {
            const tbody = document.getElementById('membersTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            mockData.members.forEach(member => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="member-checkbox" data-id="${member.id}"></td>
                    <td>${member.psn}</td>
                    <td>${member.name}</td>
                    <td>${member.email}</td>
                    <td>${member.phone}</td>
                    <td><span class="status-badge ${member.status.toLowerCase()}">${member.status}</span></td>
                    <td><span class="type-badge ${member.type.toLowerCase()}">${member.type}</span></td>
                    <td>${member.registered}</td>
                    <td>
                        <button class="btn btn-outline btn-sm view-member-btn" data-id="${member.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-outline btn-sm edit-member-btn" data-id="${member.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Add event listeners to checkboxes
            document.querySelectorAll('.member-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectedCount);
            });

            // Add event listeners to view buttons
            document.querySelectorAll('.view-member-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const memberId = this.getAttribute('data-id');
                    viewMember(memberId);
                });
            });

            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-member-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const memberId = this.getAttribute('data-id');
                    editMember(memberId);
                });
            });
        }

        // Update selected members count
        function updateSelectedCount() {
            const selectedCount = document.querySelectorAll('.member-checkbox:checked').length;
            document.getElementById('selectedCount').textContent = selectedCount;

            // Enable/disable action buttons
            const exportBtn = document.getElementById('exportSelectedBtn');
            const deactivateBtn = document.getElementById('deactivateSelectedBtn');
            const deleteBtn = document.getElementById('deleteSelectedBtn');

            if (selectedCount > 0) {
                exportBtn.disabled = false;
                deactivateBtn.disabled = false;
                deleteBtn.disabled = false;
            } else {
                exportBtn.disabled = true;
                deactivateBtn.disabled = true;
                deleteBtn.disabled = true;
            }
        }

        // View member details
        function viewMember(memberId) {
            const member = mockData.members.find(m => m.id == memberId);
            if (!member) return;

            const content = document.getElementById('memberDetailsContent');
            if (content) {
                content.innerHTML = `
                    <div class="member-details">
                        <div class="detail-row">
                            <strong>PSN Number:</strong> ${member.psn}
                        </div>
                        <div class="detail-row">
                            <strong>Full Name:</strong> ${member.name}
                        </div>
                        <div class="detail-row">
                            <strong>Email:</strong> ${member.email}
                        </div>
                        <div class="detail-row">
                            <strong>Phone:</strong> ${member.phone}
                        </div>
                        <div class="detail-row">
                            <strong>Status:</strong> <span class="status-badge ${member.status.toLowerCase()}">${member.status}</span>
                        </div>
                        <div class="detail-row">
                            <strong>Type:</strong> <span class="type-badge ${member.type.toLowerCase()}">${member.type}</span>
                        </div>
                        <div class="detail-row">
                            <strong>Registered:</strong> ${member.registered}
                        </div>
                    </div>
                `;

                // Show modal
                document.getElementById('viewMemberModal').style.display = 'block';
            }
        }

        // Edit member
        function editMember(memberId) {
            alert(`Edit member ${memberId} functionality would be implemented here`);
        }

        // Load reminder logs
        function loadReminderLogs() {
            const tbody = document.getElementById('remindersTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            mockData.reminderLogs.forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${log.sentDate}</td>
                    <td>${log.recipient}</td>
                    <td>${log.event}</td>
                    <td>${log.eventDate}</td>
                    <td><span class="status-badge ${log.status.toLowerCase()}">${log.status}</span></td>
                    <td>${log.type}</td>
                    <td>
                        <button class="btn btn-outline btn-sm resend-reminder-btn" data-id="${log.id}">
                            <i class="fas fa-redo"></i> Resend
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Update stats
            const total = mockData.reminderLogs.length;
            const successful = mockData.reminderLogs.filter(l => l.status === 'Sent').length;
            const failed = mockData.reminderLogs.filter(l => l.status === 'Failed').length;
            const pending = mockData.reminderLogs.filter(l => l.status === 'Pending').length;

            document.getElementById('totalReminders').textContent = total;
            document.getElementById('successfulReminders').textContent = successful;
            document.getElementById('failedReminders').textContent = failed;
            document.getElementById('pendingReminders').textContent = pending;

            // Add event listeners to resend buttons
            document.querySelectorAll('.resend-reminder-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const reminderId = this.getAttribute('data-id');
                    resendReminder(reminderId);
                });
            });
        }

        // Resend reminder
        function resendReminder(reminderId) {
            if (confirm('Are you sure you want to resend this reminder?')) {
                showNotification(`Reminder ${reminderId} has been resent successfully`, 'success');
            }
        }

        // Load upcoming events
        function loadUpcomingEvents() {
            const list = document.getElementById('upcomingEventsList');
            if (!list) return;

            list.innerHTML = '';

            mockData.upcomingEvents.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.className = 'upcoming-event-item';
                eventElement.innerHTML = `
                    <div class="event-date">${event.date}</div>
                    <div class="event-details">
                        <h4>${event.name}</h4>
                        <p>${event.event}</p>
                    </div>
                    <div class="event-actions">
                        <button class="btn btn-outline btn-sm send-reminder-btn" data-id="${event.id}">
                            <i class="fas fa-bell"></i> Send Reminder
                        </button>
                    </div>
                `;
                list.appendChild(eventElement);
            });

            // Add event listeners to send reminder buttons
            document.querySelectorAll('.send-reminder-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const eventId = this.getAttribute('data-id');
                    sendIndividualReminder(eventId);
                });
            });
        }

        // Send individual reminder
        function sendIndividualReminder(eventId) {
            if (confirm('Send reminder for this event?')) {
                showNotification(`Reminder sent successfully for event ${eventId}`, 'success');
            }
        }

        // Initialize reports
        function initializeReports() {
            // Add event listeners to report buttons
            document.querySelectorAll('[data-report]').forEach(btn => {
                btn.addEventListener('click', function () {
                    const reportType = this.getAttribute('data-report');
                    generateReport(reportType);
                });
            });
        }

        // Generate report
        function generateReport(reportType) {
            const reportNames = {
                demographics: 'Member Demographics Report',
                calendar: 'Celebration Calendar Report',
                reminders: 'Reminder Analytics Report',
                growth: 'Growth Report'
            };

            const reportContent = document.getElementById('reportContent');
            const reportPreview = document.getElementById('reportPreview');

            if (reportContent && reportPreview) {
                reportContent.innerHTML = `
                    <h4>${reportNames[reportType] || 'Report'}</h4>
                    <p>Generated on: ${new Date().toLocaleString()}</p>
                    <p>This is a preview of the ${reportNames[reportType] || reportType} report.</p>
                    <p>Click "Download" to export the complete report.</p>
                `;
                reportPreview.style.display = 'block';

                // Scroll to preview
                reportPreview.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Load audit logs
        function loadAuditLogs() {
            const tbody = document.getElementById('logsTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            mockData.auditLogs.forEach(log => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${log.timestamp}</td>
                    <td>${log.user}</td>
                    <td><span class="action-badge ${log.action.toLowerCase()}">${log.action}</span></td>
                    <td>${log.details}</td>
                    <td>${log.ip}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load settings
        function loadSettings() {
            // Load last backup time
            const lastBackup = localStorage.getItem('psn_last_backup');
            if (lastBackup) {
                document.getElementById('lastBackup').textContent = new Date(lastBackup).toLocaleString();
            }

            // Load backup list
            const backupList = document.getElementById('backupList');
            if (backupList) {
                const backups = JSON.parse(localStorage.getItem('psn_backups') || '[]');
                backupList.innerHTML = '';

                backups.forEach((backup, index) => {
                    const backupItem = document.createElement('div');
                    backupItem.className = 'backup-item';
                    backupItem.innerHTML = `
                        <div class="backup-info">
                            <strong>Backup ${index + 1}</strong>
                            <span>${new Date(backup.timestamp).toLocaleString()}</span>
                        </div>
                        <div class="backup-actions">
                            <button class="btn btn-outline btn-sm restore-backup-item-btn" data-index="${index}">
                                <i class="fas fa-undo"></i> Restore
                            </button>
                            <button class="btn btn-outline btn-sm download-backup-btn" data-index="${index}">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    `;
                    backupList.appendChild(backupItem);
                });

                // Add event listeners to restore buttons
                document.querySelectorAll('.restore-backup-item-btn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const index = this.getAttribute('data-index');
                        restoreBackupItem(index);
                    });
                });

                // Add event listeners to download buttons
                document.querySelectorAll('.download-backup-btn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        const index = this.getAttribute('data-index');
                        downloadBackupItem(index);
                    });
                });
            }
        }

        // Restore backup item
        function restoreBackupItem(index) {
            if (confirm('Are you sure you want to restore this backup? This will overwrite current data.')) {
                showNotification(`Backup ${parseInt(index) + 1} restored successfully`, 'success');
            }
        }

        // Download backup item
        function downloadBackupItem(index) {
            showNotification(`Backup ${parseInt(index) + 1} download started`, 'success');
        }

        // Settings tabs functionality
        const settingsTabs = document.querySelectorAll('.settings-tab');
        const settingsContents = document.querySelectorAll('.settings-tab-content');

        settingsTabs.forEach(tab => {
            tab.addEventListener('click', function () {
                const tabId = this.getAttribute('data-tab');

                // Update active tab
                settingsTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                // Show corresponding content
                settingsContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-settings`) {
                        content.classList.add('active');
                    }
                });
            });
        });

        // Main button event handlers
        document.addEventListener('DOMContentLoaded', function () {
            // Check authentication
            if (!requireAuth()) return;

            // Load initial data
            loadDashboardData();

            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function () {
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('psn_welfare_token');
                    localStorage.removeItem('psn_welfare_user');
                    window.location.href = '../admin-login';
                }
            });

            // Refresh data button
            document.getElementById('refreshDataBtn').addEventListener('click', function () {
                loadDashboardData();
                showNotification('Data refreshed successfully', 'success');
            });

            // Quick export button
            document.getElementById('quickExportBtn').addEventListener('click', function () {
                const data = {
                    timestamp: new Date().toISOString(),
                    totalMembers: mockData.totalMembers,
                    activeMembers: mockData.activeMembers,
                    upcomingCelebrations: mockData.upcomingCelebrations
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `psn_welfare_export_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showNotification('Data exported successfully', 'success');
            });

            // Quick action buttons
            document.getElementById('addMemberBtn').addEventListener('click', function () {
                document.getElementById('addMemberModal').style.display = 'block';
            });

            document.getElementById('sendAnnouncementBtn').addEventListener('click', function () {
                const announcement = prompt('Enter announcement message:');
                if (announcement) {
                    showNotification('Announcement sent to all members', 'success');
                }
            });

            document.getElementById('viewReportsBtn').addEventListener('click', function () {
                // Navigate to reports section
                document.querySelector('[data-section="reports"]').click();
            });

            document.getElementById('systemHealthBtn').addEventListener('click', function () {
                showNotification('System health check completed. All systems operational.', 'success');
            });

            document.getElementById('refreshMonitoring').addEventListener('click', function () {
                loadDashboardData();
                showNotification('Monitoring data refreshed', 'success');
            });

            document.getElementById('viewAllActivity').addEventListener('click', function () {
                document.querySelector('[data-section="system-logs"]').click();
            });

            // Manage Members section buttons
            document.getElementById('addNewMemberBtn').addEventListener('click', function () {
                document.getElementById('addMemberModal').style.display = 'block';
            });

            document.getElementById('clearFiltersBtn').addEventListener('click', function () {
                document.getElementById('statusFilter').value = '';
                document.getElementById('memberTypeFilter').value = '';
                document.getElementById('memberSearch').value = '';
                loadMembersData();
            });

            document.getElementById('exportSelectedBtn').addEventListener('click', function () {
                const selected = document.querySelectorAll('.member-checkbox:checked');
                if (selected.length > 0) {
                    showNotification(`Exporting ${selected.length} selected members...`, 'success');
                }
            });

            document.getElementById('deactivateSelectedBtn').addEventListener('click', function () {
                const selected = document.querySelectorAll('.member-checkbox:checked');
                if (selected.length > 0 && confirm(`Deactivate ${selected.length} selected members?`)) {
                    showNotification(`${selected.length} members deactivated`, 'success');
                }
            });

            document.getElementById('deleteSelectedBtn').addEventListener('click', function () {
                const selected = document.querySelectorAll('.member-checkbox:checked');
                if (selected.length > 0 && confirm(`Permanently delete ${selected.length} selected members?`)) {
                    showNotification(`${selected.length} members deleted`, 'success');
                }
            });

            // Select all members checkbox
            document.getElementById('selectAllMembers').addEventListener('change', function () {
                const checkboxes = document.querySelectorAll('.member-checkbox');
                checkboxes.forEach(cb => cb.checked = this.checked);
                updateSelectedCount();
            });

            // Reminder logs buttons
            document.getElementById('applyDateRange').addEventListener('click', function () {
                const startDate = document.getElementById('reminderStartDate').value;
                const endDate = document.getElementById('reminderEndDate').value;

                if (startDate && endDate) {
                    showNotification(`Filtering reminders from ${startDate} to ${endDate}`, 'info');
                }
            });

            // Upcoming events buttons
            document.getElementById('sendBulkRemindersBtn').addEventListener('click', function () {
                if (confirm('Send reminders for all upcoming events this month?')) {
                    showNotification('Bulk reminders sent successfully', 'success');
                }
            });

            document.getElementById('prevMonth').addEventListener('click', function () {
                showNotification('Previous month loaded', 'info');
            });

            document.getElementById('nextMonth').addEventListener('click', function () {
                showNotification('Next month loaded', 'info');
            });

            // Reports section buttons
            document.getElementById('generateReportBtn').addEventListener('click', function () {
                generateReport('demographics');
            });

            document.getElementById('downloadReportBtn').addEventListener('click', function () {
                const format = document.getElementById('reportFormat').value;
                showNotification(`Report downloaded in ${format.toUpperCase()} format`, 'success');
            });

            // Settings section buttons
            document.getElementById('saveSettingsBtn').addEventListener('click', function () {
                // Save all settings
                const settings = {
                    platformName: document.getElementById('platformName').value,
                    welfareSecretary: document.getElementById('welfareSecretary').value,
                    contactEmail: document.getElementById('contactEmail').value,
                    reminderTime: document.getElementById('reminderTime').value,
                    smtpHost: document.getElementById('smtpHost').value,
                    smtpPort: document.getElementById('smtpPort').value,
                    smtpUser: document.getElementById('smtpUser').value,
                    require2FA: document.getElementById('require2FA').checked,
                    sessionTimeout: document.getElementById('sessionTimeout').value,
                    maxLoginAttempts: document.getElementById('maxLoginAttempts').value,
                    backupFrequency: document.getElementById('backupFrequency').value,
                    autoBackup: document.getElementById('autoBackup').checked
                };

                localStorage.setItem('psn_system_settings', JSON.stringify(settings));
                showNotification('Settings saved successfully', 'success');
            });

            document.getElementById('viewAccessLogsBtn').addEventListener('click', function () {
                document.querySelector('[data-section="system-logs"]').click();
            });

            document.getElementById('testEmailBtn').addEventListener('click', function () {
                showNotification('Test email sent. Please check your inbox.', 'success');
            });

            document.getElementById('backupNowBtn').addEventListener('click', function () {
                const backup = {
                    timestamp: new Date().toISOString(),
                    data: {
                        members: mockData.members,
                        settings: JSON.parse(localStorage.getItem('psn_system_settings') || '{}')
                    }
                };

                // Save backup to localStorage
                const backups = JSON.parse(localStorage.getItem('psn_backups') || '[]');
                backups.push(backup);
                localStorage.setItem('psn_backups', JSON.stringify(backups));
                localStorage.setItem('psn_last_backup', backup.timestamp);

                // Update UI
                document.getElementById('lastBackup').textContent = new Date(backup.timestamp).toLocaleString();
                loadSettings();

                showNotification('Backup created successfully', 'success');
            });

            document.getElementById('restoreBackupBtn').addEventListener('click', function () {
                if (confirm('Restore from the latest backup? This will overwrite current data.')) {
                    showNotification('System restored from backup', 'success');
                }
            });

            document.getElementById('exportAllDataBtn').addEventListener('click', function () {
                const allData = {
                    timestamp: new Date().toISOString(),
                    members: mockData.members,
                    reminderLogs: mockData.reminderLogs,
                    upcomingEvents: mockData.upcomingEvents,
                    auditLogs: mockData.auditLogs,
                    settings: JSON.parse(localStorage.getItem('psn_system_settings') || '{}')
                };

                const dataStr = JSON.stringify(allData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `psn_welfare_full_export_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showNotification('All data exported successfully', 'success');
            });

            // Modal close buttons
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', function () {
                    this.closest('.modal').style.display = 'none';
                });
            });

            document.getElementById('cancelAddMember').addEventListener('click', function () {
                document.getElementById('addMemberModal').style.display = 'none';
            });

            document.getElementById('closeMemberModal').addEventListener('click', function () {
                document.getElementById('viewMemberModal').style.display = 'none';
            });

            // Save new member
            document.getElementById('saveNewMember').addEventListener('click', function () {
                const psn = document.getElementById('newPsnNumber').value;
                const email = document.getElementById('newMemberEmail').value;
                const name = document.getElementById('newMemberName').value;
                const phone = document.getElementById('newMemberPhone').value;

                if (!psn || !email || !name || !phone) {
                    alert('Please fill in all required fields');
                    return;
                }

                // Here you would typically save to backend
                showNotification(`Member ${name} added successfully`, 'success');
                document.getElementById('addMemberModal').style.display = 'none';
                document.getElementById('addMemberForm').reset();

                // Refresh members list if on that section
                if (document.getElementById('manage-members-section').style.display !== 'none') {
                    loadMembersData();
                }
            });

            // Edit member button in view modal
            document.getElementById('editMemberBtn').addEventListener('click', function () {
                alert('Edit member functionality would open here');
            });

            // Update mobile close button visibility
            function updateMobileCloseButton() {
                if (window.innerWidth <= 768) {
                    mobileCloseBtn.style.display = 'block';
                } else {
                    mobileCloseBtn.style.display = 'none';
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }

            updateMobileCloseButton();
            window.addEventListener('resize', updateMobileCloseButton);

            // Close modals when clicking outside
            window.addEventListener('click', function (e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });

            // Handle escape key to close modals
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });

            console.log('Admin dashboard initialized successfully');
        });
    </script>

    <!-- Add notification styles -->
    <style>
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .notification-success {
            background: #28a745;
            border-left: 4px solid #1e7e34;
        }

        .notification-error {
            background: #dc3545;
            border-left: 4px solid #bd2130;
        }

        .notification-info {
            background: #17a2b8;
            border-left: 4px solid #117a8b;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-hide {
            animation: slideOut 0.3s ease forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Status badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge.sent {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.failed {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #856404;
        }

        .type-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .type-badge.member {
            background: #e3f2fd;
            color: #1565c0;
        }

        .type-badge.admin {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .action-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .action-badge.login {
            background: #d4edda;
            color: #155724;
        }

        .action-badge.registration {
            background: #d1ecf1;
            color: #0c5460;
        }

        .action-badge.update {
            background: #fff3cd;
            color: #856404;
        }

        .action-badge.delete {
            background: #f8d7da;
            color: #721c24;
        }

        /* Member details */
        .member-details {
            padding: 20px;
        }

        .detail-row {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .detail-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        /* Backup items */
        .backup-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f8f9fa;
        }

        .backup-info {
            display: flex;
            flex-direction: column;
        }

        .backup-info span {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .backup-actions {
            display: flex;
            gap: 10px;
        }
    </style>
</body>

</html>
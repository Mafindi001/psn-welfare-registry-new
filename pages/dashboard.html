<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - PSN Taraba Welfare Registry</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Mobile Responsive Additions */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }

            .dashboard-sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                top: 0;
                left: -100%;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .dashboard-sidebar.mobile-open {
                left: 0;
            }

            .dashboard-main {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }

            .header-actions {
                display: flex;
                flex-direction: column;
                gap: 10px;
                margin-top: 15px;
            }

            .header-actions .btn {
                width: 100%;
                padding: 12px;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .events-grid {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .dates-table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }

            .modal-content {
                width: 95%;
                margin: 20px auto;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-lg {
                width: 98%;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
            }

            .overlay.active {
                display: block;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .event-actions {
                flex-direction: column;
                gap: 8px;
            }

            .event-actions .btn {
                width: 100%;
            }

            .nextkin-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }

            .form-row .form-group {
                width: 100%;
            }
        }

        /* Mobile Menu Toggle Button */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary-color, #2c5aa0);
            cursor: pointer;
            padding: 10px;
            z-index: 1001;
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }

            .dashboard-header {
                flex-wrap: wrap;
                gap: 15px;
            }

            .header-title {
                order: 2;
                flex: 1 1 100%;
            }

            .header-actions {
                order: 3;
                flex: 1 1 100%;
            }
        }

        /* Responsive Table */
        @media (max-width: 600px) {
            .dates-table thead {
                display: none;
            }

            .dates-table tr {
                display: block;
                margin-bottom: 1rem;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 10px;
            }

            .dates-table td {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border: none;
                border-bottom: 1px solid #eee;
            }

            .dates-table td:last-child {
                border-bottom: none;
            }

            .dates-table td:before {
                content: attr(data-label);
                font-weight: 600;
                color: #666;
                margin-right: 10px;
            }
        }

        /* Touch-friendly buttons */
        @media (max-width: 768px) {

            .btn,
            button {
                min-height: 44px;
                min-width: 44px;
            }

            .nav-item {
                padding: 15px 20px;
            }
        }

        /* Status badges */
        .date-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .notification-success {
            background: #28a745;
            border-left: 4px solid #1e7e34;
        }

        .notification-error {
            background: #dc3545;
            border-left: 4px solid #bd2130;
        }

        .notification-info {
            background: #17a2b8;
            border-left: 4px solid #117a8b;
        }

        .notification-warning {
            background: #ffc107;
            border-left: 4px solid #d39e00;
            color: #212529;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-hide {
            animation: slideOut 0.3s ease forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Toggle switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #28a745;
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }
    </style>
</head>

<body>
    <!-- Mobile Overlay -->
    <div class="overlay" id="mobileOverlay"></div>

    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <aside class="dashboard-sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div>
                    <h3 style="margin: 0; font-size: 1.1rem;">PSN Taraba</h3>
                    <p style="margin: 0; font-size: 0.8rem; color: var(--text-light);">Welfare Registry</p>
                </div>
                <button class="mobile-close" id="mobileCloseBtn"
                    style="display: none; background: none; border: none; color: white; font-size: 1.5rem; margin-left: auto;">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="sidebar-user">
                <p class="user-greeting">Welcome back,</p>
                <h2 class="user-name" id="userName">Dr. John Pharmacist</h2>
                <p class="user-psn" id="userPsn">PSN-TARA-2023-001</p>
            </div>

            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#profile" class="nav-item" data-section="profile">
                    <i class="fas fa-user"></i>
                    <span>My Profile</span>
                </a>
                <a href="#special-dates" class="nav-item" data-section="special-dates">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Special Dates</span>
                </a>
                <a href="#next-of-kin" class="nav-item" data-section="next-of-kin">
                    <i class="fas fa-users"></i>
                    <span>Next of Kin</span>
                </a>
                <a href="#reminders" class="nav-item" data-section="reminders">
                    <i class="fas fa-bell"></i>
                    <span>Reminders</span>
                </a>
                <a href="#settings" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <!-- Added Links -->
                <a href="../index.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Home Page</span>
                </a>
                <a href="../admin-login" class="nav-item" style="background: rgba(255,255,255,0.1);">
                    <i class="fas fa-user-shield"></i>
                    <span>Admin Login</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="dashboard-main">
            <!-- Header with Mobile Menu Toggle -->
            <header class="dashboard-header">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>

                <div class="header-title">
                    <h1 id="pageTitle">Dashboard Overview</h1>
                    <p id="pageSubtitle" style="color: var(--text-light); margin: 0.5rem 0 0; font-size: 0.95rem;">
                        Welcome to your welfare management dashboard
                    </p>
                </div>

                <div class="header-actions">
                    <button class="btn btn-outline" id="addDateBtn">
                        <i class="fas fa-plus"></i> Add Special Date
                    </button>
                    <button class="btn btn-primary" id="addNextKinBtn">
                        <i class="fas fa-user-plus"></i> Add Next of Kin
                    </button>
                </div>
            </header>

            <!-- Stats Overview -->
            <section class="stats-grid" id="statsSection">
                <div class="stat-card">
                    <div class="stat-icon birthday">
                        <i class="fas fa-birthday-cake"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="birthdayCount">1</h3>
                        <p>Birthdays</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon anniversary">
                        <i class="fas fa-ring"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="anniversaryCount">1</h3>
                        <p>Anniversaries</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon upcoming">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="upcomingCount">3</h3>
                        <p>Upcoming Events</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon profile">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="profileComplete">85%</h3>
                        <p>Profile Complete</p>
                    </div>
                </div>
            </section>

            <!-- Upcoming Events Section -->
            <section class="dashboard-section" id="upcomingEvents">
                <div class="section-header">
                    <h2>Upcoming Events</h2>
                    <button class="btn btn-outline" id="viewAllEvents">
                        <i class="fas fa-calendar"></i> View Calendar
                    </button>
                </div>

                <div class="events-grid" id="eventsGrid">
                    <!-- Events will be loaded here dynamically -->
                    <div class="event-card upcoming">
                        <div class="event-header">
                            <h3 class="event-title">Birthday</h3>
                            <span class="event-date">15 May 2024</span>
                        </div>
                        <p class="event-days">In <span class="highlight">45 days</span></p>
                        <p>Annual reminder enabled</p>
                        <div class="event-actions">
                            <button class="btn btn-outline btn-sm edit-date-btn" data-id="1">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-outline btn-sm disable-reminder-btn" data-id="1">
                                <i class="fas fa-bell-slash"></i> Disable
                            </button>
                        </div>
                    </div>

                    <div class="event-card">
                        <div class="event-header">
                            <h3 class="event-title">Wedding Anniversary</h3>
                            <span class="event-date">22 June 2024</span>
                        </div>
                        <p class="event-days">In <span class="highlight">83 days</span></p>
                        <p>Reminder to: You & Next of Kin</p>
                        <div class="event-actions">
                            <button class="btn btn-outline btn-sm edit-date-btn" data-id="2">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-outline btn-sm delete-date-btn" data-id="2">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        </div>
                    </div>

                    <div class="event-card today">
                        <div class="event-header">
                            <h3 class="event-title">Child's Birthday</h3>
                            <span class="event-date">Today</span>
                        </div>
                        <p class="event-days">Reminder sent yesterday</p>
                        <p>Annual reminder enabled</p>
                        <div class="event-actions">
                            <button class="btn btn-primary btn-sm mark-celebrated-btn" data-id="3">
                                <i class="fas fa-check"></i> Mark Celebrated
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Profile Information Section -->
            <section class="dashboard-section" id="profileSection" style="display: none;">
                <div class="section-header">
                    <h2>My Profile Information</h2>
                    <button class="btn btn-primary" id="editProfileBtn">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Full Name</div>
                        <div class="info-value" id="profileName">Dr. John Pharmacist</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">PSN Number</div>
                        <div class="info-value" id="profilePsn">PSN-TARA-2023-001</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Email Address</div>
                        <div class="info-value" id="profileEmail">john.pharmacist@example.com</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Phone Number</div>
                        <div class="info-value" id="profilePhone">0803 123 4567</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Date of Birth</div>
                        <div class="info-value" id="profileDob">15 May 1985</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Wedding Anniversary</div>
                        <div class="info-value" id="profileWedding">22 June 2015</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Registration Date</div>
                        <div class="info-value" id="profileRegDate">15 March 2024</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Consent Given</div>
                        <div class="info-value" id="profileConsent">Yes (15 March 2024)</div>
                    </div>
                </div>

                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Account Security</h2>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Last Login</div>
                        <div class="info-value" id="lastLogin">Today, 10:30 AM</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Account Status</div>
                        <div class="info-value">
                            <span class="date-status status-active">Active</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Password</div>
                        <div class="info-value">
                            <button class="btn btn-outline btn-sm" id="changePasswordBtn">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Special Dates Section -->
            <section class="dashboard-section" id="specialDatesSection" style="display: none;">
                <div class="section-header">
                    <h2>My Special Dates</h2>
                    <button class="btn btn-primary" id="addNewDateBtn">
                        <i class="fas fa-plus"></i> Add New Date
                    </button>
                </div>

                <div class="empty-state" id="noDatesMessage" style="display: none;">
                    <i class="fas fa-calendar-plus"></i>
                    <h3>No special dates added yet</h3>
                    <p>Add your special dates to receive automated reminders</p>
                    <button class="btn btn-primary" id="addFirstDateBtn">
                        <i class="fas fa-plus"></i> Add Your First Date
                    </button>
                </div>

                <table class="dates-table" id="datesTable">
                    <thead>
                        <tr>
                            <th>Event</th>
                            <th>Date</th>
                            <th>Annual</th>
                            <th>Reminders</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="datesTableBody">
                        <!-- Dates will be loaded dynamically -->
                        <tr>
                            <td class="date-label" data-label="Event">Birthday</td>
                            <td class="date-value" data-label="Date">15/05/1985</td>
                            <td data-label="Annual"><i class="fas fa-check" style="color: var(--secondary-color);"></i>
                            </td>
                            <td data-label="Reminders">You & Next of Kin</td>
                            <td data-label="Status"><span class="date-status status-active">Active</span></td>
                            <td data-label="Actions">
                                <button class="btn btn-outline btn-sm edit-date-btn" data-id="1">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline btn-sm delete-date-btn" data-id="1">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Next of Kin Section -->
            <section class="dashboard-section" id="nextOfKinSection" style="display: none;">
                <div class="section-header">
                    <h2>Next of Kin / Emergency Contacts</h2>
                    <button class="btn btn-primary" id="addKinBtn">
                        <i class="fas fa-user-plus"></i> Add Contact
                    </button>
                </div>

                <div class="nextkin-grid" id="nextkinGrid">
                    <!-- Next of kin cards will be loaded here -->
                    <div class="nextkin-card">
                        <div class="nextkin-header">
                            <h3 class="nextkin-name">Jane Pharmacist</h3>
                            <span class="nextkin-relationship">Spouse</span>
                        </div>
                        <span class="primary-badge">Primary</span>
                        <div class="nextkin-details">
                            <div class="nextkin-detail">
                                <i class="fas fa-phone"></i>
                                <span>0803 987 6543</span>
                            </div>
                            <div class="nextkin-detail">
                                <i class="fas fa-envelope"></i>
                                <span>jane@example.com</span>
                            </div>
                        </div>
                        <div class="event-actions">
                            <button class="btn btn-outline btn-sm edit-kin-btn" data-id="1">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-outline btn-sm delete-kin-btn" data-id="1">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reminders Section -->
            <section class="dashboard-section" id="remindersSection" style="display: none;">
                <div class="section-header">
                    <h2>Reminder Settings</h2>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Email Notifications</div>
                        <div class="info-value">
                            <label class="switch">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="slider"></span>
                            </label>
                            <span style="margin-left: 1rem;">Enabled</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Reminder Time</div>
                        <div class="info-value">
                            <select id="reminderTimeSelect" class="form-control"
                                style="display: inline-block; width: auto;">
                                <option value="24">24 hours before</option>
                                <option value="48">48 hours before</option>
                                <option value="72">72 hours before</option>
                            </select>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Reminder Recipients</div>
                        <div class="info-value">
                            <div class="consent-group">
                                <input type="checkbox" id="remindMe" checked>
                                <div class="consent-text">
                                    <label for="remindMe">Me (the member)</label>
                                </div>
                            </div>
                            <div class="consent-group">
                                <input type="checkbox" id="remindPrimaryKin" checked>
                                <div class="consent-text">
                                    <label for="remindPrimaryKin">Primary next of kin</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Last Reminder Sent</div>
                        <div class="info-value">Today, 9:00 AM (Birthday)</div>
                    </div>
                </div>

                <div class="section-header" style="margin-top: 2rem;">
                    <h2>Recent Reminders</h2>
                    <button class="btn btn-outline btn-sm" id="refreshRemindersBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>

                <table class="dates-table" id="remindersTable">
                    <thead>
                        <tr>
                            <th>Date Sent</th>
                            <th>Event</th>
                            <th>Recipient</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-label="Date Sent">Today, 9:00 AM</td>
                            <td data-label="Event">Birthday</td>
                            <td data-label="Recipient">You & Next of Kin</td>
                            <td data-label="Status"><span class="date-status status-active">Sent</span></td>
                            <td data-label="Actions">
                                <button class="btn btn-outline btn-sm resend-reminder-btn" data-id="1">
                                    <i class="fas fa-redo"></i> Resend
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td data-label="Date Sent">15 March, 10:30 AM</td>
                            <td data-label="Event">Welcome Reminder</td>
                            <td data-label="Recipient">You</td>
                            <td data-label="Status"><span class="date-status status-active">Sent</span></td>
                            <td data-label="Actions">
                                <button class="btn btn-outline btn-sm resend-reminder-btn" data-id="2">
                                    <i class="fas fa-redo"></i> Resend
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Settings Section -->
            <section class="dashboard-section" id="settingsSection" style="display: none;">
                <div class="section-header">
                    <h2>Account Settings</h2>
                    <button class="btn btn-outline btn-sm" id="refreshSettingsBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Data Sharing Consent</div>
                        <div class="info-value">
                            <p style="margin: 0 0 1rem;">You have consented to data processing for welfare purposes.</p>
                            <button class="btn btn-outline" id="viewConsentBtn">
                                <i class="fas fa-file-contract"></i> View Consent
                            </button>
                            <button class="btn btn-outline" id="updateConsentBtn">
                                <i class="fas fa-edit"></i> Update Consent
                            </button>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Account Deletion</div>
                        <div class="info-value">
                            <p style="margin: 0 0 1rem;">You can request account deletion. This will remove all your
                                data from the system.</p>
                            <button class="btn btn-outline" id="requestDeletionBtn">
                                <i class="fas fa-trash"></i> Request Deletion
                            </button>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Data Export</div>
                        <div class="info-value">
                            <p style="margin: 0 0 1rem;">Download a copy of all your data stored in the system.</p>
                            <button class="btn btn-primary" id="exportDataBtn">
                                <i class="fas fa-download"></i> Export My Data
                            </button>
                            <button class="btn btn-outline" id="scheduleExportBtn">
                                <i class="fas fa-calendar"></i> Schedule Export
                            </button>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">Notification Preferences</div>
                        <div class="info-value">
                            <div class="consent-group">
                                <input type="checkbox" id="pushNotifications" checked>
                                <div class="consent-text">
                                    <label for="pushNotifications">Push notifications</label>
                                </div>
                            </div>
                            <div class="consent-group">
                                <input type="checkbox" id="smsNotifications" checked>
                                <div class="consent-text">
                                    <label for="smsNotifications">SMS notifications</label>
                                </div>
                            </div>
                            <button class="btn btn-outline btn-sm" id="saveNotificationPrefs">
                                <i class="fas fa-save"></i> Save Preferences
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Special Date Modal -->
    <div class="modal" id="addDateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Special Date</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addDateForm">
                    <div class="form-group">
                        <label for="dateLabel">Event Label <span class="required">*</span></label>
                        <input type="text" id="dateLabel" class="form-control"
                            placeholder="e.g., Birthday, Anniversary, Child's Birthday" required>
                    </div>

                    <div class="form-group">
                        <label for="eventDate">Date <span class="required">*</span></label>
                        <input type="date" id="eventDate" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="isAnnual" checked>
                            <div class="consent-text">
                                <label for="isAnnual">Repeat annually (send reminder every year)</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Send reminders to:</label>
                        <div class="consent-group">
                            <input type="checkbox" id="remindMember" checked>
                            <div class="consent-text">
                                <label for="remindMember">Me (the member)</label>
                            </div>
                        </div>
                        <div class="consent-group">
                            <input type="checkbox" id="remindNextKin" checked>
                            <div class="consent-text">
                                <label for="remindNextKin">Primary next of kin</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelDateBtn">Cancel</button>
                <button class="btn btn-primary" id="saveDateBtn">Save Date</button>
            </div>
        </div>
    </div>

    <!-- Add Next of Kin Modal -->
    <div class="modal" id="addKinModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Next of Kin</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addKinForm">
                    <div class="form-group">
                        <label for="kinName">Full Name <span class="required">*</span></label>
                        <input type="text" id="kinName" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="kinRelationship">Relationship <span class="required">*</span></label>
                        <select id="kinRelationship" class="form-control" required>
                            <option value="">Select relationship</option>
                            <option value="Spouse">Spouse</option>
                            <option value="Child">Child</option>
                            <option value="Parent">Parent</option>
                            <option value="Sibling">Sibling</option>
                            <option value="Other Relative">Other Relative</option>
                            <option value="Friend">Friend</option>
                            <option value="Colleague">Colleague</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="kinPhone">Phone Number <span class="required">*</span></label>
                        <input type="tel" id="kinPhone" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="kinEmail">Email Address</label>
                        <input type="email" id="kinEmail" class="form-control">
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="isPrimaryKin">
                            <div class="consent-text">
                                <label for="isPrimaryKin">Set as primary emergency contact</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="consent-group">
                            <input type="checkbox" id="sendWelcomeSMS">
                            <div class="consent-text">
                                <label for="sendWelcomeSMS">Send welcome SMS to next of kin</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelKinBtn">Cancel</button>
                <button class="btn btn-primary" id="saveKinBtn">Save Contact</button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Edit Profile Information</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-user"></i> Personal Information</h4>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editFullName">Full Name <span class="required">*</span></label>
                                <input type="text" id="editFullName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="editPsnNumber">PSN Number</label>
                                <input type="text" id="editPsnNumber" class="form-control" disabled>
                                <div class="form-text">PSN number cannot be changed</div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editEmail">Email Address <span class="required">*</span></label>
                                <input type="email" id="editEmail" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="editPhone">Phone Number <span class="required">*</span></label>
                                <input type="tel" id="editPhone" class="form-control" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editAddress">Address</label>
                                <input type="text" id="editAddress" class="form-control"
                                    placeholder="Enter your residential address">
                            </div>
                            <div class="form-group">
                                <label for="editCity">City</label>
                                <input type="text" id="editCity" class="form-control" placeholder="City">
                            </div>
                        </div>
                    </div>

                    <!-- Special Dates Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-calendar-alt"></i> Special Dates</h4>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editDateOfBirth">Date of Birth</label>
                                <input type="date" id="editDateOfBirth" class="form-control">
                                <div class="form-text">Used for birthday reminders</div>
                            </div>
                            <div class="form-group">
                                <label for="editWeddingDate">Wedding Anniversary</label>
                                <input type="date" id="editWeddingDate" class="form-control">
                                <div class="form-text">Used for anniversary reminders</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="editOtherDates">Other Special Dates</label>
                            <textarea id="editOtherDates" class="form-control" rows="3"
                                placeholder="List other important dates (children's birthdays, etc.)"></textarea>
                        </div>
                    </div>

                    <!-- Emergency Contacts Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-users"></i> Next of Kin / Emergency Contacts</h4>
                        <div id="nextOfKinContainer">
                            <!-- Next of kin will be dynamically added here -->
                        </div>
                        <button type="button" class="btn btn-outline btn-sm" id="addNextOfKinBtn">
                            <i class="fas fa-user-plus"></i> Add Another Contact
                        </button>
                    </div>

                    <!-- Privacy & Consent Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-shield-alt"></i> Privacy Settings</h4>

                        <div class="form-group">
                            <div class="consent-group">
                                <input type="checkbox" id="editConsent" name="consent">
                                <div class="consent-text">
                                    <label for="editConsent">
                                        I consent to the processing of my personal data for welfare purposes
                                        in accordance with the Nigeria Data Protection Act (NDPA).
                                        I understand that I can withdraw this consent at any time.
                                        <span class="required">*</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="consent-group">
                                <input type="checkbox" id="emailNotifications" name="emailNotifications">
                                <div class="consent-text">
                                    <label for="emailNotifications">
                                        Receive email notifications for special date reminders
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="consent-group">
                                <input type="checkbox" id="nextOfKinNotifications" name="nextOfKinNotifications">
                                <div class="consent-text">
                                    <label for="nextOfKinNotifications">
                                        Send reminders to my next of kin for special dates
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Change Password Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-key"></i> Change Password</h4>

                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" class="form-control">
                            <div class="form-text">Required only if changing password</div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" id="newPassword" class="form-control">
                                <div class="password-strength">
                                    <div class="strength-meter">
                                        <div class="strength-fill" id="passwordStrengthFill"></div>
                                    </div>
                                    <div class="strength-text" id="passwordStrengthText">Password strength</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="confirmNewPassword">Confirm New Password</label>
                                <input type="password" id="confirmNewPassword" class="form-control">
                                <div class="form-text error" id="passwordMatchError"></div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelEditProfile">Cancel</button>
                <button class="btn btn-primary" id="saveProfileBtn">
                    <i class="fas fa-save"></i> Save Changes
                </button>
                <button class="btn btn-outline" id="previewProfileBtn">
                    <i class="fas fa-eye"></i> Preview
                </button>
            </div>
        </div>
    </div>

    <!-- Next of Kin Template (Hidden) -->
    <template id="nextOfKinTemplate">
        <div class="next-of-kin-entry">
            <div class="kin-header">
                <h5>Emergency Contact</h5>
                <button type="button" class="btn btn-outline btn-sm remove-kin-btn">
                    <i class="fas fa-trash"></i> Remove
                </button>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Full Name <span class="required">*</span></label>
                    <input type="text" class="form-control kin-name" required>
                </div>
                <div class="form-group">
                    <label>Relationship <span class="required">*</span></label>
                    <select class="form-control kin-relationship" required>
                        <option value="">Select relationship</option>
                        <option value="Spouse">Spouse</option>
                        <option value="Child">Child</option>
                        <option value="Parent">Parent</option>
                        <option value="Sibling">Sibling</option>
                        <option value="Other Relative">Other Relative</option>
                        <option value="Friend">Friend</option>
                        <option value="Colleague">Colleague</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Phone Number <span class="required">*</span></label>
                    <input type="tel" class="form-control kin-phone" required>
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" class="form-control kin-email">
                </div>
            </div>

            <div class="form-group">
                <div class="consent-group">
                    <input type="checkbox" class="kin-is-primary">
                    <div class="consent-text">
                        <label>Set as primary emergency contact</label>
                    </div>
                </div>
            </div>

            <hr>
        </div>
    </template>

    <!-- Scripts -->
    <script src="../scripts/utils.js"></script>
    <script src="../scripts/api.js"></script>
    <script src="../scripts/dashboard.js"></script>
    <script>
        // Helper function to show notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('notification-hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Mobile menu functionality
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const mobileCloseBtn = document.getElementById('mobileCloseBtn');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const sidebar = document.getElementById('sidebar');

        function toggleMobileMenu() {
            sidebar.classList.toggle('mobile-open');
            mobileOverlay.classList.toggle('active');
            document.body.style.overflow = sidebar.classList.contains('mobile-open') ? 'hidden' : '';
        }

        mobileMenuToggle.addEventListener('click', toggleMobileMenu);
        mobileCloseBtn.addEventListener('click', toggleMobileMenu);
        mobileOverlay.addEventListener('click', toggleMobileMenu);

        // Show/hide mobile close button based on screen size
        function updateMobileCloseButton() {
            if (window.innerWidth <= 768) {
                mobileCloseBtn.style.display = 'block';
            } else {
                mobileCloseBtn.style.display = 'none';
                sidebar.classList.remove('mobile-open');
                mobileOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // Initial check
        updateMobileCloseButton();

        // Update on resize
        window.addEventListener('resize', updateMobileCloseButton);

        // Navigation between sections
        const navItems = document.querySelectorAll('.nav-item[data-section]');
        const sections = {
            dashboard: document.getElementById('upcomingEvents'),
            profile: document.getElementById('profileSection'),
            'special-dates': document.getElementById('specialDatesSection'),
            'next-of-kin': document.getElementById('nextOfKinSection'),
            reminders: document.getElementById('remindersSection'),
            settings: document.getElementById('settingsSection')
        };

        navItems.forEach(item => {
            item.addEventListener('click', function (e) {
                e.preventDefault();

                const sectionId = this.getAttribute('data-section');

                // Update active nav item
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                // Hide all sections
                Object.values(sections).forEach(section => {
                    if (section) section.style.display = 'none';
                });

                // Show selected section
                if (sections[sectionId]) {
                    sections[sectionId].style.display = 'block';
                }

                // Update page title
                const pageTitle = document.getElementById('pageTitle');
                const pageSubtitle = document.getElementById('pageSubtitle');

                switch (sectionId) {
                    case 'dashboard':
                        pageTitle.textContent = 'Dashboard Overview';
                        pageSubtitle.textContent = 'Welcome to your welfare management dashboard';
                        break;
                    case 'profile':
                        pageTitle.textContent = 'My Profile';
                        pageSubtitle.textContent = 'View and manage your personal information';
                        break;
                    case 'special-dates':
                        pageTitle.textContent = 'Special Dates';
                        pageSubtitle.textContent = 'Manage your birthdays, anniversaries, and other special dates';
                        break;
                    case 'next-of-kin':
                        pageTitle.textContent = 'Next of Kin';
                        pageSubtitle.textContent = 'Manage your emergency contacts';
                        break;
                    case 'reminders':
                        pageTitle.textContent = 'Reminders';
                        pageSubtitle.textContent = 'Configure your reminder settings';
                        break;
                    case 'settings':
                        pageTitle.textContent = 'Settings';
                        pageSubtitle.textContent = 'Manage your account preferences';
                        break;
                }

                // Close mobile menu on mobile after selection
                if (window.innerWidth <= 768) {
                    toggleMobileMenu();
                }
            });
        });

        // Handle logout
        document.getElementById('logoutBtn').addEventListener('click', function () {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('psn_welfare_token');
                localStorage.removeItem('psn_welfare_user');
                window.location.href = '../login';
            }
        });

        // Modal functionality
        const modals = document.querySelectorAll('.modal');
        const modalCloseButtons = document.querySelectorAll('.modal-close');

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // Open modals
        document.getElementById('addDateBtn')?.addEventListener('click', () => openModal('addDateModal'));
        document.getElementById('addNextKinBtn')?.addEventListener('click', () => openModal('addKinModal'));
        document.getElementById('addNewDateBtn')?.addEventListener('click', () => openModal('addDateModal'));
        document.getElementById('addFirstDateBtn')?.addEventListener('click', () => openModal('addDateModal'));
        document.getElementById('addKinBtn')?.addEventListener('click', () => openModal('addKinModal'));
        document.getElementById('editProfileBtn')?.addEventListener('click', () => openModal('editProfileModal'));
        document.getElementById('changePasswordBtn')?.addEventListener('click', () => openModal('editProfileModal'));

        // View Calendar button
        document.getElementById('viewAllEvents')?.addEventListener('click', function () {
            showNotification('Opening calendar view...', 'info');
            // In a real app, this would open a calendar view
        });

        // Close modals
        modalCloseButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                const modal = this.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            });
        });

        // Cancel buttons
        document.getElementById('cancelDateBtn')?.addEventListener('click', () => closeModal('addDateModal'));
        document.getElementById('cancelKinBtn')?.addEventListener('click', () => closeModal('addKinModal'));
        document.getElementById('cancelEditProfile')?.addEventListener('click', () => closeModal('editProfileModal'));

        // Close modal when clicking outside
        window.addEventListener('click', function (e) {
            modals.forEach(modal => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            });
        });

        // Event card button functionality
        function setupEventCardButtons() {
            // Edit date buttons
            document.querySelectorAll('.edit-date-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const eventId = this.getAttribute('data-id');
                    openModal('addDateModal');
                    // Pre-fill form with event data
                    document.getElementById('dateLabel').value = 'Birthday';
                    document.getElementById('eventDate').value = '2024-05-15';
                    showNotification(`Editing event ${eventId}`, 'info');
                });
            });

            // Disable reminder buttons
            document.querySelectorAll('.disable-reminder-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const eventId = this.getAttribute('data-id');
                    if (confirm('Disable reminders for this event?')) {
                        showNotification(`Reminders disabled for event ${eventId}`, 'success');
                    }
                });
            });

            // Delete date buttons
            document.querySelectorAll('.delete-date-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const eventId = this.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this event?')) {
                        showNotification(`Event ${eventId} deleted`, 'success');
                    }
                });
            });

            // Mark celebrated buttons
            document.querySelectorAll('.mark-celebrated-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const eventId = this.getAttribute('data-id');
                    showNotification(`Event ${eventId} marked as celebrated`, 'success');
                });
            });

            // Edit next of kin buttons
            document.querySelectorAll('.edit-kin-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const kinId = this.getAttribute('data-id');
                    openModal('addKinModal');
                    // Pre-fill form with kin data
                    document.getElementById('kinName').value = 'Jane Pharmacist';
                    document.getElementById('kinRelationship').value = 'Spouse';
                    document.getElementById('kinPhone').value = '08039876543';
                    document.getElementById('kinEmail').value = 'jane@example.com';
                    document.getElementById('isPrimaryKin').checked = true;
                    showNotification(`Editing next of kin ${kinId}`, 'info');
                });
            });

            // Delete next of kin buttons
            document.querySelectorAll('.delete-kin-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const kinId = this.getAttribute('data-id');
                    if (confirm('Are you sure you want to remove this next of kin?')) {
                        showNotification(`Next of kin ${kinId} removed`, 'success');
                    }
                });
            });
        }

        // Settings section buttons
        document.getElementById('viewConsentBtn')?.addEventListener('click', function () {
            showNotification('Opening consent document...', 'info');
            // In a real app, this would open a PDF or HTML document
        });

        document.getElementById('updateConsentBtn')?.addEventListener('click', function () {
            if (confirm('Update your data sharing consent preferences?')) {
                showNotification('Consent preferences updated', 'success');
            }
        });

        document.getElementById('requestDeletionBtn')?.addEventListener('click', function () {
            if (confirm('Are you sure you want to request account deletion? This action cannot be undone.')) {
                showNotification('Account deletion request submitted. Admin will contact you shortly.', 'success');
            }
        });

        document.getElementById('exportDataBtn')?.addEventListener('click', function () {
            showNotification('Preparing your data export...', 'info');
            // In a real app, this would trigger a data export
            setTimeout(() => {
                showNotification('Data export completed. Download will start shortly.', 'success');
            }, 2000);
        });

        document.getElementById('scheduleExportBtn')?.addEventListener('click', function () {
            const frequency = prompt('Enter export frequency (daily, weekly, monthly):', 'monthly');
            if (frequency) {
                showNotification(`Data export scheduled ${frequency}`, 'success');
            }
        });

        document.getElementById('saveNotificationPrefs')?.addEventListener('click', function () {
            const pushEnabled = document.getElementById('pushNotifications').checked;
            const smsEnabled = document.getElementById('smsNotifications').checked;
            showNotification(`Notification preferences saved: Push ${pushEnabled ? 'ON' : 'OFF'}, SMS ${smsEnabled ? 'ON' : 'OFF'}`, 'success');
        });

        document.getElementById('refreshSettingsBtn')?.addEventListener('click', function () {
            showNotification('Settings refreshed', 'info');
        });

        // Reminders section buttons
        document.getElementById('refreshRemindersBtn')?.addEventListener('click', function () {
            showNotification('Reminders list refreshed', 'info');
        });

        document.querySelectorAll('.resend-reminder-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                const reminderId = this.getAttribute('data-id');
                if (confirm('Resend this reminder?')) {
                    showNotification(`Reminder ${reminderId} resent`, 'success');
                }
            });
        });

        // Reminder settings
        document.getElementById('reminderTimeSelect')?.addEventListener('change', function () {
            const time = this.value;
            showNotification(`Reminder time set to ${time} hours before event`, 'success');
        });

        document.getElementById('remindMe')?.addEventListener('change', function () {
            showNotification(`Reminders to self ${this.checked ? 'enabled' : 'disabled'}`, 'info');
        });

        document.getElementById('remindPrimaryKin')?.addEventListener('change', function () {
            showNotification(`Reminders to next of kin ${this.checked ? 'enabled' : 'disabled'}`, 'info');
        });

        // Email notifications toggle
        document.getElementById('emailNotifications')?.addEventListener('change', function () {
            showNotification(`Email notifications ${this.checked ? 'enabled' : 'disabled'}`, 'info');
        });

        // Form submissions
        document.getElementById('saveDateBtn')?.addEventListener('click', function () {
            const dateLabel = document.getElementById('dateLabel').value;
            const eventDate = document.getElementById('eventDate').value;

            if (!dateLabel || !eventDate) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            // Here you would typically save to backend
            showNotification(`Date "${dateLabel}" on ${eventDate} saved successfully!`, 'success');
            closeModal('addDateModal');
            document.getElementById('addDateForm').reset();
        });

        document.getElementById('saveKinBtn')?.addEventListener('click', function () {
            const kinName = document.getElementById('kinName').value;
            const kinRelationship = document.getElementById('kinRelationship').value;
            const kinPhone = document.getElementById('kinPhone').value;

            if (!kinName || !kinRelationship || !kinPhone) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            // Here you would typically save to backend
            showNotification(`Next of kin "${kinName}" saved successfully!`, 'success');
            closeModal('addKinModal');
            document.getElementById('addKinForm').reset();
        });

        // Edit profile functionality
        document.getElementById('addNextOfKinBtn')?.addEventListener('click', function () {
            const template = document.getElementById('nextOfKinTemplate');
            const clone = template.content.cloneNode(true);
            document.getElementById('nextOfKinContainer').appendChild(clone);

            // Add event listener to new remove button
            const removeBtn = document.querySelector('#nextOfKinContainer .remove-kin-btn:last-child');
            if (removeBtn) {
                removeBtn.addEventListener('click', function () {
                    this.closest('.next-of-kin-entry').remove();
                });
            }

            showNotification('New next of kin form added', 'info');
        });

        document.getElementById('saveProfileBtn')?.addEventListener('click', function () {
            const fullName = document.getElementById('editFullName').value;
            const email = document.getElementById('editEmail').value;
            const phone = document.getElementById('editPhone').value;

            if (!fullName || !email || !phone) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            // Update user data in localStorage
            const user = JSON.parse(localStorage.getItem('psn_welfare_user') || '{}');
            user.fullName = fullName;
            user.email = email;
            user.phone = phone;
            user.dateOfBirth = document.getElementById('editDateOfBirth').value;
            user.weddingAnniversary = document.getElementById('editWeddingDate').value;

            localStorage.setItem('psn_welfare_user', JSON.stringify(user));

            // Update UI
            document.getElementById('userName').textContent = fullName;
            document.getElementById('profileName').textContent = fullName;
            document.getElementById('profileEmail').textContent = email;
            document.getElementById('profilePhone').textContent = phone;
            document.getElementById('profileDob').textContent = user.dateOfBirth || 'Not set';
            document.getElementById('profileWedding').textContent = user.weddingAnniversary || 'Not set';

            showNotification('Profile updated successfully!', 'success');
            closeModal('editProfileModal');
        });

        document.getElementById('previewProfileBtn')?.addEventListener('click', function () {
            showNotification('Profile preview generated', 'info');
        });

        // Password strength indicator
        document.getElementById('newPassword')?.addEventListener('input', function () {
            const password = this.value;
            const strengthFill = document.getElementById('passwordStrengthFill');
            const strengthText = document.getElementById('passwordStrengthText');

            if (!password) {
                strengthFill.style.width = '0%';
                strengthText.textContent = 'Password strength';
                return;
            }

            let strength = 0;
            if (password.length >= 8) strength += 25;
            if (/[A-Z]/.test(password)) strength += 25;
            if (/[0-9]/.test(password)) strength += 25;
            if (/[^A-Za-z0-9]/.test(password)) strength += 25;

            strengthFill.style.width = `${strength}%`;

            if (strength < 50) {
                strengthFill.style.backgroundColor = '#dc3545';
                strengthText.textContent = 'Weak';
            } else if (strength < 75) {
                strengthFill.style.backgroundColor = '#ffc107';
                strengthText.textContent = 'Fair';
            } else {
                strengthFill.style.backgroundColor = '#28a745';
                strengthText.textContent = 'Strong';
            }
        });

        // Password confirmation
        document.getElementById('confirmNewPassword')?.addEventListener('input', function () {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = this.value;
            const errorElement = document.getElementById('passwordMatchError');

            if (!newPassword || !confirmPassword) {
                errorElement.textContent = '';
                return;
            }

            if (newPassword === confirmPassword) {
                errorElement.textContent = 'Passwords match';
                errorElement.style.color = '#28a745';
            } else {
                errorElement.textContent = 'Passwords do not match';
                errorElement.style.color = '#dc3545';
            }
        });

        // Initialize with dashboard section
        document.addEventListener('DOMContentLoaded', function () {
            // Check if user is logged in
            const token = localStorage.getItem('psn_welfare_token');
            const user = localStorage.getItem('psn_welfare_user');

            if (!token || !user) {
                window.location.href = '../login';
                return;
            }

            try {
                const userData = JSON.parse(user);
                document.getElementById('userName').textContent = userData.fullName || 'Member';
                document.getElementById('userPsn').textContent = userData.psnNumber || 'PSN-XXXX-XXXX';

                // Update profile information
                document.getElementById('profileName').textContent = userData.fullName || 'Dr. John Pharmacist';
                document.getElementById('profilePsn').textContent = userData.psnNumber || 'PSN-TARA-2023-001';
                document.getElementById('profileEmail').textContent = userData.email || 'john.pharmacist@example.com';
                document.getElementById('profilePhone').textContent = userData.phone || '0803 123 4567';
                document.getElementById('profileDob').textContent = userData.dateOfBirth ? new Date(userData.dateOfBirth).toLocaleDateString() : '15 May 1985';
                document.getElementById('profileWedding').textContent = userData.weddingAnniversary ? new Date(userData.weddingAnniversary).toLocaleDateString() : '22 June 2015';
                document.getElementById('profileRegDate').textContent = userData.createdAt ? new Date(userData.createdAt).toLocaleDateString() : '15 March 2024';
                document.getElementById('profileConsent').textContent = userData.consentGiven ? `Yes (${new Date(userData.consentDate || userData.createdAt).toLocaleDateString()})` : 'Yes (15 March 2024)';

                // Pre-fill edit form
                document.getElementById('editFullName').value = userData.fullName || '';
                document.getElementById('editPsnNumber').value = userData.psnNumber || '';
                document.getElementById('editEmail').value = userData.email || '';
                document.getElementById('editPhone').value = userData.phone || '';
                document.getElementById('editDateOfBirth').value = userData.dateOfBirth || '';
                document.getElementById('editWeddingDate').value = userData.weddingAnniversary || '';
                document.getElementById('editConsent').checked = userData.consentGiven || false;

                // Set current date as default for new date inputs
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('eventDate').value = today;

            } catch (error) {
                console.error('Error parsing user data:', error);
                showNotification('Error loading user data', 'error');
            }

            // Setup event card buttons
            setupEventCardButtons();

            // Show dashboard section by default
            if (sections.dashboard) {
                sections.dashboard.style.display = 'block';
            }

            // Update stats based on user data
            updateDashboardStats();

            showNotification('Dashboard loaded successfully!', 'success');
        });

        // Update dashboard stats
        function updateDashboardStats() {
            const user = JSON.parse(localStorage.getItem('psn_welfare_user') || '{}');

            // Mock data for demonstration
            document.getElementById('birthdayCount').textContent = user.dateOfBirth ? '1' : '0';
            document.getElementById('anniversaryCount').textContent = user.weddingAnniversary ? '1' : '0';
            document.getElementById('upcomingCount').textContent = '3'; // Mock value
            document.getElementById('profileComplete').textContent = '85%'; // Mock value

            // Update last login
            document.getElementById('lastLogin').textContent = 'Today, ' + new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Handle escape key to close modals
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                modals.forEach(modal => {
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                });
            }
        });

        // Initialize next of kin container with existing data
        function initializeNextOfKinContainer() {
            const container = document.getElementById('nextOfKinContainer');
            if (!container) return;

            // Clear existing
            container.innerHTML = '';

            // Add from template if no existing data
            const template = document.getElementById('nextOfKinTemplate');
            const clone = template.content.cloneNode(true);
            container.appendChild(clone);

            // Add event listener to remove button
            const removeBtn = container.querySelector('.remove-kin-btn');
            if (removeBtn) {
                removeBtn.addEventListener('click', function () {
                    this.closest('.next-of-kin-entry').remove();
                });
            }
        }

        // Call initialization
        initializeNextOfKinContainer();
    </script>
</body>

</html>